/* ta.js (c) Nino Kroesen. MIT License. */ async function median(e,t=e.length){for(var n=t,a=[];n<=e.length;n++){var r=e.slice(n-t,n);r.sort((e,t)=>e-t),a.push(r[Math.round(r.length/2)-1])}return a}async function kmeans(e,t){var n,a=[],r=[],l=[],h=!1,s=Math.round(e.length/(t+1));for(i=0;i<t;i++)r[i]=e[s*(i+1)];do{for(i=0;i<t;i++)a[i]=[];for(x=0;x<e.length;x++){var o=-1;for(y=0;y<t;y++){var u=Math.abs(r[y]-e[x]);-1===o?(o=u,n=y):u<=o&&(o=u,n=y)}a[n].push(e[x])}for(l=r,x=0;x<t;x++){var p=0;for(y=0;y<a[x].length;y++)p+=a[x][y];var c=p/a[n].length;r[x]=c}for(x=0;x<t;x++)r[x]!==l[x]&&(h=!0)}while(h);return a}async function normalize(e,t=0){for(var n=0,a=await Math.max.apply(null,e.slice())*(1+t),r=await Math.min.apply(null,e.slice())*(1-t),l=[];n<e.length;n++)l.push(1-(a-e[n])/(a-r));return l}async function denormalize(e,t,n=0){for(var a=0,r=await Math.max.apply(null,e.slice())*(1+n),l=await Math.min.apply(null,e.slice())*(1-n),h=[];a<t.length;a++)h.push(l+t[a]*(r-l));return h}async function normalize_pair(e,t){for(var n=1,a=(e[0]+t[0])/2,r=[[a,a]];n<e.length;n++)r.push([r[r.length-1][0]*((e[n]-e[n-1])/e[n-1]+1),r[r.length-1][1]*((t[n]-t[n-1])/t[n-1]+1)]);return r}async function normalize_from(e,t){for(var n=1,a=[t];n<e.length;n++)a.push(a[a.length-1]*((e[n]-e[n-1])/e[n-1]+1));return a}async function standardize(e){for(var t=await sma(e,e.length),n=await std(e),a=[],r=0;r<e.length;r++)a.push((e[r]-t[0])/n);return a}async function mad(e,t=e.length){for(var n=t,a=[];n<=e.length;n++){var r=e.slice(n-t,n),l=await median(r),h=r.map(e=>Math.abs(e-l[l.length-1]));h=await median(h),a.push(h[h.length-1])}return a}async function aad(e,t=e.length){for(var n=t,a=[];n<=e.length;n++){var r=e.slice(n-t,n),l=0,h=await sma(r,t);for(q in r)l+=Math.abs(r[q]-h[h.length-1]);a.push(l/t)}return a}async function ssd(e,t=e.length){for(var n=t,a=[];n<=e.length;n++){var r=e.slice(n-t,n),l=await sma(r,t),h=0;for(let e in r)h+=(r[e]-l[l.length-1])**2;a.push(Math.sqrt(h))}return a}async function er(e){var t=[],n=[],a=1,r=1;for(let a in e)e[a]>=0?t.push(1+e[a]):n.push(1+e[a]);var l=t.length/e.length,h=n.length/e.length;for(let e in n)r*=n[e];for(let e in t)a*=t[e];return(100*(a**(1/t.length)-1)*l+100*(r**(1/n.length)-1)*h)/100}async function ar(e,t=e.length){for(var n=t,a=[];n<e.length;n++){var r=await er(e.slice(n-t,n));a.push(e[n]-r)}return a}async function kelly(e){var t=await er(e)+1,n=await winratio(e);return n-(1-n)/t}async function winratio(e){var t=0,n=0;for(let a in e)e[a]>=0?t++:n++;return t/(n+t)}async function avgwin(e){for(var t=0,n=[];t<e.length;t++)e[t]>=0&&n.push(e[t]);return(await sma(n,n.length))[0]}async function avgloss(e){for(var t=[],n=0;n<e.length;n++)e[n]<0&&t.push(e[n]);return(await sma(t,t.length))[0]}async function zscore(e,t=e.length){for(var n=t-1,a=[],r=e.slice(0,t-1);n<e.length;n++){r.push(e[n]);var l=await sma(r,t),h=await std(r,t);a.push((e[n]-l[0])/h),r.splice(0,1)}return a}async function rsi(e,t=14){for(var n=t-1,a=0,r=0,l=[],h=e.slice(0,t-1);n<e.length;n++,a=0,r=0){h.push(e[n]);for(var s=1;s<h.length;s++)h[s]-h[s-1]<0?r+=Math.abs(h[s]-h[s-1]):a+=h[s]-h[s-1];var o=100-100/(1+a/t/(r/t));l.push(o),h.splice(0,1)}return l}async function wrsi(e,t=14){for(var n=1,a=[],r=[],l=[];n<e.length;n++)e[n]-e[n-1]<0?(l.push(Math.abs(e[n]-e[n-1])),r.push(0)):(l.push(0),r.push(e[n]-e[n-1]));l=await wsma(l,t),r=await wsma(r,t);for(let e in l)a.push(100-100/(1+r[e]/l[e]));return a}async function tsi(e,t=25,n=13,a=13){for(var r=1,l=[],h=[],s=[],o=[];r<e.length;r++)l.push(e[r]-e[r-1]),h.push(Math.abs(e[r]-e[r-1]));var u=await ema(l,t),i=await ema(h,t),p=await ema(u,n),c=await ema(i,n);for(r=0;r<p.length;r++)s.push(p[r]/c[r]);var g=await ema(s,a);s.splice(0,s.length-g.length);for(r=0;r<g.length;r++)o.push([g[r],s[r]]);return o}async function bop(e,t=14){var n=e.map(e=>(e[3]-e[0])/(e[1]-e[2]));return n=await sma(n,t)}async function fi(e,t=13){for(var n=1,a=[],r=[];n<e.length;n++)if(a.push((e[n][0]-e[n-1][0])*e[n][1]),a.length>=t){var l=await ema(a,t);r.push(l[l.length-1]),a.splice(0,1)}return r}async function asi(e){for(var t=1,n=[];t<e.length;t++){var a,r=e[t][1],l=e[t-1][1],h=e[t][0],s=e[t-1][0],o=e[t][2],u=e[t-1][2],i=s-r>u-r?s-r:u-r,p=e[t][0],c=e[t-1][0],g=Math.max(e[t][0],e[t-1][0])-Math.min(e[t][2],e[t-1][2]);h-l>o-l&&h-l>h-o&&(a=h-l-(o-l)/2+(l-c)/4),o-l>h-l&&o-l>h-o&&(a=o-l-(h-l)/2+(l-c)/4),h-o>h-l&&h-o>o-l&&(a=h-o+(l-c)/4),n.push((l-r+(l-c)/2+(r-p)/2)/a*50*i/g)}return n}async function ao(e,t=5,n=35){e=e.map(e=>(e[0]+e[1])/2);for(var a=n,r=[];a<=e.length;a++){var l=e.slice(a-n,a),h=await sma(l,t),s=await sma(l,n);r.push(h[h.length-1]-s[s.length-1])}return r}async function ac(e,t=5,n=35){var a=await ao(e,t,n),r=await sma(a,t),l=[];a.length>r.length?a.splice(0,a.length-r.length):r.splice(0,r.length-a.length);for(let e in a)l.push(a[e]-r[e]);return l}const fib=async(e,t)=>[e,.236*(t-e)+e,.382*(t-e)+e,.5*(t-e)+e,.618*(t-e)+e,.786*(t-e)+e,t,1.618*(t-e)+e,2.618*(t-e)+e,3.618*(t-e)+e,4.236*(t-e)+e];async function pr(e,t=14){for(var n=t,a=[];n<=e.length;n++){var r=e.slice(n-t,n),l=await Math.max.apply(null,r),h=await Math.min.apply(null,r);a.push((l-e[n-1])/(l-h)*-100)}return a}async function lsma(e,t=25){for(var n=t,a=[];n<=e.length;n++){for(var r,l,h=e.slice(n-t,n),s=0,o=0,u=0,i=0,p=1;p<=t;p++)s+=p,o+=h[p-1],u+=h[p-1]*p,i+=p*p,h[p-1]*h[p-1];l=o/t-(r=(u-s*o/t)/(i-s*s/t))*s/t,a.push(r*t+l)}return a}async function don(e,t=20){for(var n=t,a=[];n<=e.length;n++){var r=e.slice(n-t,n),l=[],h=[];for(let e in r)l.push(r[e][0]),h.push(r[e][1]);var s=Math.max.apply(null,l.slice()),o=Math.min.apply(null,h.slice());a.push([s,(s+o)/2,o])}return a}async function ichimoku(e,t=9,n=26,a=52,r=26){for(var l=0,h=[],s=[],o=[];l<e.length;l++)if(h.push(e[l]),h.length>=a){var u=[],i=[];for(let e in h)u.push(h[e][0]),i.push(h[e][2]);var p=(Math.max.apply(null,u.slice(u.length-t,u.length))+Math.min.apply(null,i.slice(i.length-t,i.length)))/2,c=(Math.max.apply(null,u.slice(u.length-n,u.length))+Math.min.apply(null,i.slice(i.length-n,i.length)))/2,g=e[l][1]+c,m=(Math.max.apply(null,u.slice(u.length-a,u.length))+Math.min.apply(null,i.slice(i.length-n,i.length)))/2;chik=e[l][1],o.push([p,c,g,m,chik]),h.splice(0,1)}for(l=r;l<o.length-r;l++)s.push([o[l][0],o[l][1],o[l+r][2],o[l+r][3],o[l-r][4]]);return s}async function stoch(e,t=14,n=3,a=3){t<n&&([t,n]=[n,t]),a>n&&([a,n]=[n,a]);for(var r=0,l=[],h=[],s=[],o=[];r<e.length;r++){if(h.push(e[r][0]),s.push(e[r][2]),h.length>=t){var u=await Math.max.apply(null,h),i=await Math.min.apply(null,s),p=100*(e[r][1]-i)/(u-i);o.push(p)}if(a>0&&o.length>a){var c=await sma(o,a);o.push(c[c.length-1])}if(o.length-a>=n){var g=await sma(o,n);l.push([p,g[g.length-1]]),h.splice(0,1),s.splice(0,1),o.splice(0,1)}}return l}async function atr(e,t=14){for(var n=1,a=[e[0][0]-e[0][2]];n<e.length;n++){var r=await Math.max(e[n][0]-e[n-1][1],e[n][2]-e[n-1][1],e[n][0]-e[n][2]);a.push((a[a.length-1]*(t-1)+r)/t)}return a}async function sma(e,t=14){for(var n=t,a=[];n<=e.length;n++){let r=await sum(e.slice(n-t,n));a.push(r/t)}return a}async function smma(e,t=14){for(var n=t,a=[];n<=e.length;n++){var r=e.slice(n-t,n),l=0;for(q in r)l+=r[q];a.length<=0?a.push(l/t):a.push((l-a[a.length-1])/t)}return a.splice(0,1),a}async function wma(e,t=14){for(var n=1,a=0,r=[];n<=t;n++)a+=n;for(n=t;n<=e.length;n++){var l=e.slice(n-t,n),h=0;for(q in l)h+=l[q]*(Number(q)+1)/a;r.push(h)}return r}async function wsma(e,t=14){for(var n=t,a=[],r=1/t;n<=e.length;n++)if(a.length>0)a.push((e[n-1]-a[a.length-1])*r+a[a.length-1]);else{var l=e.slice(n-t,n),h=0;for(q in l)h+=l[q];a.push(h/t)}return a}async function pwma(e,t=14){for(var n=t/2,a=t,r=0,l=[],h=[];n>=1;n--,a--)n%1!=0?r+=(n=Math.round(n))*a:(h.push(n*a),r+=n*a*2),h.unshift(n*a);for(n=t;n<=e.length;n++){for(var s=0,o=e.slice(n-t,n),u=t-1;u>=0;u--)s+=o[u]*h[u]/r;l.push(s)}return l}async function hwma(e,t=14){for(var n=1,a=t,r=0,l=[],h=[];n<=t/2;n++,a--)n%1!=0?r+=(n=Math.round(n))*a:(h.push(n*a),r+=n*a*2),h.unshift(n*a);for(n=t;n<=e.length;n++){for(var s=0,o=e.slice(n-t,n),u=t-1;u>=0;u--)s+=o[u]*h[u]/r;l.push(s)}return l}async function vwma(e,t=20){e=e.map(e=>[e[0]*e[1],e[1]]);for(var n=t,a=[];n<=e.length;n++){for(var r=e.slice(n-t,n),l=0,h=0,s=0;s<r.length;s++)l+=r[s][1],h+=r[s][0];a.push(h/l)}return a}async function ema(e,t=12){for(var n=t,a=[],r=2/(t+1);n<=e.length;n++)if(a.length>0)a.push((e[n-1]-a[a.length-1])*r+a[a.length-1]);else{var l=e.slice(n-t,n),h=0;for(q in l)h+=l[q];a.push(h/t)}return a}async function hull(e,t=14){var n=[],a=[],r=await wma(e,t),l=Math.round(Math.sqrt(t)),h=await wma(e,Math.round(t/2));h.splice(0,h.length-r.length);for(let e in r)if(n.push(2*h[e]-r[e]),n.length>=l){var s=await wma(n,l);a.push(s[0]),n.splice(0,1)}return a}async function kama(e,t=10,n=2,a=30){for(var r=t+1,l=[(l=await sma(e,t))[l.length-1]];r<e.length;r++){for(var h=0,s=Math.abs(e[r]-e[r-t]),o=1;o<t;o++)h+=Math.abs(e[r-o]-e[r-o-1]);var u=(s/h*(2/(n+1)-2/(a+1)+2/(a+1)))**2;l.push(l[l.length-1]+u*(e[r]-l[l.length-1]))}return l}async function macd(e,t=12,n=26){t>n&&([t,n]=[n,t]);var a=await ema(e,t),r=await ema(e,n),l=[];a.splice(0,n-t);for(var h=0;h<r.length;h++)l.push(a[h]-r[h]);return l}async function bands(e,t=14,n=1){for(var a=0,r=[],l=[],h=[],s=await sma(e,t);a<e.length;a++)if(r.push(e[a]),r.length>=t){var o=await std(r,t);l.push(o),r.splice(0,1)}for(a=0;a<s.length;a++)h.push([s[a]+l[a]*n,s[a],s[a]-l[a]*n]);return h}async function bandwidth(e,t=14,n=1){for(var a=0,r=[],l=await bands(e,t,n);a<l.length;a++)r.push((l[a][0]-l[a][2])/l[a][1]);return r}async function keltner(e,t=14,n=1){var a,r=[],l=await atr(e,t),h=[];for(let t in e)r.push((e[t][0]+e[t][1]+e[t][2])/3);a=await sma(r,t),l.splice(0,t-1);for(var s=0;s<a.length;s++)h.push([a[s]+l[s]*n,a[s],a[s]-l[s]*n]);return h}async function variance(e,t=e.length){for(var n=t,a=[];n<=e.length;n++){var r=e.slice(n-t,n),l=await sma(r,t),h=0;for(x in r)h+=(r[x]-l[l.length-1])**2;a.push(h/t)}return a}async function std(e,t=e.length){var n=e.reduce((e,t)=>Number(e)+Number(t))/t;return Math.sqrt(e.reduce((e,t)=>e+Math.pow(t-n,2),0)/t)}async function normsinv(e){var t=-.00778489400243029,n=-.322396458041136,a=-2.40075827716184,r=-2.54973253934373,l=4.37466414146497,h=2.93816398269878,s=.00778469570904146,o=.32246712907004,u=2.445134137143,i=3.75440866190742;if(e<0||e>1)return 0;if(e<.02425)return(((((t*(p=Math.sqrt(-2*Math.log(e)))+n)*p+a)*p+r)*p+l)*p+h)/((((s*p+o)*p+u)*p+i)*p+1);if(e<=.97575){var p,c=(p=e-.5)*p;return(((((-39.6968302866538*c+220.946098424521)*c-275.928510446969)*c+138.357751867269)*c-30.6647980661472)*c+2.50662827745924)*p/(((((-54.4760987982241*c+161.585836858041)*c-155.698979859887)*c+66.8013118877197)*c-13.2806815528857)*c+1)}return-(((((t*(p=Math.sqrt(-2*Math.log(1-e)))+n)*p+a)*p+r)*p+l)*p+h)/((((s*p+o)*p+u)*p+i)*p+1)}async function sim(e,t=50,n=1e3,a){for(var r=0,l=[];r<n;r++){for(var h=e.slice(),s=0;s<t;s++){for(var o=[],u=1;u<h.length;u++){var i=await dif(h[u],h[u-1]);o.push(i)}var p=await sma(o,o.length),c=await std(o),g=await normsinv(Math.random());h.push(h[h.length-1]*Math.exp(p[0]-c*c/2+c*g))}l.push(h)}return a?await percentile(l,a):l}async function percentile(e,t){for(var n=0,a=[];n<e[0].length;n++)e.sort((e,t)=>e[n]-t[n]),a.push(e[Math.round((e.length-1)*t)][n]);return a}async function cor(e,t){for(var n=await sma(e,e.length),a=await sma(t,t.length),r=0,l=0,h=0,s=0;s<e.length;s++){var o=e[s]-n,u=t[s]-a;r+=o*u,l+=Math.pow(o,2),h+=Math.pow(u,2)}var i=e.length-1;return l/=i,h/=i,r/(i*(l=Math.sqrt(l))*(h=Math.sqrt(h)))}const dif=async(e,t)=>(e-t)/t,log=async e=>e.map(e=>Math.log(e)),exp=async e=>e.map(e=>Math.exp(e));async function drawdown(e){for(var t=1,n=e[0],a=e[0],r=0;t<e.length;t++){if(e[t]>n){if(0!=a)(l=await dif(a,n))<r&&(r=l),a=e[t];n=e[t]}e[t]<a&&(a=e[t])}var l;return(l=await dif(a,n))<r&&(r=l),r}async function aroon_up(e,t=10){for(var n=t,a=[];n<=e.length;n++){var r=e.slice(n-t,n),l=r.slice();l.sort((e,t)=>e-t),a.push(100*(t-1-r.reverse().findIndex(e=>e===l[t-1]))/(t-1))}return a}async function aroon_down(e,t=10){for(var n=t,a=[];n<=e.length;n++){var r=e.slice(n-t,n),l=r.slice();l.sort((e,t)=>e-t),a.push(100*(t-1-r.reverse().findIndex(e=>e===l[0]))/(t-1))}return a}async function aroon_osc(e,t=25){for(var n=0,a=[],r=await aroon.up(e,t),l=await aroon.down(e,t);n<r.length;n++)a.push(r[n]-l[n]);return a}async function mfi(e,t=14){for(var n=t,a=[],r=e.map(e=>e[1]),l=e.map(e=>e[0]),h=0,s=0;n<=e.length;n++,h=0,s=0){for(q=n-t;q<n;q++)h+=l[q],s+=r[q];a.push(100-100/(1+h/s))}return a}async function roc(e,t=14){for(var n=t,a=[];n<=e.length;n++)a.push((e[n-1]-e[n-t])/e[n-t]);return a}async function cop(e,t=11,n=14,a=10){for(var r=Math.max(t,n),l=[],h=r+a;h<e.length;h++){var s=e.slice(h-(r+a),h),o=s.slice(),u=[];s=await roc(s,t),o=await roc(o,n),s.splice(0,s.length-o.length),o.splice(0,o.length-s.length);for(var i=0;i<s.length;i++)u.push(s[i]+o[i]);u=await wma(u,a),l.push(u[u.length-1])}return l}async function kst(e,t=10,n=15,a=20,r=30,l=10,h=10,s=10,o=15,u=9){for(var i=[],p=[],c=Math.max(t,n,a,r)+Math.max(l,h,s,o),g=c;g<=e.length;g++){var m=e.slice(g-c,g),f=await roc(m,t),v=await roc(m,n),d=await roc(m,a),x=await roc(m,r);f=await sma(f,l),v=await sma(v,h),d=await sma(d,s),x=await sma(x,o),i.push(f[f.length-1]+v[v.length-1]+d[d.length-1]+x[x.length-1])}var w=await sma(i,u);for(var g in i.splice(0,i.length-w.length),w)p.push([i[g],w[g]]);return p}async function obv(e){for(var t=1,n=[0];t<e.length;t++)e[t][1]>e[t-1][1]&&n.push(n[n.length-1]+e[t][0]),e[t][1]<e[t-1][1]&&n.push(n[n.length-1]-e[t][0]),e[t][1]===e[t-1][1]&&n.push(n[n.length-1]);return n}async function vwap(e,t=e.length){e=e.map(e=>[e[0]*e[1],e[1]]);for(var n=t,a=[];n<=e.length;n++){for(var r=e.slice(n-t,n),l=0,h=0,s=0;s<r.length;s++)l+=r[s][1],h+=r[s][0];a.push(h/l)}return a}async function mom(e,t=10,n){for(var a=t-1,r=[];a<e.length;a++)n?r.push(e[a]/e[a-(t-1)]*100):r.push(e[a]-e[a-(t-1)]);return r}async function mom_osc(e,t=10){for(var n=++t,a=[],r=0,l=0;n<=e.length;n++,r=0,l=0){for(var h=1;h<t;h++)e[n-t+(h-1)]<e[n-t+h]?r+=e[n-t+h]:l+=e[n-t+h];a.push((r-l)/(r+l)*100)}return a}async function ha(e){for(var t=[[(Number(e[0][0])+Number(e[0][3]))/2,Number(e[0][1]),Number(e[0][2]),(Number(e[0][0])+Number(e[0][1])+Number(e[0][2])+Number(e[0][3]))/4]],n=1;n<e.length;n++)t.push([(t[t.length-1][0]+t[t.length-1][3])/2,Math.max(t[t.length-1][0],t[t.length-1][3],e[n][1]),Math.min(t[t.length-1][0],t[t.length-1][3],e[n][2]),(e[n][0]+e[n][1]+e[n][2]+e[n][3])/4]);return t}async function ren(e,t=1){for(var n=[],a=Math.floor(t)===t?0:t.toString().split(".")[1].length||0,r=Math.ceil(e[0][0]/t*10**a)/10**a*t,l=r-t,h=1;h<e.length;h++){if(e[h][0]>r+t)do{n.push([r,r+t,r,r+t]),r+=t,l+=t}while(e[h][0]>r+t);if(e[h][1]<l-t)do{n.push([l,l,l-t,l-t]),r-=t,l-=t}while(e[h][1]<l-t)}return n}async function envelope(e,t=10,n=.005){for(var a=t,r=[];a<e.length;a++){var l=await sma(e.slice(a-t,a),t);r.push([l[0]*(1+n),l[0],l[0]*(1-n)])}return r}async function chaikin_osc(e,t=3,n=10){for(var a=0,r=[],l=[];a<e.length;a++){var h=(e[a][1]-e[a][2]-(e[a][0]-e[a][1]))/(e[a][0]-e[a][2]);isNaN(h)?l.push(0):l.push(h*e[a][3])}var s=await ema(l,t),o=await ema(l,n);s.length>o.length?s.splice(0,s.length-o.length):o.splice(0,o.length-s.length);for(a=0;a<s.length;a++)r.push(s[a]-o[a]);return r}async function fractals(e){for(var t=[[!1,!1],[!1,!1]],n=2;n<e.length-2;n++){var a=e[n-2][0]<e[n][0]&&e[n-1][0]<e[n][0]&&e[n][0]>e[n+1][0]&&e[n][0]>e[n+2][0],r=e[n-2][1]>e[n][1]&&e[n-1][1]>e[n][1]&&e[n][1]<e[n+1][1]&&e[n][1]<e[n+2][1];t.push([a,r])}return t.push([!1,!1],[!1,!1]),t}async function alligator(e,t=13,n=8,a=5,r=8,l=5,h=3){var s=[],o=await smma(e,t),u=await smma(e,n),i=await smma(e,a);u.splice(0,u.length-o.length),i.splice(0,i.length-o.length);for(var p=o.length-1;p>=7;p--)s.push([o[p-(r-1)],u[p-(l-1)],i[p-(h-1)]]);return s}async function gator(e,t=13,n=8,a=5,r=8,l=5,h=3){var s=[],o=await smma(e,t),u=await smma(e,n),i=await smma(e,a);u.splice(0,u.length-o.length),i.splice(0,i.length-o.length);for(var p=o.length-1;p>=r-1;p--)s.push([o[p-(r-1)]-u[p-(l-1)],-Math.abs(u[p-(l-1)]-i[p-(h-1)])]);return s}async function recent_high(e,t=25){for(var n=e.length-2,a=t,r=0,l=e[e.length-1];n>=0&&(e[n]>=l&&a>0?(l=e[n],r=n,a=t):a--,!(a<=0));n--);return{index:r,value:l}}async function recent_low(e,t=25){for(var n=e.length-2,a=t,r=0,l=e[e.length-1];n>=0&&(e[n]<=l&&a>0?(l=e[n],r=n,a=t):a--,!(a<=0));n--);return{index:r,value:l}}async function support(e,t=recent_low(e)){var n,a,r=(t=await t).value;do{for(var l=t.index;l<e.length;l++){var h=(t.value-e[l])/(t.index-l);h<r&&(r=h,n=l)}t.index+1==n&&n!=e.length-1?(t.index=n,r=Math.min.apply(null,e.slice()),t.value=e[t.index],a=!1):a=!0,t.index==e.length-1&&(a=!0)}while(!a);return n==e.length-1||t.index==e.length-1?{calculate:async e=>t.value,slope:0,lowest:t.value,index:t.index}:{calculate:async e=>e*r+t.value,slope:r,lowest:t.value,index:t.index}}async function resistance(e,t){var n,a,r=(t=t||await recent_high(e)).value;do{for(var l=t.index;l<e.length;l++){var h=(e[l]-t.value)/(t.index-l);h<r&&(r=h,n=l)}t.index+1==n&&n!=e.length-1?(t.index=n,r=Math.max.apply(null,e.slice()),t.value=e[t.index],a=!1):a=!0,t.index==e.length-1&&(a=!0)}while(!a);return n==e.length-1||t.index==e.length-1?{calculate:async e=>t.value,slope:0,highest:t.value,index:t.index}:{calculate:async e=>e*-r+t.value,slope:r,highest:t.value,index:t.index}}async function fisher(e,t){var n=[],a=0,r=0;for(let o=t;o<=e.length;o++){var l=e.slice(o-t,o),h=a,s=Math.min.apply(null,l);(r=.66*((e[o-1]-s)/(Math.max.apply(null,l)-s)-.5)+.67*r)>.99&&(r=.999),r<-.99&&(r=-.999),a=.5*Math.log((1+r)/(1-r))+.5*h,n.push([a,h])}return n.slice(1,n.length)}async function cross(e,t){e.splice(0,e.length-t.length);for(var n=e[0]>t[0],a=[],r=0;r<e.length;r++)e[r]<t[r]&&n&&(a.push({index:r,cross:!1}),n=!1),e[r]>t[r]&&!n&&(a.push({index:r,cross:!0}),n=!0);return a}async function se(e,t){return t=t||e.length,await std(e)/t**.5}async function halftrend(e,t,n,a){let r=[],l=[0],h=[0],s=[0],o=[0],u=void 0;for(let c=t;c<=e.length;c++){let g=e.slice(c-t,c);maxlow=g[g.length-2][2],minhigh=g[g.length-2][0],atr2=await atr(g,t),atr2=atr2[atr2.length-1]/2;let m=a*atr2,f=Math.max.apply(null,g.slice(g.length-1,g.length).map(e=>e[0])),v=Math.min.apply(null,g.slice(g.length-1,g.length).map(e=>e[2])),d=await sma(g.slice(g.length-n,g.length).map(e=>e[0]),n),x=await sma(g.slice(g.length-n,g.length).map(e=>e[2]),n);if(1==l[l.length-1]?(maxlow=Math.max(v,maxlow),d[0]<maxlow&&g[g.length-1][1]<g[g.length-2][2]&&(h.push(1),l.push(0),minhigh=g[g.length-2][0])):(minhigh=Math.min(f,minhigh),x[0]>minhigh&&g[g.length-1][1]<g[g.length-2][0]&&(h.push(0),l.push(1),maxlow=v)),0==h[h.length-1]){isNaN(h[h.length-2])||0==h[h.length-2]?s.push(isNaN(s[s.length-2])?maxlow:Math.max(s[s.length-2],maxlow)):s.push(isNaN(o[o.length-2])?o[o.length-1]:o[o.length-2]),u="long";var i=s[s.length-1]+m,p=s[s.length-1]-m}else{isNaN(h[h.length-2])||1==h[h.length-2]?o.push(isNaN(o[o.length-2])?minhigh:Math.min(minhigh,o[o.length-2])):o.push(isNaN(s[s.len-2])?s[s.length-1]:s[s.length-2]),u="short";i=o[o.length-1]+m,p=o[o.length-1]-m}r.push([i,0==h[h.length-1]?s[s.length-1]:o[o.length-1],p,u])}return r}const sum=async e=>e.reduce((e,t)=>e+t);async function covariance(e,t,n){let a=[];await sma(e,e.length),await sma(t,t.length);for(let r=n;r<=e.length;r++){let l=e.slice(r-n,r),h=t.slice(r-n,r),s=await sma(l,n),o=[],u=await sma(h,n);for(let e=0;e<n;e++)o.push((l[e]-s[0])*(h[e]-u[0]));o=await sum(o),a.push(o/n)}return a}const range=(e,t,n)=>Math.floor(n?n()*(Math.floor(t)-Math.ceil(e))+Math.ceil(e):Math.random()*(Math.floor(t)-Math.ceil(e))+Math.ceil(e)),pick=(e,t)=>e[Math.floor(t?t()*Math.floor(e.length):Math.random()*Math.floor(e.length))],float=(e,t,n)=>n?n()*(t-e)+e:Math.random()*(t-e)+e;function prng(e){for(var t=0,n=1779033703^e.length;t<e.length;t++)n=(n=Math.imul(n^e.charCodeAt(t),3432918353))<<13|n>>>19;return n=Math.imul(n^n>>>16,2246822507),n=Math.imul(n^n>>>13,3266489909),e=(n^=n>>>16)>>>0,function(){var t=e+=1831565813;return t=Math.imul(t^t>>>15,1|t),(((t^=t+Math.imul(t^t>>>7,61|t))^t>>>14)>>>0)/4294967296}}async function ncdf(e,t,n){e=t||n?(e-t)/n:e;var a=1/(1+.2315419*Math.abs(e)),r=.3989423*Math.exp(-e*e/2)*a*(.3193815+a*(a*(1.781478+a*(1.330274*a-1.821256))-.3565638));return e>0?1-r:r}async function zigzag(e,t=.05){let n=[],a=1/0,r=-1/0,l=!1,h=!1,s=[];for(let s=0;s<e.length;s++)if(l){n[n.length-1].value>=e[s][1]&&(n[n.length-1].value=e[s][1],n[n.length-1].index=s),a>=e[s][1]&&(a=e[s][1]),(e[s][0]-a)/a>t&&(n.push({index:s,value:e[s][0]}),h=!0,l=!1,a=1/0)}else if(h){n[n.length-1].value<=e[s][0]&&(n[n.length-1].value=e[s][0],n[n.length-1].index=s),r<=e[s][1]&&(r=e[s][1]),(r-e[s][1])/e[s][1]>t&&(n.push({index:s,value:e[s][1]}),l=!0,h=!1,r=-1/0)}else{a>=e[s][1]&&(a=e[s][1]),r<=e[s][0]&&(r=e[s][0]);let o=(e[s][0]-a)/a,u=(r-e[s][1])/r;u>t&&o<t?(l=!0,n.push({index:0,value:e[0][0]}),n.push({index:s,value:e[s][1]})):o>t&&u<t?(h=!0,n.push({index:0,value:e[0][1]}),n.push({index:s,value:e[s][0]})):u>o?(l=!0,n.push({index:0,value:e[0][0]}),n.push({index:s,value:e[s][1]})):(h=!0,n.push({index:0,value:e[0][1]}),n.push({index:s,value:e[s][0]}))}s=[n[0].value];for(let e=1;e<n.length;e++){let t=n[e].index-n[e-1].index,a=(n[e].value-n[e-1].value)/t;for(let r=1;r<=t;r++)s.push(r*a+n[e-1].value)}return s}const random={range,pick,float,prng};const aroon={up:aroon_up,down:aroon_down,osc:aroon_osc};
