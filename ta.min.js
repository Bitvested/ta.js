/* ta.js (c) Nino Kroesen. MIT License. */ async function median(n,t){for(var a=t||n.length,e=[],r=[],l=0;l<n.length;l++)if(e.push(n[l]),e.length>=a){var s=e.slice();s.sort((n,t)=>n>t?-1:n<t?1:0),r.push(s[Math.round(s.length/2)]),e.splice(0,1)}return r}async function rsi(n,t){for(var a=t||14,e=[],r=[],l=1;l<n.length;l++){var s=n[l]-n[l-1];if(e.push(s),e.length>=a){var h=0,u=0;for(q in e)e[q]<0&&(u+=e[q]),e[q]>=0&&(h+=e[q]);h/=a,u=Math.abs(u)/a,rsi=Number(100-100/(1+h/u)),r.push(rsi),e.splice(0,1)}}return r}async function tsi(n,t,a,e){for(var r=t||25,l=a||13,s=e||13,h=[],u=[],i=[],o=[],p=1;p<n.length;p++)h.push(n[p]-n[p-1]),u.push(Math.abs(n[p]-n[p-1]));var c=await ema(h,r),f=await ema(u,r),g=await ema(c,l),v=await ema(f,l);for(p=0;p<g.length;p++)i.push(g[p]/v[p]);var m=await ema(i,s);i.splice(0,i.length-m.length);for(p=0;p<m.length;p++)o.push([m[p],i[p]]);return o}async function pr(n,t){for(var a=t||14,e=[],r=[],l=0;l<n.length;l++)if(r.push(n[l]),r.length>=a-1){var s=await Math.max.apply(null,r),h=await Math.min.apply(null,r);e.push((s-n[l])/(s-h)*-100),r.splice(0,1)}return e}async function lsma(n,t){for(var a=t||25,e=[],r=[],l=0;l<n.length;l++)if(e.push(n[l]),e.length>=a){for(var s,h,u=0,i=0,o=0,p=0,c=1;c<=a;c++)u+=c,i+=e[c-1],o+=e[c-1]*c,p+=c*c,e[c-1]*e[c-1];h=i/a-(s=(o-u*i/a)/(p-u*u/a))*u/a,r.push(s*a+h),e.splice(0,1)}return r}async function don(n,t){for(var a=[],e=[],r=t||20,l=0;l<n.length;l++)if(a.push(n[l]),a.length>=r){var s=[],h=[];for(let n in a)s.push(a[n][0]),h.push(a[n][1]);var u=Math.max.apply(null,s.slice()),i=Math.min.apply(null,h.slice());e.push([u,(u+i)/2,i]),a.splice(0,1)}return e}async function ichimoku(n,t,a,e,r){for(var l=[],s=t||9,h=a||26,u=e||52,i=r||26,o=[],p=[],c=0;c<n.length;c++)if(l.push(n[c]),l.length>=u){var f=[],g=[];for(let t in l)f.push(n[c][0]),g.push(n[c][2]);var v=(Math.max.apply(null,f.slice(f.length-1-s,f.length-1))+Math.min.apply(null,g.slice(g.length-1-s,g.length-1)))/2,m=(Math.max.apply(null,f.slice(f.length-1-h,f.length-1))+Math.min.apply(null,g.slice(g.length-1-h,g.length-1)))/2,y=n[c][1]+m,d=(Math.max.apply(null,f.slice(f.length-1-u,f.length-1))+Math.min.apply(null,g.slice(g.length-1-h,g.length-1)))/2;chik=n[c][1],p.push([v,m,y,d,chik]),l.splice(0,1)}for(c=i;c<p.length-i;c++)o.push([v[c][0],m[c][1],y[c+(i-1)][2],d[c+(i-1)][3],chik[c+i-1][4]]);return o}async function stoch(n,t,a,e){var r=t||14,l=a||3,s=e||3;r<l&&([r,l]=[l,r]),s>l&&([s,l]=[l,s]);for(var h=[],u=[],i=[],o=[],p=0;p<n.length;p++){if(u.push(n[p][0]),i.push(n[p][2]),u.length>=r){var c=await Math.max.apply(null,u),f=await Math.min.apply(null,i),g=100*(n[p][1]-f)/(c-f);o.push(g)}if(s>0&&o.length>s){var v=await sma(o,s);o.push(v[v.length-1])}if(o.length-s>=l){var m=await sma(o.slice(s),l);h.push([g,m[m.length-1]]),u.splice(0,1),i.splice(0,1),o.splice(0,1)}}return h}async function atr(n,t){for(var a=t||14,e=[],r=0;r<n.length;r++)if(e.length<1)e.push(n[r][0]-n[r][2]);else{var l=await Math.max(n[r][0]-n[r-1][1],n[r][2]-n[r-1][1],n[r][0]-n[r][2]),s=(e[e.length-1]*(a-1)+l)/a;e.push(s)}return e}async function sma(n,t){for(var a=t||14,e=[],r=[],l=0;l<n.length;l++)if(e.push(n[l]),e.length>=a){var s=0;for(q in e)s+=e[q];r.push(s/a),e.splice(0,1)}return r}async function smma(n,t){for(var a=t||14,e=[],r=[],l=0;l<n.length;l++)if(e.push(n[l]),e.length>=a){var s=0;for(q in e)s+=e[q];r?r.push(s/a):r.push((s-sma1+n[l])/a),e.splice(0,1)}return r.splice(0,1),r}async function wma(n,t){for(var a=t||14,e=0,r=1;r<=a;r++)e+=r;var l=[],s=[];for(r=0;r<n.length;r++)if(l.push(n[r]),l.length>=a){var h=0,u=1;for(q in l)h+=l[q]*u/e,u++;s.push(h),l.splice(0,1)}return s}async function vwma(n,t){for(var a=t||20,e=[],r=[],l=0;l<n.length;l++)if(e.push([n[l][0]*n[l][1],n[l][1]]),e.length>=a){for(var s=0,h=0,u=0;u<e.length;u++)s+=e[u][1],h+=e[u][0];r.push(h/s),e.splice(0,1)}return r}async function ema(n,t){for(var a=t||12,e=[],r=[],l=0,s=2/(a+1),h=0;h<n.length;h++){e.push(n[h]);var u=0;if(0==l&&e.length>=a){for(q in e)u+=e[q];u/=a,r.push(u),l=u}else 0!=l&&e.length>=a&&(u=(n[h]-l)*s+l,r.push(u),l=u)}return r}async function hull(n,t){var a=t||14,e=[],r=[],l=await wma(n.slice(),a),s=Math.round(Math.sqrt(a)),h=await wma(n.slice(),Math.round(a/2));h.splice(0,h.length-l.length);for(let n in l)if(e.push(2*h[n]-l[n]),e.length>=s){var u=await wma(e,s);r.push(u[u.length-1])}return r}async function macd(n,t,a){var e=t||12,r=a||26;e>r&&([e,r]=[r,e]);var l=await ema(n,e),s=await ema(n,r);l.splice(0,r-e);for(var h=[],u=0;u<s.length;u++)h.push([l[u]-s[u]]);return h}async function bands(n,t,a){for(var e=t||14,r=a||1,l=[],s=[],h=[],u=await sma(n,e),i=0;i<n.length;i++)if(l.push(n[i]),l.length>=e){var o=await std(l,e);s.push(o),l.splice(0,1)}for(i=0;i<u.length;i++)h.push([u[i]+s[i]*r,u[i],u[i]-s[i]*r]);return h}async function bandwidth(n,t,a){for(var e=t||14,r=a||1,l=[],s=[],h=[],u=await sma(n,e),i=0;i<n.length;i++)if(l.push(n[i]),l.length>=e){var o=await std(l);s.push(o),l.push(n[i]),l.splice(0,1)}for(i=0;i<s.length;i++){var p=(u[i]+s[i]*r-(u[i]-s[i]*r))/u[i];h.push(p)}return h}async function keltner(n,t,a){var e,r=t||14,l=a||1,s=[],h=await atr(n,r),u=[];for(var i in n)s.push((n[i][0]+n[i][1]+n[i][2])/3);e=await sma(s,r),h.splice(0,r-1);for(i=0;i<e.length;i++)u.push([e[i]+h[i]*l,e[i],e[i]-h[i]*l]);return u}async function std(n,t){var a=t||n.length,e=n.reduce((n,t)=>Number(n)+Number(t))/a;return Math.sqrt(n.reduce((n,t)=>n+Math.pow(t-e,2),0)/a)}async function cor(n,t){for(var a=await sma(n.slice(),n.length),e=await sma(t.slice(),t.length),r=0,l=0,s=0,h=0;h<n.length;h++){var u=n[h]-a,i=t[h]-e;r+=u*i,l+=Math.pow(u,2),s+=Math.pow(i,2)}var o=n.length-1;return l/=o,s/=o,r/(o*(l=Math.sqrt(l))*(s=Math.sqrt(s)))}async function dif(n,t){return(n-t)/t}async function aroon_up(n,t){for(var a=t||10,e=[],r=[],l=0;l<n.length;l++)if(e.push(n[l]),e.length>=a){var s=e.slice(0);s.sort((n,t)=>n-t);var h=s[a-1];r.push(100*(a-(e.findIndex(n=>n==h)+1))/a),e.splice(0,1)}return r}async function aroon_down(n,t){for(var a=t||10,e=[],r=[],l=0;l<n.length;l++)if(e.push(n[l]),e.length>=a){var s=e.slice(0);s.sort((n,t)=>n-t);var h=s[0];r.push(100*(a-(e.findIndex(n=>n==h)+1))/a),e.splice(0,1)}return r}async function aroon_osc(n,t){for(var a=t||25,e=[],r=await aroon.up(n,a),l=await aroon.down(n,a),s=0;s<r.length;s++)e.push(r[s]-l[s]);return e}async function mfi(n,t){for(var a=t||14,e=[],r=[],l=[],s=0;s<n.length;s++)if(l.push(n[s][0]),r.push(n[s][1]),l.length>=a){var h=0,u=0;for(q in l)h+=l[q];for(q in r)u+=r[q];e.push(100-100/(1+h/u)),l.splice(0,1),r.splice(0,1)}return e}async function roc(n,t){for(var a=t||14,e=[],r=[],l=0;l<n.length;l++)e.push(n[l]),e.length>=a&&(r.push((e[a-1]-e[0])/e[0]),e.splice(0,1));return r}async function obv(n){for(var t=[0],a=1;a<n.length;a++)n[a][1]>n[a-1][1]&&t.push(t[t.length-1]+n[a][0]),n[a][1]<n[a-1][1]&&t.push(t[t.length-1]-n[a][0]),n[a][1]==n[a-1][1]&&t.push(t[t.length-1]);return t}async function vwap(n,t){for(var a=!t||t>n.length?n.length:t,e=[],r=[],l=0;l<n.length;l++)if(e.push([n[l][0]*n[l][1],n[l][1]]),e.length>=a){for(var s=0,h=0,u=0;u<e.length;u++)s+=e[u][1],h+=e[u][0];r.push(h/s),e.splice(0,1)}return r}async function mom(n,t,a){for(var e=t||10,r=[],l=e-1;l<n.length;l++)a?r.push(n[l]/n[l-(e-1)]*100):r.push(n[l]-n[l-(e-1)]);return r}const aroon={up:aroon_up,down:aroon_down,osc:aroon_osc};
