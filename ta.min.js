/* ta.js (c) Nino Kroesen. MIT License. */ async function median(a,n){for(var t=n||a.length,e=[],r=[],s=0;s<a.length;s++)if(e.push(a[s]),e.length>=t){var l=e.slice();l.sort((a,n)=>a>n?-1:a<n?1:0),r.push(l[Math.round(l.length/2)]),e.splice(0,1)}return r}async function kmeans(a,n){var t,e=[],r=[],s=[],l=!1,h=Math.round(a.length/(n+1));for(i=0;i<n;i++)r[i]=a[h*(i+1)];do{for(i=0;i<n;i++)e[i]=[];for(l=!1,x=0;x<a.length;x++){var o=-1;for(y=0;y<n;y++){var u=Math.abs(r[y]-a[x]);-1==o?(o=u,t=y):u<=o&&(o=u,t=y)}e[t].push(a[x])}for(s=r,x=0;x<n;x++){var p=0;for(y=0;y<e[x].length;y++)p+=e[x][y];var c=p/e[t].length;r[x]=c}for(x=0;x<n;x++)r[x]!=s[x]&&(l=!0)}while(l);return e}async function mad(a,n){for(var t=n||a.length,e=[],r=t;r<=a.length;r++){var s=a.slice(r-t,r),l=await median(s.slice()),h=s.map(a=>Math.abs(a-l[l.length-1]));h=await median(h),e.push(h[h.length-1])}return e}async function aad(a,n){for(var t=n||a.length,e=[],r=t;r<=a.length;r++){var s=a.slice(r-t,r),l=0,h=await sma(s.slice(),t);for(q in s)l+=Math.abs(s[q]-h[h.length-1]);e.push(l/t)}return e}async function ssd(a,n){for(var t=n||a.length,e=[],r=t;r<a.length;r++){var s=await sma(a.slice(r-t,r),t),l=a.slice(r-t,r),h=0;for(let a in l)h+=(l[a]-s[s.length-1])**2;e.push(Math.sqrt(h))}return e}async function rsi(a,n){for(var t=n||14,e=[],r=[],s=1;s<a.length;s++)if(e.push(a[s]-a[s-1]),e.length>=t){var l=0,h=0;for(q in e)e[q]<0&&(h+=Math.abs(e[q])),e[q]>=0&&(l+=e[q]);rsi=Number(100-100/(1+l/t/(h/t))),r.push(rsi),e.splice(0,1)}return r}async function tsi(a,n,t,e){for(var r=n||25,s=t||13,l=e||13,h=[],o=[],i=[],u=[],p=1;p<a.length;p++)h.push(a[p]-a[p-1]),o.push(Math.abs(a[p]-a[p-1]));var c=await ema(h,r),m=await ema(o,r),f=await ema(c,s),g=await ema(m,s);for(p=0;p<f.length;p++)i.push(f[p]/g[p]);var v=await ema(i,l);i.splice(0,i.length-v.length);for(p=0;p<v.length;p++)u.push([v[p],i[p]]);return u}async function bop(a,n){for(var t=[],e=(n=n||14,0);e<a.length;e++)t.push((a[e][3]-a[e][0])/(a[e][1]-a[e][2]));return t=await sma(t,n)}async function fi(a,n){for(var t=n||13,e=[],r=[],s=1;s<a.length;s++)if(e.push(a[s][0]-a[s-1][0]),e.length>=t){var l=await ema(e.slice(),t);r.push((a[s][0]-a[s-1][0])*l[0]),e.splice(0,1)}return r}async function asi(a){for(var n=[],t=1;t<a.length;t++){var e,r=a[t][1],s=a[t-1][1],l=a[t][0],h=a[t-1][0],o=a[t][2],i=a[t-1][2],u=h-r>i-r?h-r:i-r,p=a[t][0],c=a[t-1][0],m=Math.max(a[t][0],a[t-1][0])-Math.min(a[t][2],a[t-1][2]);l-s>o-s&&l-s>l-o&&(e=l-s-(o-s)/2+(s-c)/4),o-s>l-s&&o-s>l-o&&(e=o-s-(l-s)/2+(s-c)/4),l-o>l-s&&l-o>o-s&&(e=l-o+(s-c)/4),n.push((s-r+(s-c)/2+(r-p)/2)/e*50*u/m)}return n}async function ao(a,n,t){for(var e=n||5,r=t||35,s=[],l=[],h=0;h<a.length;h++)if(s.push((a[h][0]+a[h][1])/2),s.length>=r){var o=await sma(s.slice(),e),i=await sma(s.slice(),r);l.push(o[o.length-1]-i[i.length-1]),s.splice(0,1)}return l}async function pr(a,n){for(var t=n||14,e=[],r=[],s=0;s<a.length;s++)if(r.push(a[s]),r.length>=t){var l=await Math.max.apply(null,r),h=await Math.min.apply(null,r);e.push((l-a[s])/(l-h)*-100),r.splice(0,1)}return e}async function lsma(a,n){for(var t=n||25,e=[],r=[],s=0;s<a.length;s++)if(e.push(a[s]),e.length>=t){for(var l,h,o=0,i=0,u=0,p=0,c=1;c<=t;c++)o+=c,i+=e[c-1],u+=e[c-1]*c,p+=c*c,e[c-1]*e[c-1];h=i/t-(l=(u-o*i/t)/(p-o*o/t))*o/t,r.push(l*t+h),e.splice(0,1)}return r}async function don(a,n){for(var t=[],e=[],r=n||20,s=0;s<a.length;s++)if(t.push(a[s]),t.length>=r){var l=[],h=[];for(let a in t)l.push(t[a][0]),h.push(t[a][1]);var o=Math.max.apply(null,l.slice()),i=Math.min.apply(null,h.slice());e.push([o,(o+i)/2,i]),t.splice(0,1)}return e}async function ichimoku(a,n,t,e,r){for(var s=[],l=n||9,h=t||26,o=e||52,i=r||26,u=[],p=[],c=0;c<a.length;c++)if(s.push(a[c]),s.length>o){var m=[],f=[];for(let a in s)m.push(s[a][0]),f.push(s[a][2]);var g=(Math.max.apply(null,m.slice(m.length-1-l,m.length-1))+Math.min.apply(null,f.slice(f.length-1-l,f.length-1)))/2,v=(Math.max.apply(null,m.slice(m.length-1-h,m.length-1))+Math.min.apply(null,f.slice(f.length-1-h,f.length-1)))/2,d=a[c][1]+v,w=(Math.max.apply(null,m.slice(m.length-1-o,m.length-1))+Math.min.apply(null,f.slice(f.length-1-h,f.length-1)))/2;chik=a[c][1],p.push([g,v,d,w,chik]),s.splice(0,1)}for(c=i;c<p.length-i;c++)u.push([p[c][0],p[c][1],p[c+(i-1)][2],p[c+(i-1)][3],p[c+i-1][4]]);return u}async function stoch(a,n,t,e){var r=n||14,s=t||3,l=e||3;r<s&&([r,s]=[s,r]),l>s&&([l,s]=[s,l]);for(var h=[],o=[],i=[],u=[],p=0;p<a.length;p++){if(o.push(a[p][0]),i.push(a[p][2]),o.length>=r){var c=await Math.max.apply(null,o),m=await Math.min.apply(null,i),f=100*(a[p][1]-m)/(c-m);u.push(f)}if(l>0&&u.length>l){var g=await sma(u,l);u.push(g[g.length-1])}if(u.length-l>=s){var v=await sma(u.slice(),s);h.push([f,v[v.length-1]]),o.splice(0,1),i.splice(0,1),u.splice(0,1)}}return h}async function atr(a,n){for(var t=n||14,e=[a[0][0]-a[0][2]],r=1;r<a.length;r++){var s=await Math.max(a[r][0]-a[r-1][1],a[r][2]-a[r-1][1],a[r][0]-a[r][2]);e.push((e[e.length-1]*(t-1)+s)/t)}return e}async function sma(a,n){for(var t=n||14,e=[],r=[],s=0;s<a.length;s++)if(e.push(a[s]),e.length>=t){var l=0;for(q in e)l+=e[q];r.push(l/t),e.splice(0,1)}return r}async function smma(a,n){for(var t=n||14,e=[],r=[],s=0;s<a.length;s++)if(e.push(a[s]),e.length>=t){var l=0;for(q in e)l+=e[q];r.length<=0?r.push(l/t):r.push((l-r[r.length-1])/t),e.splice(0,1)}return r.splice(0,1),r}async function wma(a,n){for(var t=n||14,e=0,r=[],s=[],l=1;l<=t;l++)e+=l;for(l=0;l<a.length;l++)if(r.push(a[l]),r.length>=t){var h=0;for(q in r)h+=r[q]*(Number(q)+1)/e;s.push(h),r.splice(0,1)}return s}async function pwma(a,n){for(var t=0,e=[],r=[],s=n||14,l=s/2,h=n;l>=1;l--,h--)l%1!=0?t+=(l=Math.round(l))*h:(r.push(l*h),t+=l*h*2),r.unshift(l*h);for(l=s;l<=a.length;l++){for(var o=0,i=a.slice(l-s,l),u=s-1;u>=0;u--)o+=i[u]*r[u]/t;e.push(o)}return e}async function hwma(a,n){for(var t=0,e=[],r=[],s=n||14,l=1,h=s;l<=s/2;l++,h--)l%1!=0?t+=(l=Math.round(l))*h:(r.push(l*h),t+=l*h*2),r.unshift(l*h);for(l=s;l<=a.length;l++){for(var o=0,i=a.slice(l-s,l),u=s-1;u>=0;u--)o+=i[u]*r[u]/t;e.push(o)}return e}async function vwma(a,n){for(var t=n||20,e=[],r=[],s=0;s<a.length;s++)if(e.push([a[s][0]*a[s][1],a[s][1]]),e.length>=t){for(var l=0,h=0,o=0;o<e.length;o++)l+=e[o][1],h+=e[o][0];r.push(h/l),e.splice(0,1)}return r}async function ema(a,n){for(var t=n||12,e=[],r=[],s=2/(t+1),l=0;l<a.length;l++)if(e.push(a[l]),e.length>=t){if(r.length>0){r.push((a[l]-r[r.length-1])*s+r[r.length-1]);continue}var h=0;for(q in e)h+=e[q];r.push(h/t)}return r}async function hull(a,n){var t=n||14,e=[],r=[],s=await wma(a.slice(),t),l=Math.round(Math.sqrt(t)),h=await wma(a.slice(),Math.round(t/2));h.splice(0,h.length-s.length);for(let a in s)if(e.push(2*h[a]-s[a]),e.length>=l){var o=await wma(e,l);r.push(o[o.length-1])}return r}async function kama(a,n,t,e){n=n||10,t=t||2,e=e||30;for(var r=[(r=await sma(a.slice(),n))[r.length-1]],s=n+1;s<a.length;s++){for(var l=0,h=Math.abs(a[s]-a[s-n]),o=1;o<n;o++)l+=Math.abs(a[s-o]-a[s-o-1]);var i=(h/l*(2/(t+1)-2/(e+1)+2/(e+1)))**2;r.push(r[r.length-1]+i*(a[s]-r[r.length-1]))}return r}async function macd(a,n,t){var e=n||12,r=t||26;e>r&&([e,r]=[r,e]);var s=await ema(a,e),l=await ema(a,r);s.splice(0,r-e);for(var h=[],o=0;o<l.length;o++)h.push(s[o]-l[o]);return h}async function bands(a,n,t){for(var e=n||14,r=t||1,s=[],l=[],h=[],o=await sma(a,e),i=0;i<a.length;i++)if(s.push(a[i]),s.length>=e){var u=await std(s,e);l.push(u),s.splice(0,1)}for(i=0;i<o.length;i++)h.push([o[i]+l[i]*r,o[i],o[i]-l[i]*r]);return h}async function bandwidth(a,n,t){for(var e=n||14,r=t||1,s=[],l=await bands(a.slice(),e,r),h=0;h<l.length;h++)s.push((l[h][0]-l[h][2])/l[h][1]);return s}async function keltner(a,n,t){var e,r=n||14,s=t||1,l=[],h=await atr(a,r),o=[];for(var i in a)l.push((a[i][0]+a[i][1]+a[i][2])/3);e=await sma(l,r),h.splice(0,r-1);for(i=0;i<e.length;i++)o.push([e[i]+h[i]*s,e[i],e[i]-h[i]*s]);return o}async function variance(a,n){for(var t=n||a.length,e=[],r=t;r<=a.length;r++){var s=a.slice(r-t,r),l=await sma(s.slice(),t),h=0;for(x in s)h+=(s[x]-l[l.length-1])**2;e.push(h/t)}return e}async function std(a,n){var t=n||a.length,e=a.reduce((a,n)=>Number(a)+Number(n))/t;return Math.sqrt(a.reduce((a,n)=>a+Math.pow(n-e,2),0)/t)}async function cor(a,n){for(var t=await sma(a.slice(),a.length),e=await sma(n.slice(),n.length),r=0,s=0,l=0,h=0;h<a.length;h++){var o=a[h]-t,i=n[h]-e;r+=o*i,s+=Math.pow(o,2),l+=Math.pow(i,2)}var u=a.length-1;return s/=u,l/=u,r/(u*(s=Math.sqrt(s))*(l=Math.sqrt(l)))}async function dif(a,n){return(a-n)/n}async function aroon_up(a,n){for(var t=n||10,e=[],r=[],s=0;s<a.length;s++)if(e.push(a[s]),e.length>=t){var l=e.slice(0);l.sort((a,n)=>a-n);var h=l[t-1];r.push(100*(t-(e.findIndex(a=>a==h)+1))/t),e.splice(0,1)}return r}async function aroon_down(a,n){for(var t=n||10,e=[],r=[],s=0;s<a.length;s++)if(e.push(a[s]),e.length>=t){var l=e.slice(0);l.sort((a,n)=>a-n);var h=l[0];r.push(100*(t-(e.findIndex(a=>a==h)+1))/t),e.splice(0,1)}return r}async function aroon_osc(a,n){for(var t=n||25,e=[],r=await aroon.up(a,t),s=await aroon.down(a,t),l=0;l<r.length;l++)e.push(r[l]-s[l]);return e}async function mfi(a,n){for(var t=n||14,e=[],r=[],s=[],l=0;l<a.length;l++)if(s.push(a[l][0]),r.push(a[l][1]),s.length>=t){var h=0,o=0;for(q in s)h+=s[q];for(q in r)o+=r[q];e.push(100-100/(1+h/o)),s.splice(0,1),r.splice(0,1)}return e}async function roc(a,n){for(var t=n||14,e=[],r=[],s=0;s<a.length;s++)e.push(a[s]),e.length>=t&&(r.push((e[t-1]-e[0])/e[0]),e.splice(0,1));return r}async function cop(a,n,t,e){n=n||11,t=t||14,e=e||10,max=Math.max(n,t),co=[];for(var r=max+e;r<a.length;r++){var s=a.slice(r-(max+e),r),l=a.slice(r-(max+e),r),h=[];s=await roc(s,n),l=await roc(l,t),s.splice(0,s.length-l.length),l.splice(0,l.length-s.length);for(var o=0;o<s.length;o++)h.push(s[o]+l[o]);h=await wma(h.slice(),e),co.push(h[h.length-1])}return co}async function kst(a,n,t,e,r,s,l,h,o,i){n=n||10,t=t||15,e=e||20,r=r||30,s=s||10,l=l||10,h=h||10,o=o||15,i=i||9;for(var u=[],p=[],c=Math.max(n,t,e,r)+Math.max(s,l,h,o),m=c;m<a.length;m++){var f=await roc(a.slice(m-c,m),n),g=await roc(a.slice(m-c,m),t),v=await roc(a.slice(m-c,m),e),d=await roc(a.slice(m-c,m),r);f=await sma(f,s),g=await sma(g,l),v=await sma(v,h),d=await sma(d,o),u.push(f[f.length-1]+g[g.length-1]+v[v.length-1]+d[d.length-1])}var w=await sma(u.slice(),i);for(var m in u.splice(0,u.length-w.length),w)p.push([u[m],w[m]]);return p}async function obv(a){for(var n=[0],t=1;t<a.length;t++)a[t][1]>a[t-1][1]&&n.push(n[n.length-1]+a[t][0]),a[t][1]<a[t-1][1]&&n.push(n[n.length-1]-a[t][0]),a[t][1]==a[t-1][1]&&n.push(n[n.length-1]);return n}async function vwap(a,n){for(var t=!n||n>a.length?a.length:n,e=[],r=[],s=0;s<a.length;s++)if(e.push([a[s][0]*a[s][1],a[s][1]]),e.length>=t){for(var l=0,h=0,o=0;o<e.length;o++)l+=e[o][1],h+=e[o][0];r.push(h/l),e.splice(0,1)}return r}async function mom(a,n,t){for(var e=n||10,r=[],s=e-1;s<a.length;s++)t?r.push(a[s]/a[s-(e-1)]*100):r.push(a[s]-a[s-(e-1)]);return r}async function mom_osc(a,n){for(var t=n||9,e=[],r=[],s=0;s<a.length;s++)if(e.push(a[s]),e.length>t){for(var l=0,h=0,o=1;o<t;o++)e[o-1]<e[o]?l+=e[o]:h+=e[o];r.push((l-h)/(l+h)*100),e.splice(0,1)}return r}async function ha(a){for(var n=[[(Number(a[0][0])+Number(a[0][3]))/2,Number(a[0][1]),Number(a[0][2]),(Number(a[0][0])+Number(a[0][1])+Number(a[0][2])+Number(a[0][3]))/4]],t=1;t<a.length;t++)n.push([(n[n.length-1][0]+n[n.length-1][3])/2,Math.max(n[n.length-1][0],n[n.length-1][3],a[t][1]),Math.min(n[n.length-1][0],n[n.length-1][3],a[t][2]),(a[t][0]+a[t][1]+a[t][2]+a[t][3])/4]);return n}async function ren(a,n){for(var t=[],e=(n=n||1,Math.floor(n)==n?0:n.toString().split(".")[1].length||0),r=Math.ceil(a[0][0]/n*10**e)/10**e*n,s=r-n,l=1;l<a.length;l++){if(a[l][0]>r+n)do{t.push([r,r+n,r,r+n]),r+=n,s+=n}while(a[l][0]>r+n);if(a[l][1]<s-n)do{t.push([s,s,s-n,s-n]),r-=n,s-=n}while(a[l][1]<s-n)}return t}const aroon={up:aroon_up,down:aroon_down,osc:aroon_osc};
