/* ta.js (c) Nino Kroesen. MIT License. */ async function median(e,t=e.length){for(var n=t,a=[];n<=e.length;n++){var l=e.slice(n-t,n);l.sort((e,t)=>e-t),a.push(l[Math.round(l.length/2)-1])}return a}async function kmeans(e,t){var n,a=[],l=[],r=[],h=!1,s=Math.round(e.length/(t+1));for(i=0;i<t;i++)l[i]=e[s*(i+1)];do{for(i=0;i<t;i++)a[i]=[];for(x=0;x<e.length;x++){var u=-1;for(y=0;y<t;y++){var o=Math.abs(l[y]-e[x]);-1===u?(u=o,n=y):o<=u&&(u=o,n=y)}a[n].push(e[x])}for(r=l,x=0;x<t;x++){var p=0;for(y=0;y<a[x].length;y++)p+=a[x][y];var c=p/a[n].length;l[x]=c}for(x=0;x<t;x++)l[x]!==r[x]&&(h=!0)}while(h);return a}async function normalize(e,t=0){for(var n=0,a=await Math.max.apply(null,e.slice())*(1+t),l=await Math.min.apply(null,e.slice())*(1-t),r=[];n<e.length;n++)r.push(1-(a-e[n])/(a-l));return r}async function denormalize(e,t,n=0){for(var a=0,l=await Math.max.apply(null,e.slice())*(1+n),r=await Math.min.apply(null,e.slice())*(1-n),h=[];a<t.length;a++)h.push(r+t[a]*(l-r));return h}async function normalize_pair(e,t){for(var n=1,a=(e[0]+t[0])/2,l=[[a,a]];n<e.length;n++)l.push([l[l.length-1][0]*((e[n]-e[n-1])/e[n-1]+1),l[l.length-1][1]*((t[n]-t[n-1])/t[n-1]+1)]);return l}async function normalize_from(e,t){for(var n=1,a=[t];n<e.length;n++)a.push(a[a.length-1]*((e[n]-e[n-1])/e[n-1]+1));return a}async function standardize(e){for(var t=await sma(e,e.length),n=await std(e),a=[],l=0;l<e.length;l++)a.push((e[l]-t[0])/n);return a}async function mad(e,t=e.length){for(var n=t,a=[];n<=e.length;n++){var l=e.slice(n-t,n),r=await median(l),h=l.map(e=>Math.abs(e-r[r.length-1]));h=await median(h),a.push(h[h.length-1])}return a}async function aad(e,t=e.length){for(var n=t,a=[];n<=e.length;n++){var l=e.slice(n-t,n),r=0,h=await sma(l,t);for(q in l)r+=Math.abs(l[q]-h[h.length-1]);a.push(r/t)}return a}async function ssd(e,t=e.length){for(var n=t,a=[];n<=e.length;n++){var l=e.slice(n-t,n),r=await sma(l,t),h=0;for(let e in l)h+=(l[e]-r[r.length-1])**2;a.push(Math.sqrt(h))}return a}async function er(e){var t=[],n=[],a=1,l=1;for(let a in e)e[a]>=0?t.push(1+e[a]):n.push(1+e[a]);var r=t.length/e.length,h=n.length/e.length;for(let e in n)l*=n[e];for(let e in t)a*=t[e];return(100*(a**(1/t.length)-1)*r+100*(l**(1/n.length)-1)*h)/100}async function ar(e,t=e.length){for(var n=t,a=[];n<e.length;n++){var l=await er(e.slice(n-t,n));a.push(e[n]-l)}return a}async function kelly(e){var t=await er(e)+1,n=await winratio(e);return n-(1-n)/t}async function winratio(e){var t=0,n=0;for(let a in e)e[a]>=0?t++:n++;return t/(n+t)}async function avgwin(e){for(var t=0,n=[];t<e.length;t++)e[t]>=0&&n.push(e[t]);return(await sma(n,n.length))[0]}async function avgloss(e){for(var t=[],n=0;n<e.length;n++)e[n]<0&&t.push(e[n]);return(await sma(t,t.length))[0]}async function zscore(e,t=e.length){for(var n=t-1,a=[],l=e.slice(0,t-1);n<e.length;n++){l.push(e[n]);var r=await sma(l,t),h=await std(l,t);a.push((e[n]-r[0])/h),l.splice(0,1)}return a}async function rsi(e,t=14){for(var n=t-1,a=0,l=0,r=[],h=e.slice(0,t-1);n<e.length;n++,a=0,l=0){h.push(e[n]);for(var s=1;s<h.length;s++)h[s]-h[s-1]<0?l+=Math.abs(h[s]-h[s-1]):a+=h[s]-h[s-1];var u=100-100/(1+a/t/(l/t));r.push(u),h.splice(0,1)}return r}async function wrsi(e,t=14){for(var n=1,a=[],l=[],r=[];n<e.length;n++)e[n]-e[n-1]<0?(r.push(Math.abs(e[n]-e[n-1])),l.push(0)):(r.push(0),l.push(e[n]-e[n-1]));r=await wsma(r,t),l=await wsma(l,t);for(let e in r)a.push(100-100/(1+l[e]/r[e]));return a}async function tsi(e,t=25,n=13,a=13){for(var l=1,r=[],h=[],s=[],u=[];l<e.length;l++)r.push(e[l]-e[l-1]),h.push(Math.abs(e[l]-e[l-1]));var o=await ema(r,t),i=await ema(h,t),p=await ema(o,n),c=await ema(i,n);for(l=0;l<p.length;l++)s.push(p[l]/c[l]);var g=await ema(s,a);s.splice(0,s.length-g.length);for(l=0;l<g.length;l++)u.push([g[l],s[l]]);return u}async function bop(e,t=14){var n=e.map(e=>(e[3]-e[0])/(e[1]-e[2]));return n=await sma(n,t)}async function fi(e,t=13){for(var n=1,a=[],l=[];n<e.length;n++)if(a.push((e[n][0]-e[n-1][0])*e[n][1]),a.length>=t){var r=await ema(a,t);l.push(r[r.length-1]),a.splice(0,1)}return l}async function asi(e){for(var t=1,n=[];t<e.length;t++){var a,l=e[t][1],r=e[t-1][1],h=e[t][0],s=e[t-1][0],u=e[t][2],o=e[t-1][2],i=s-l>o-l?s-l:o-l,p=e[t][0],c=e[t-1][0],g=Math.max(e[t][0],e[t-1][0])-Math.min(e[t][2],e[t-1][2]);h-r>u-r&&h-r>h-u&&(a=h-r-(u-r)/2+(r-c)/4),u-r>h-r&&u-r>h-u&&(a=u-r-(h-r)/2+(r-c)/4),h-u>h-r&&h-u>u-r&&(a=h-u+(r-c)/4),n.push((r-l+(r-c)/2+(l-p)/2)/a*50*i/g)}return n}async function ao(e,t=5,n=35){e=e.map(e=>(e[0]+e[1])/2);for(var a=n,l=[];a<=e.length;a++){var r=e.slice(a-n,a),h=await sma(r,t),s=await sma(r,n);l.push(h[h.length-1]-s[s.length-1])}return l}async function ac(e,t=5,n=35){var a=await ao(e,t,n),l=await sma(a,t),r=[];a.length>l.length?a.splice(0,a.length-l.length):l.splice(0,l.length-a.length);for(let e in a)r.push(a[e]-l[e]);return r}const fib=async(e,t)=>[e,.236*(t-e)+e,.382*(t-e)+e,.5*(t-e)+e,.618*(t-e)+e,.786*(t-e)+e,t,1.618*(t-e)+e,2.618*(t-e)+e,3.618*(t-e)+e,4.236*(t-e)+e];async function pr(e,t=14){for(var n=t,a=[];n<=e.length;n++){var l=e.slice(n-t,n),r=await Math.max.apply(null,l),h=await Math.min.apply(null,l);a.push((r-e[n-1])/(r-h)*-100)}return a}async function lsma(e,t=25){for(var n=t,a=[];n<=e.length;n++){for(var l,r,h=e.slice(n-t,n),s=0,u=0,o=0,i=0,p=1;p<=t;p++)s+=p,u+=h[p-1],o+=h[p-1]*p,i+=p*p,h[p-1]*h[p-1];r=u/t-(l=(o-s*u/t)/(i-s*s/t))*s/t,a.push(l*t+r)}return a}async function don(e,t=20){for(var n=t,a=[];n<=e.length;n++){var l=e.slice(n-t,n),r=[],h=[];for(let e in l)r.push(l[e][0]),h.push(l[e][1]);var s=Math.max.apply(null,r.slice()),u=Math.min.apply(null,h.slice());a.push([s,(s+u)/2,u])}return a}async function ichimoku(e,t=9,n=26,a=52,l=26){for(var r=0,h=[],s=[],u=[];r<e.length;r++)if(h.push(e[r]),h.length>=a){var o=[],i=[];for(let e in h)o.push(h[e][0]),i.push(h[e][2]);var p=(Math.max.apply(null,o.slice(o.length-t,o.length))+Math.min.apply(null,i.slice(i.length-t,i.length)))/2,c=(Math.max.apply(null,o.slice(o.length-n,o.length))+Math.min.apply(null,i.slice(i.length-n,i.length)))/2,g=e[r][1]+c,m=(Math.max.apply(null,o.slice(o.length-a,o.length))+Math.min.apply(null,i.slice(i.length-n,i.length)))/2;chik=e[r][1],u.push([p,c,g,m,chik]),h.splice(0,1)}for(r=l;r<u.length-l;r++)s.push([u[r][0],u[r][1],u[r+l][2],u[r+l][3],u[r-l][4]]);return s}async function stoch(e,t=14,n=3,a=3){t<n&&([t,n]=[n,t]),a>n&&([a,n]=[n,a]);for(var l=0,r=[],h=[],s=[],u=[];l<e.length;l++){if(h.push(e[l][0]),s.push(e[l][2]),h.length>=t){var o=await Math.max.apply(null,h),i=await Math.min.apply(null,s),p=100*(e[l][1]-i)/(o-i);u.push(p)}if(a>0&&u.length>a){var c=await sma(u,a);u.push(c[c.length-1])}if(u.length-a>=n){var g=await sma(u,n);r.push([p,g[g.length-1]]),h.splice(0,1),s.splice(0,1),u.splice(0,1)}}return r}async function atr(e,t=14){for(var n=1,a=[e[0][0]-e[0][2]];n<e.length;n++){var l=await Math.max(e[n][0]-e[n-1][1],e[n][2]-e[n-1][1],e[n][0]-e[n][2]);a.push((a[a.length-1]*(t-1)+l)/t)}return a}async function sma(e,t=14){for(var n=t,a=[];n<=e.length;n++){let l=await sum(e.slice(n-t,n));a.push(l/t)}return a}async function smma(e,t=14){for(var n=t,a=[];n<=e.length;n++){var l=e.slice(n-t,n),r=0;for(q in l)r+=l[q];a.length<=0?a.push(r/t):a.push((r-a[a.length-1])/t)}return a.splice(0,1),a}async function wma(e,t=14){for(var n=1,a=0,l=[];n<=t;n++)a+=n;for(n=t;n<=e.length;n++){var r=e.slice(n-t,n),h=0;for(q in r)h+=r[q]*(Number(q)+1)/a;l.push(h)}return l}async function wsma(e,t=14){for(var n=t,a=[],l=1/t;n<=e.length;n++)if(a.length>0)a.push((e[n-1]-a[a.length-1])*l+a[a.length-1]);else{var r=e.slice(n-t,n),h=0;for(q in r)h+=r[q];a.push(h/t)}return a}async function pwma(e,t=14){for(var n=t/2,a=t,l=0,r=[],h=[];n>=1;n--,a--)n%1!=0?l+=(n=Math.round(n))*a:(h.push(n*a),l+=n*a*2),h.unshift(n*a);for(n=t;n<=e.length;n++){for(var s=0,u=e.slice(n-t,n),o=t-1;o>=0;o--)s+=u[o]*h[o]/l;r.push(s)}return r}async function hwma(e,t=14){for(var n=1,a=t,l=0,r=[],h=[];n<=t/2;n++,a--)n%1!=0?l+=(n=Math.round(n))*a:(h.push(n*a),l+=n*a*2),h.unshift(n*a);for(n=t;n<=e.length;n++){for(var s=0,u=e.slice(n-t,n),o=t-1;o>=0;o--)s+=u[o]*h[o]/l;r.push(s)}return r}async function vwma(e,t=20){e=e.map(e=>[e[0]*e[1],e[1]]);for(var n=t,a=[];n<=e.length;n++){for(var l=e.slice(n-t,n),r=0,h=0,s=0;s<l.length;s++)r+=l[s][1],h+=l[s][0];a.push(h/r)}return a}async function ema(e,t=12){for(var n=t,a=[],l=2/(t+1);n<=e.length;n++)if(a.length>0)a.push((e[n-1]-a[a.length-1])*l+a[a.length-1]);else{var r=e.slice(n-t,n),h=0;for(q in r)h+=r[q];a.push(h/t)}return a}async function hull(e,t=14){var n=[],a=[],l=await wma(e,t),r=Math.round(Math.sqrt(t)),h=await wma(e,Math.round(t/2));h.splice(0,h.length-l.length);for(let e in l)if(n.push(2*h[e]-l[e]),n.length>=r){var s=await wma(n,r);a.push(s[0]),n.splice(0,1)}return a}async function kama(e,t=10,n=2,a=30){for(var l=t+1,r=[(r=await sma(e,t))[r.length-1]];l<e.length;l++){for(var h=0,s=Math.abs(e[l]-e[l-t]),u=1;u<t;u++)h+=Math.abs(e[l-u]-e[l-u-1]);var o=(s/h*(2/(n+1)-2/(a+1)+2/(a+1)))**2;r.push(r[r.length-1]+o*(e[l]-r[r.length-1]))}return r}async function macd(e,t=12,n=26){t>n&&([t,n]=[n,t]);var a=await ema(e,t),l=await ema(e,n),r=[];a.splice(0,n-t);for(var h=0;h<l.length;h++)r.push(a[h]-l[h]);return r}async function macd_signal(e,t=12,n=26,a=9){let l=await macd(e,t,n);return await ema(l,a)}async function macd_bars(e,t=12,n=26,a=9){var l=await macd(e,t,n),r=await ema(l,a),h=[];l.splice(0,l.length-r.length);for(let e in l)h.push(l[e]-r[e]);return h}async function bands(e,t=14,n=1){for(var a=0,l=[],r=[],h=[],s=await sma(e,t);a<e.length;a++)if(l.push(e[a]),l.length>=t){var u=await std(l,t);r.push(u),l.splice(0,1)}for(a=0;a<s.length;a++)h.push([s[a]+r[a]*n,s[a],s[a]-r[a]*n]);return h}async function bandwidth(e,t=14,n=1){for(var a=0,l=[],r=await bands(e,t,n);a<r.length;a++)l.push((r[a][0]-r[a][2])/r[a][1]);return l}async function keltner(e,t=14,n=1){var a,l=[],r=await atr(e,t),h=[];for(let t in e)l.push((e[t][0]+e[t][1]+e[t][2])/3);a=await sma(l,t),r.splice(0,t-1);for(var s=0;s<a.length;s++)h.push([a[s]+r[s]*n,a[s],a[s]-r[s]*n]);return h}async function variance(e,t=e.length){for(var n=t,a=[];n<=e.length;n++){var l=e.slice(n-t,n),r=await sma(l,t),h=0;for(x in l)h+=(l[x]-r[r.length-1])**2;a.push(h/t)}return a}async function std(e,t=e.length){var n=e.reduce((e,t)=>Number(e)+Number(t))/t;return Math.sqrt(e.reduce((e,t)=>e+Math.pow(t-n,2),0)/t)}async function normsinv(e){var t=-.00778489400243029,n=-.322396458041136,a=-2.40075827716184,l=-2.54973253934373,r=4.37466414146497,h=2.93816398269878,s=.00778469570904146,u=.32246712907004,o=2.445134137143,i=3.75440866190742;if(e<0||e>1)return 0;if(e<.02425)return(((((t*(p=Math.sqrt(-2*Math.log(e)))+n)*p+a)*p+l)*p+r)*p+h)/((((s*p+u)*p+o)*p+i)*p+1);if(e<=.97575){var p,c=(p=e-.5)*p;return(((((-39.6968302866538*c+220.946098424521)*c-275.928510446969)*c+138.357751867269)*c-30.6647980661472)*c+2.50662827745924)*p/(((((-54.4760987982241*c+161.585836858041)*c-155.698979859887)*c+66.8013118877197)*c-13.2806815528857)*c+1)}return-(((((t*(p=Math.sqrt(-2*Math.log(1-e)))+n)*p+a)*p+l)*p+r)*p+h)/((((s*p+u)*p+o)*p+i)*p+1)}async function sim(e,t=50,n=1e3,a){for(var l=0,r=[];l<n;l++){for(var h=e.slice(),s=0;s<t;s++){for(var u=[],o=1;o<h.length;o++){var i=await dif(h[o],h[o-1]);u.push(i)}var p=await sma(u,u.length),c=await std(u),g=await normsinv(Math.random());h.push(h[h.length-1]*Math.exp(p[0]-c*c/2+c*g))}r.push(h)}return a?await percentile(r,a):r}async function percentile(e,t){for(var n=0,a=[];n<e[0].length;n++)e.sort((e,t)=>e[n]-t[n]),a.push(e[Math.round((e.length-1)*t)][n]);return a}async function cor(e,t){for(var n=await sma(e,e.length),a=await sma(t,t.length),l=0,r=0,h=0,s=0;s<e.length;s++){var u=e[s]-n,o=t[s]-a;l+=u*o,r+=Math.pow(u,2),h+=Math.pow(o,2)}var i=e.length-1;return r/=i,h/=i,l/(i*(r=Math.sqrt(r))*(h=Math.sqrt(h)))}const dif=async(e,t)=>(e-t)/t,log=async e=>e.map(e=>Math.log(e)),exp=async e=>e.map(e=>Math.exp(e));async function drawdown(e){for(var t=1,n=e[0],a=e[0],l=0;t<e.length;t++){if(e[t]>n){if(0!=a)(r=await dif(a,n))<l&&(l=r),a=e[t];n=e[t]}e[t]<a&&(a=e[t])}var r;return(r=await dif(a,n))<l&&(l=r),l}async function aroon_up(e,t=10){for(var n=t,a=[];n<=e.length;n++){var l=e.slice(n-t,n),r=l.slice();r.sort((e,t)=>e-t),a.push(100*(t-1-l.reverse().findIndex(e=>e===r[t-1]))/(t-1))}return a}async function aroon_down(e,t=10){for(var n=t,a=[];n<=e.length;n++){var l=e.slice(n-t,n),r=l.slice();r.sort((e,t)=>e-t),a.push(100*(t-1-l.reverse().findIndex(e=>e===r[0]))/(t-1))}return a}async function aroon_osc(e,t=25){for(var n=0,a=[],l=await aroon.up(e,t),r=await aroon.down(e,t);n<l.length;n++)a.push(l[n]-r[n]);return a}async function mfi(e,t=14){for(var n=t,a=[],l=e.map(e=>e[1]),r=e.map(e=>e[0]),h=0,s=0;n<=e.length;n++,h=0,s=0){for(q=n-t;q<n;q++)h+=r[q],s+=l[q];a.push(100-100/(1+h/s))}return a}async function roc(e,t=14){for(var n=t,a=[];n<=e.length;n++)a.push((e[n-1]-e[n-t])/e[n-t]);return a}async function cop(e,t=11,n=14,a=10){for(var l=Math.max(t,n),r=[],h=l+a;h<e.length;h++){var s=e.slice(h-(l+a),h),u=s.slice(),o=[];s=await roc(s,t),u=await roc(u,n),s.splice(0,s.length-u.length),u.splice(0,u.length-s.length);for(var i=0;i<s.length;i++)o.push(s[i]+u[i]);o=await wma(o,a),r.push(o[o.length-1])}return r}async function kst(e,t=10,n=15,a=20,l=30,r=10,h=10,s=10,u=15,o=9){for(var i=[],p=[],c=Math.max(t,n,a,l)+Math.max(r,h,s,u),g=c;g<=e.length;g++){var m=e.slice(g-c,g),f=await roc(m,t),v=await roc(m,n),d=await roc(m,a),x=await roc(m,l);f=await sma(f,r),v=await sma(v,h),d=await sma(d,s),x=await sma(x,u),i.push(f[f.length-1]+v[v.length-1]+d[d.length-1]+x[x.length-1])}var w=await sma(i,o);for(var g in i.splice(0,i.length-w.length),w)p.push([i[g],w[g]]);return p}async function obv(e){for(var t=1,n=[0];t<e.length;t++)e[t][1]>e[t-1][1]&&n.push(n[n.length-1]+e[t][0]),e[t][1]<e[t-1][1]&&n.push(n[n.length-1]-e[t][0]),e[t][1]===e[t-1][1]&&n.push(n[n.length-1]);return n}async function vwap(e,t=e.length){e=e.map(e=>[e[0]*e[1],e[1]]);for(var n=t,a=[];n<=e.length;n++){for(var l=e.slice(n-t,n),r=0,h=0,s=0;s<l.length;s++)r+=l[s][1],h+=l[s][0];a.push(h/r)}return a}async function mom(e,t=10,n){for(var a=t-1,l=[];a<e.length;a++)n?l.push(e[a]/e[a-(t-1)]*100):l.push(e[a]-e[a-(t-1)]);return l}async function mom_osc(e,t=10){for(var n=++t,a=[],l=0,r=0;n<=e.length;n++,l=0,r=0){for(var h=1;h<t;h++)e[n-t+(h-1)]<e[n-t+h]?l+=e[n-t+h]:r+=e[n-t+h];a.push((l-r)/(l+r)*100)}return a}async function ha(e){for(var t=[[(Number(e[0][0])+Number(e[0][3]))/2,Number(e[0][1]),Number(e[0][2]),(Number(e[0][0])+Number(e[0][1])+Number(e[0][2])+Number(e[0][3]))/4]],n=1;n<e.length;n++)t.push([(t[t.length-1][0]+t[t.length-1][3])/2,Math.max(t[t.length-1][0],t[t.length-1][3],e[n][1]),Math.min(t[t.length-1][0],t[t.length-1][3],e[n][2]),(e[n][0]+e[n][1]+e[n][2]+e[n][3])/4]);return t}async function ren(e,t=1){for(var n=[],a=Math.floor(t)===t?0:t.toString().split(".")[1].length||0,l=Math.ceil(e[0][0]/t*10**a)/10**a*t,r=l-t,h=1;h<e.length;h++){if(e[h][0]>l+t)do{n.push([l,l+t,l,l+t]),l+=t,r+=t}while(e[h][0]>l+t);if(e[h][1]<r-t)do{n.push([r,r,r-t,r-t]),l-=t,r-=t}while(e[h][1]<r-t)}return n}async function envelope(e,t=10,n=.005){for(var a=t,l=[];a<e.length;a++){var r=await sma(e.slice(a-t,a),t);l.push([r[0]*(1+n),r[0],r[0]*(1-n)])}return l}async function chaikin_osc(e,t=3,n=10){for(var a=0,l=[],r=[];a<e.length;a++){var h=(e[a][1]-e[a][2]-(e[a][0]-e[a][1]))/(e[a][0]-e[a][2]);isNaN(h)?r.push(0):r.push(h*e[a][3])}var s=await ema(r,t),u=await ema(r,n);s.length>u.length?s.splice(0,s.length-u.length):u.splice(0,u.length-s.length);for(a=0;a<s.length;a++)l.push(s[a]-u[a]);return l}async function fractals(e){for(var t=[[!1,!1],[!1,!1]],n=2;n<e.length-2;n++){var a=e[n-2][0]<e[n][0]&&e[n-1][0]<e[n][0]&&e[n][0]>e[n+1][0]&&e[n][0]>e[n+2][0],l=e[n-2][1]>e[n][1]&&e[n-1][1]>e[n][1]&&e[n][1]<e[n+1][1]&&e[n][1]<e[n+2][1];t.push([a,l])}return t.push([!1,!1],[!1,!1]),t}async function alligator(e,t=13,n=8,a=5,l=8,r=5,h=3){var s=[],u=await smma(e,t),o=await smma(e,n),i=await smma(e,a);o.splice(0,o.length-u.length),i.splice(0,i.length-u.length);for(var p=u.length-1;p>=7;p--)s.push([u[p-(l-1)],o[p-(r-1)],i[p-(h-1)]]);return s}async function gator(e,t=13,n=8,a=5,l=8,r=5,h=3){var s=[],u=await smma(e,t),o=await smma(e,n),i=await smma(e,a);o.splice(0,o.length-u.length),i.splice(0,i.length-u.length);for(var p=u.length-1;p>=l-1;p--)s.push([u[p-(l-1)]-o[p-(r-1)],-Math.abs(o[p-(r-1)]-i[p-(h-1)])]);return s}async function recent_high(e,t=25){for(var n=e.length-2,a=t,l=0,r=e[e.length-1];n>=0&&(e[n]>=r&&a>0?(r=e[n],l=n,a=t):a--,!(a<=0));n--);return{index:l,value:r}}async function recent_low(e,t=25){for(var n=e.length-2,a=t,l=0,r=e[e.length-1];n>=0&&(e[n]<=r&&a>0?(r=e[n],l=n,a=t):a--,!(a<=0));n--);return{index:l,value:r}}async function support(e,t=recent_low(e)){var n,a,l=(t=await t).value;do{for(var r=t.index;r<e.length;r++){var h=(t.value-e[r])/(t.index-r);h<l&&(l=h,n=r)}t.index+1==n&&n!=e.length-1?(t.index=n,l=Math.min.apply(null,e.slice()),t.value=e[t.index],a=!1):a=!0,t.index==e.length-1&&(a=!0)}while(!a);return n==e.length-1||t.index==e.length-1?{calculate:async e=>t.value,slope:0,lowest:t.value,index:t.index}:{calculate:async e=>e*l+t.value,slope:l,lowest:t.value,index:t.index}}async function resistance(e,t){var n,a,l=(t=t||await recent_high(e)).value;do{for(var r=t.index;r<e.length;r++){var h=(e[r]-t.value)/(t.index-r);h<l&&(l=h,n=r)}t.index+1==n&&n!=e.length-1?(t.index=n,l=Math.max.apply(null,e.slice()),t.value=e[t.index],a=!1):a=!0,t.index==e.length-1&&(a=!0)}while(!a);return n==e.length-1||t.index==e.length-1?{calculate:async e=>t.value,slope:0,highest:t.value,index:t.index}:{calculate:async e=>e*-l+t.value,slope:l,highest:t.value,index:t.index}}async function fisher(e,t){var n=[],a=0,l=0;for(let u=t;u<=e.length;u++){var r=e.slice(u-t,u),h=a,s=Math.min.apply(null,r);(l=.66*((e[u-1]-s)/(Math.max.apply(null,r)-s)-.5)+.67*l)>.99&&(l=.999),l<-.99&&(l=-.999),a=.5*Math.log((1+l)/(1-l))+.5*h,n.push([a,h])}return n.slice(1,n.length)}async function cross(e,t){e.splice(0,e.length-t.length);for(var n=e[0]>t[0],a=[],l=0;l<e.length;l++)e[l]<t[l]&&n&&(a.push({index:l,cross:!1}),n=!1),e[l]>t[l]&&!n&&(a.push({index:l,cross:!0}),n=!0);return a}async function se(e,t){return t=t||e.length,await std(e)/t**.5}async function halftrend(e,t,n,a){let l=[],r=[0],h=[0],s=[0],u=[0],o=void 0;for(let c=t;c<=e.length;c++){let g=e.slice(c-t,c);maxlow=g[g.length-2][2],minhigh=g[g.length-2][0],atr2=await atr(g,t),atr2=atr2[atr2.length-1]/2;let m=a*atr2,f=Math.max.apply(null,g.slice(g.length-1,g.length).map(e=>e[0])),v=Math.min.apply(null,g.slice(g.length-1,g.length).map(e=>e[2])),d=await sma(g.slice(g.length-n,g.length).map(e=>e[0]),n),x=await sma(g.slice(g.length-n,g.length).map(e=>e[2]),n);if(1==r[r.length-1]?(maxlow=Math.max(v,maxlow),d[0]<maxlow&&g[g.length-1][1]<g[g.length-2][2]&&(h.push(1),r.push(0),minhigh=g[g.length-2][0])):(minhigh=Math.min(f,minhigh),x[0]>minhigh&&g[g.length-1][1]<g[g.length-2][0]&&(h.push(0),r.push(1),maxlow=v)),0==h[h.length-1]){isNaN(h[h.length-2])||0==h[h.length-2]?s.push(isNaN(s[s.length-2])?maxlow:Math.max(s[s.length-2],maxlow)):s.push(isNaN(u[u.length-2])?u[u.length-1]:u[u.length-2]),o="long";var i=s[s.length-1]+m,p=s[s.length-1]-m}else{isNaN(h[h.length-2])||1==h[h.length-2]?u.push(isNaN(u[u.length-2])?minhigh:Math.min(minhigh,u[u.length-2])):u.push(isNaN(s[s.len-2])?s[s.length-1]:s[s.length-2]),o="short";i=u[u.length-1]+m,p=u[u.length-1]-m}l.push([i,0==h[h.length-1]?s[s.length-1]:u[u.length-1],p,o])}return l}const sum=async e=>e.reduce((e,t)=>e+t);async function covariance(e,t,n){let a=[];await sma(e,e.length),await sma(t,t.length);for(let l=n;l<=e.length;l++){let r=e.slice(l-n,l),h=t.slice(l-n,l),s=await sma(r,n),u=[],o=await sma(h,n);for(let e=0;e<n;e++)u.push((r[e]-s[0])*(h[e]-o[0]));u=await sum(u),a.push(u/n)}return a}const range=(e,t,n)=>Math.floor(n?n()*(Math.floor(t)-Math.ceil(e))+Math.ceil(e):Math.random()*(Math.floor(t)-Math.ceil(e))+Math.ceil(e)),pick=(e,t)=>e[Math.floor(t?t()*Math.floor(e.length):Math.random()*Math.floor(e.length))],float=(e,t,n)=>n?n()*(t-e)+e:Math.random()*(t-e)+e;function prng(e){for(var t=0,n=1779033703^e.length;t<e.length;t++)n=(n=Math.imul(n^e.charCodeAt(t),3432918353))<<13|n>>>19;return n=Math.imul(n^n>>>16,2246822507),n=Math.imul(n^n>>>13,3266489909),e=(n^=n>>>16)>>>0,function(){var t=e+=1831565813;return t=Math.imul(t^t>>>15,1|t),(((t^=t+Math.imul(t^t>>>7,61|t))^t>>>14)>>>0)/4294967296}}async function ncdf(e,t,n){e=t||n?(e-t)/n:e;var a=1/(1+.2315419*Math.abs(e)),l=.3989423*Math.exp(-e*e/2)*a*(.3193815+a*(a*(1.781478+a*(1.330274*a-1.821256))-.3565638));return e>0?1-l:l}async function zigzag(e,t=.05){let n=[],a=1/0,l=-1/0,r=!1,h=!1,s=[];if(Array.isArray(e[0]))for(let s=0;s<e.length;s++)if(r){n[n.length-1].value>=e[s][1]&&(n[n.length-1].value=e[s][1],n[n.length-1].index=s),a>=e[s][1]&&(a=e[s][1]),(e[s][0]-a)/a>t&&(n.push({index:s,value:e[s][0]}),h=!0,r=!1,a=1/0)}else if(h){n[n.length-1].value<=e[s][0]&&(n[n.length-1].value=e[s][0],n[n.length-1].index=s),l<=e[s][1]&&(l=e[s][1]),(l-e[s][1])/e[s][1]>t&&(n.push({index:s,value:e[s][1]}),r=!0,h=!1,l=-1/0)}else{a>=e[s][1]&&(a=e[s][1]),l<=e[s][0]&&(l=e[s][0]);let u=(e[s][0]-a)/a,o=(l-e[s][1])/l;o>t&&u<t?(r=!0,n.push({index:0,value:e[0][0]}),n.push({index:s,value:e[s][1]})):u>t&&o<t?(h=!0,n.push({index:0,value:e[0][1]}),n.push({index:s,value:e[s][0]})):o>u?(r=!0,n.push({index:0,value:e[0][0]}),n.push({index:s,value:e[s][1]})):(h=!0,n.push({index:0,value:e[0][1]}),n.push({index:s,value:e[s][0]}))}else for(let s=0;s<e.length;s++)if(r){n[n.length-1].value>=e[s]&&(n[n.length-1].value=e[s],n[n.length-1].index=s),a>=e[s]&&(a=e[s]),(e[s]-a)/a>t&&(n.push({index:s,value:e[s]}),h=!0,r=!1,a=1/0)}else if(h){n[n.length-1].value<=e[s]&&(n[n.length-1].value=e[s],n[n.length-1].index=s),l<=e[s]&&(l=e[s]),(l-e[s])/e[s]>t&&(n.push({index:s,value:e[s]}),r=!0,h=!1,l=-1/0)}else{a>=e[s]&&(a=e[s]),l<=e[s]&&(l=e[s]);let u=(e[s]-a)/a,o=(l-e[s])/l;o>t&&u<t?(r=!0,n.push({index:0,value:e[0]}),n.push({index:s,value:e[s]})):u>t&&o<t?(h=!0,n.push({index:0,value:e[0]}),n.push({index:s,value:e[s]})):o>u?(r=!0,n.push({index:0,value:e[0]}),n.push({index:s,value:e[s]})):(h=!0,n.push({index:0,value:e[0]}),n.push({index:s,value:e[s]}))}s=[n[0].value];for(let e=1;e<n.length;e++){let t=n[e].index-n[e-1].index,a=(n[e].value-n[e-1].value)/t;for(let l=1;l<=t;l++)s.push(l*a+n[e-1].value)}return s}async function psar(e,t=.02,n=.2){let a=e[0],l=!0,r=t,h=e[0],s=e[0][1],u=e[0][0],o=[s];for(let i=1;i<e.length;i++)s+=r*(u-s),l?(s=Math.min(s,a[1],h[1]),e[i][0]>u&&(u=e[i][0],r=Math.min(r+t,n))):(s=Math.max(s,a[0],h[0]),e[i][1]<u&&(u=e[i][0],r=Math.min(r+t,n))),(l&&e[i][1]<s||!l&&e[i][0]>s)&&(r=t,s=u,u=(l=!l)?e[i][0]:e[i][1]),a=h,h=e[i],o.push(s);return o}const random={range,pick,float,prng};const aroon={up:aroon_up,down:aroon_down,osc:aroon_osc};
