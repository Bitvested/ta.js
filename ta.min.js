/* ta.js (c) Nino Kroesen. MIT License. */ async function median(e,n){for(var t=n||e.length,a=[],r=[],s=0;s<e.length;s++)if(a.push(e[s]),a.length>=t){var l=a.slice();l.sort((e,n)=>e>n?-1:e<n?1:0),r.push(l[Math.round(l.length/2)]),a.splice(0,1)}return r}async function rsi(e,n){for(var t=n||14,a=[],r=[],s=1;s<e.length;s++){var l=e[s]-e[s-1];if(a.push(l),a.length>=t){var h=0,u=0;for(q in a)a[q]<0&&(u+=a[q]),a[q]>=0&&(h+=a[q]);h/=t,u=Math.abs(u)/t,rsi=Number(100-100/(1+h/u)),r.push(rsi),a.splice(0,1)}}return r}async function tsi(e,n,t,a){for(var r=n||25,s=t||13,l=a||13,h=[],u=[],o=[],i=[],p=1;p<e.length;p++)h.push(e[p]-e[p-1]),u.push(Math.abs(e[p]-e[p-1]));var c=await ema(h,r),f=await ema(u,r),g=await ema(c,s),m=await ema(f,s);for(p=0;p<g.length;p++)o.push(g[p]/m[p]);var v=await ema(o,l);o.splice(0,o.length-v.length);for(p=0;p<v.length;p++)i.push([v[p],o[p]]);return i}async function bop(e,n){for(var t=[],a=(n=n||14,0);a<e.length;a++)t.push((e[a][3]-e[a][0])/(e[a][1]-e[a][2]));return t=await sma(t,n)}async function fi(e,n){for(var t=n||13,a=[],r=[],s=1;s<e.length;s++)if(a.push(e[s][0]-e[s-1][0]),a.length>t){var l=await ema(a.slice(),t);r.push((e[s][0]-e[s-1][0])*l[0]),a.splice(0,1)}return ffi}async function asi(e){for(var n=[],t=1;t<e.length;t++){var a,r=e[t][1],s=e[t-1][1],l=e[t][0],h=e[t-1][0],u=e[t][2],o=e[t-1][2],i=h-r>o-r?h-r:o-r,p=e[t][0],c=e[t-1][0],f=Math.max(e[t][0],e[t-1][0])-Math.min(e[t][2],e[t-1][2]);l-s>u-s&&l-s>l-u&&(a=l-s-(u-s)/2+(s-c)/4),u-s>l-s&&u-s>l-u&&(a=u-s-(l-s)/2+(s-c)/4),l-u>l-s&&l-u>u-s&&(a=l-u+(s-c)/4),n.push((s-r+(s-c)/2+(r-p)/2)/a*50*i/f)}return n}async function ao(e,n,t){for(var a=n||5,r=t||35,s=[],l=[],h=0;h<e.length;h++)if(s.push((e[h][0]+e[h][1])/2),s.length>=r){var u=await sma(s.slice(),a),o=await sma(s.slice(),r);l.push(u[u.length-1]-o[o.length-1]),s.splice(0,1)}return l}async function pr(e,n){for(var t=n||14,a=[],r=[],s=0;s<e.length;s++)if(r.push(e[s]),r.length>=t-1){var l=await Math.max.apply(null,r),h=await Math.min.apply(null,r);a.push((l-e[s])/(l-h)*-100),r.splice(0,1)}return a}async function lsma(e,n){for(var t=n||25,a=[],r=[],s=0;s<e.length;s++)if(a.push(e[s]),a.length>=t){for(var l,h,u=0,o=0,i=0,p=0,c=1;c<=t;c++)u+=c,o+=a[c-1],i+=a[c-1]*c,p+=c*c,a[c-1]*a[c-1];h=o/t-(l=(i-u*o/t)/(p-u*u/t))*u/t,r.push(l*t+h),a.splice(0,1)}return r}async function don(e,n){for(var t=[],a=[],r=n||20,s=0;s<e.length;s++)if(t.push(e[s]),t.length>=r){var l=[],h=[];for(let e in t)l.push(t[e][0]),h.push(t[e][1]);var u=Math.max.apply(null,l.slice()),o=Math.min.apply(null,h.slice());a.push([u,(u+o)/2,o]),t.splice(0,1)}return a}async function ichimoku(e,n,t,a,r){for(var s=[],l=n||9,h=t||26,u=a||52,o=r||26,i=[],p=[],c=0;c<e.length;c++)if(s.push(e[c]),s.length>u){var f=[],g=[];for(let e in s)f.push(s[e][0]),g.push(s[e][2]);var m=(Math.max.apply(null,f.slice(f.length-1-l,f.length-1))+Math.min.apply(null,g.slice(g.length-1-l,g.length-1)))/2,v=(Math.max.apply(null,f.slice(f.length-1-h,f.length-1))+Math.min.apply(null,g.slice(g.length-1-h,g.length-1)))/2,d=e[c][1]+v,w=(Math.max.apply(null,f.slice(f.length-1-u,f.length-1))+Math.min.apply(null,g.slice(g.length-1-h,g.length-1)))/2;chik=e[c][1],p.push([m,v,d,w,chik]),s.splice(0,1)}for(c=o;c<p.length-o;c++)i.push([p[c][0],p[c][1],p[c+(o-1)][2],p[c+(o-1)][3],p[c+o-1][4]]);return i}async function stoch(e,n,t,a){var r=n||14,s=t||3,l=a||3;r<s&&([r,s]=[s,r]),l>s&&([l,s]=[s,l]);for(var h=[],u=[],o=[],i=[],p=0;p<e.length;p++){if(u.push(e[p][0]),o.push(e[p][2]),u.length>=r){var c=await Math.max.apply(null,u),f=await Math.min.apply(null,o),g=100*(e[p][1]-f)/(c-f);i.push(g)}if(l>0&&i.length>l){var m=await sma(i,l);i.push(m[m.length-1])}if(i.length-l>=s){var v=await sma(i.slice(l),s);h.push([g,v[v.length-1]]),u.splice(0,1),o.splice(0,1),i.splice(0,1)}}return h}async function atr(e,n){for(var t=n||14,a=[],r=0;r<e.length;r++)if(a.length<1)a.push(e[r][0]-e[r][2]);else{var s=await Math.max(e[r][0]-e[r-1][1],e[r][2]-e[r-1][1],e[r][0]-e[r][2]),l=(a[a.length-1]*(t-1)+s)/t;a.push(l)}return a}async function sma(e,n){for(var t=n||14,a=[],r=[],s=0;s<e.length;s++)if(a.push(e[s]),a.length>=t){var l=0;for(q in a)l+=a[q];r.push(l/t),a.splice(0,1)}return r}async function smma(e,n){for(var t=n||14,a=[],r=[],s=0;s<e.length;s++)if(a.push(e[s]),a.length>=t){var l=0;for(q in a)l+=a[q];r?r.push(l/t):r.push((l-sma1+e[s])/t),a.splice(0,1)}return r.splice(0,1),r}async function wma(e,n){for(var t=n||14,a=0,r=1;r<=t;r++)a+=r;var s=[],l=[];for(r=0;r<e.length;r++)if(s.push(e[r]),s.length>=t){var h=0,u=1;for(q in s)h+=s[q]*u/a,u++;l.push(h),s.splice(0,1)}return l}async function vwma(e,n){for(var t=n||20,a=[],r=[],s=0;s<e.length;s++)if(a.push([e[s][0]*e[s][1],e[s][1]]),a.length>=t){for(var l=0,h=0,u=0;u<a.length;u++)l+=a[u][1],h+=a[u][0];r.push(h/l),a.splice(0,1)}return r}async function ema(e,n){for(var t=n||12,a=[],r=[],s=0,l=2/(t+1),h=0;h<e.length;h++){a.push(e[h]);var u=0;if(0==s&&a.length>=t){for(q in a)u+=a[q];u/=t,r.push(u),s=u}else 0!=s&&a.length>=t&&(u=(e[h]-s)*l+s,r.push(u),s=u)}return r}async function hull(e,n){var t=n||14,a=[],r=[],s=await wma(e.slice(),t),l=Math.round(Math.sqrt(t)),h=await wma(e.slice(),Math.round(t/2));h.splice(0,h.length-s.length);for(let e in s)if(a.push(2*h[e]-s[e]),a.length>=l){var u=await wma(a,l);r.push(u[u.length-1])}return r}async function kama(e,n,t,a){n=n||10,t=t||2,a=a||30;for(var r=[(r=await sma(e.slice(),n))[r.length-1]],s=n+1;s<e.length;s++){for(var l=0,h=Math.abs(e[s]-e[s-n]),u=1;u<n;u++)l+=Math.abs(e[s-u]-e[s-u-1]);var o=(h/l*(2/(t+1)-2/(a+1)+2/(a+1)))**2;r.push(r[r.length-1]+o*(e[s]-r[r.length-1]))}return r}async function macd(e,n,t){var a=n||12,r=t||26;a>r&&([a,r]=[r,a]);var s=await ema(e,a),l=await ema(e,r);s.splice(0,r-a);for(var h=[],u=0;u<l.length;u++)h.push([s[u]-l[u]]);return h}async function bands(e,n,t){for(var a=n||14,r=t||1,s=[],l=[],h=[],u=await sma(e,a),o=0;o<e.length;o++)if(s.push(e[o]),s.length>=a){var i=await std(s,a);l.push(i),s.splice(0,1)}for(o=0;o<u.length;o++)h.push([u[o]+l[o]*r,u[o],u[o]-l[o]*r]);return h}async function bandwidth(e,n,t){for(var a=n||14,r=t||1,s=[],l=[],h=[],u=await sma(e,a),o=0;o<e.length;o++)if(s.push(e[o]),s.length>=a){var i=await std(s);l.push(i),s.push(e[o]),s.splice(0,1)}for(o=0;o<l.length;o++){var p=(u[o]+l[o]*r-(u[o]-l[o]*r))/u[o];h.push(p)}return h}async function keltner(e,n,t){var a,r=n||14,s=t||1,l=[],h=await atr(e,r),u=[];for(var o in e)l.push((e[o][0]+e[o][1]+e[o][2])/3);a=await sma(l,r),h.splice(0,r-1);for(o=0;o<a.length;o++)u.push([a[o]+h[o]*s,a[o],a[o]-h[o]*s]);return u}async function std(e,n){var t=n||e.length,a=e.reduce((e,n)=>Number(e)+Number(n))/t;return Math.sqrt(e.reduce((e,n)=>e+Math.pow(n-a,2),0)/t)}async function cor(e,n){for(var t=await sma(e.slice(),e.length),a=await sma(n.slice(),n.length),r=0,s=0,l=0,h=0;h<e.length;h++){var u=e[h]-t,o=n[h]-a;r+=u*o,s+=Math.pow(u,2),l+=Math.pow(o,2)}var i=e.length-1;return s/=i,l/=i,r/(i*(s=Math.sqrt(s))*(l=Math.sqrt(l)))}async function dif(e,n){return(e-n)/n}async function aroon_up(e,n){for(var t=n||10,a=[],r=[],s=0;s<e.length;s++)if(a.push(e[s]),a.length>=t){var l=a.slice(0);l.sort((e,n)=>e-n);var h=l[t-1];r.push(100*(t-(a.findIndex(e=>e==h)+1))/t),a.splice(0,1)}return r}async function aroon_down(e,n){for(var t=n||10,a=[],r=[],s=0;s<e.length;s++)if(a.push(e[s]),a.length>=t){var l=a.slice(0);l.sort((e,n)=>e-n);var h=l[0];r.push(100*(t-(a.findIndex(e=>e==h)+1))/t),a.splice(0,1)}return r}async function aroon_osc(e,n){for(var t=n||25,a=[],r=await aroon.up(e,t),s=await aroon.down(e,t),l=0;l<r.length;l++)a.push(r[l]-s[l]);return a}async function mfi(e,n){for(var t=n||14,a=[],r=[],s=[],l=0;l<e.length;l++)if(s.push(e[l][0]),r.push(e[l][1]),s.length>=t){var h=0,u=0;for(q in s)h+=s[q];for(q in r)u+=r[q];a.push(100-100/(1+h/u)),s.splice(0,1),r.splice(0,1)}return a}async function roc(e,n){for(var t=n||14,a=[],r=[],s=0;s<e.length;s++)a.push(e[s]),a.length>=t&&(r.push((a[t-1]-a[0])/a[0]),a.splice(0,1));return r}async function cop(e,n,t,a){n=n||11,t=t||14,a=a||10,max=Math.max(n,t),co=[];for(var r=max+a;r<e.length;r++){var s=e.slice(r-(max+a),r),l=e.slice(r-(max+a),r),h=[];s=await roc(s,n),l=await roc(l,t),s.splice(0,s.length-l.length),l.splice(0,l.length-s.length);for(var u=0;u<s.length;u++)h.push(s[u]+l[u]);h=await wma(h.slice(),a),co.push(h[h.length-1])}return co}async function kst(e,n,t,a,r,s,l,h,u,o){n=n||10,t=t||15,a=a||20,r=r||30,s=s||10,l=l||10,h=h||10,u=u||15,o=o||9;for(var i=[],p=[],c=Math.max(n,t,a,r)+Math.max(s,l,h,u),f=c;f<e.length;f++){var g=await roc(e.slice(f-c,f),n),m=await roc(e.slice(f-c,f),t),v=await roc(e.slice(f-c,f),a),d=await roc(e.slice(f-c,f),r);g=await sma(g,s),m=await sma(m,l),v=await sma(v,h),d=await sma(d,u),i.push(g[g.length-1]+m[m.length-1]+v[v.length-1]+d[d.length-1])}var w=await sma(i.slice(),o);for(var f in i.splice(0,i.length-w.length),w)p.push([i[f],w[f]]);return p}async function obv(e){for(var n=[0],t=1;t<e.length;t++)e[t][1]>e[t-1][1]&&n.push(n[n.length-1]+e[t][0]),e[t][1]<e[t-1][1]&&n.push(n[n.length-1]-e[t][0]),e[t][1]==e[t-1][1]&&n.push(n[n.length-1]);return n}async function vwap(e,n){for(var t=!n||n>e.length?e.length:n,a=[],r=[],s=0;s<e.length;s++)if(a.push([e[s][0]*e[s][1],e[s][1]]),a.length>=t){for(var l=0,h=0,u=0;u<a.length;u++)l+=a[u][1],h+=a[u][0];r.push(h/l),a.splice(0,1)}return r}async function mom(e,n,t){for(var a=n||10,r=[],s=a-1;s<e.length;s++)t?r.push(e[s]/e[s-(a-1)]*100):r.push(e[s]-e[s-(a-1)]);return r}async function mom_osc(e,n){for(var t=n||9,a=[],r=[],s=0;s<e.length;s++)if(a.push(e[s]),a.length>t){for(var l=0,h=0,u=1;u<t;u++)a[u-1]<a[u]?l+=a[u]:h+=a[u];r.push((l-h)/(l+h)*100),a.splice(0,1)}return r}async function ha(e){for(var n=[(Number(e[0][1])+Number(e[0][4]))/2,Number(e[0][2]),Number(e[0][3]),(Number(e[0][1])+Number(e[0][2])+Number(e[0][3])+Number(e[0][4]))/4],t=1;t<e.length;t++)n.push((n[n.length-1][0]+n[n.length-1][3])/2,Math.max(open,close,Number(e[t][2])),Math.min(open,close,Number(e[t][3])),(Number(e[t][1])+Number(e[t][2])+Number(e[t][3])+Number(e[t][4]))/4);return n}async function ren(e,n){for(var t=[],a=(n=n||1,Math.floor(n)==n?0:n.toString().split(".")[1].length||0),r=Math.ceil(e[0][0]/n*10**a)/10**a*n,s=r-n,l=1;l<e.length;l++){if(e[l][0]>r+n)do{t.push([r,r+n,r,r+r+n]),r+=n,s+=n}while(e[l][0]>r+n);if(e[l][1]<s-n)do{t.push([r-n,r-n,s+n,s+n]),r-=n,s-=n}while(e[l][1]<s-n)}return t}const aroon={up:aroon_up,down:aroon_down,osc:aroon_osc};
