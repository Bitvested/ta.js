/* ta.js (c) Nino Kroesen. MIT License. */ async function median(t,n){for(var e=n||t.length,a=[],r=[],l=0;l<t.length;l++)if(a.push(t[l]),a.length>=e){var s=a.slice();s.sort((t,n)=>t>n?-1:t<n?1:0),r.push(s[Math.round(s.length/2)]),a.splice(0,1)}return r}async function rsi(t,n){for(var e=n||14,a=[],r=[],l=1;l<t.length;l++)if(a.push(t[l]-t[l-1]),a.length>=e){var s=0,h=0;for(q in a)a[q]<0&&(h+=Math.abs(a[q])),a[q]>=0&&(s+=a[q]);rsi=Number(100-100/(1+s/e/(h/e))),r.push(rsi),a.splice(0,1)}return r}async function tsi(t,n,e,a){for(var r=n||25,l=e||13,s=a||13,h=[],u=[],o=[],i=[],p=1;p<t.length;p++)h.push(t[p]-t[p-1]),u.push(Math.abs(t[p]-t[p-1]));var c=await module.exports.ema(h,r),f=await module.exports.ema(u,r),g=await module.exports.ema(c,l),m=await module.exports.ema(f,l);for(p=0;p<g.length;p++)o.push(g[p]/m[p]);var v=await module.exports.ema(o,s);o.splice(0,o.length-v.length);for(p=0;p<v.length;p++)i.push([v[p],o[p]]);return i}async function bop(t,n){for(var e=[],a=(n=n||14,0);a<t.length;a++)e.push((t[a][3]-t[a][0])/(t[a][1]-t[a][2]));return e=await module.exports.sma(e,n)}async function fi(t,n){for(var e=n||13,a=[],r=[],l=1;l<t.length;l++)if(a.push(t[l][0]-t[l-1][0]),a.length>=e){var s=await module.exports.ema(a.slice(),e);r.push((t[l][0]-t[l-1][0])*s[0]),a.splice(0,1)}return r}async function asi(t){for(var n=[],e=1;e<t.length;e++){var a,r=t[e][1],l=t[e-1][1],s=t[e][0],h=t[e-1][0],u=t[e][2],o=t[e-1][2],i=h-r>o-r?h-r:o-r,p=t[e][0],c=t[e-1][0],f=Math.max(t[e][0],t[e-1][0])-Math.min(t[e][2],t[e-1][2]);s-l>u-l&&s-l>s-u&&(a=s-l-(u-l)/2+(l-c)/4),u-l>s-l&&u-l>s-u&&(a=u-l-(s-l)/2+(l-c)/4),s-u>s-l&&s-u>u-l&&(a=s-u+(l-c)/4),n.push((l-r+(l-c)/2+(r-p)/2)/a*50*i/f)}return n}async function ao(t,n,e){for(var a=n||5,r=e||35,l=[],s=[],h=0;h<t.length;h++)if(l.push((t[h][0]+t[h][1])/2),l.length>=r){var u=await module.exports.sma(l.slice(),a),o=await module.exports.sma(l.slice(),r);s.push(u[u.length-1]-o[o.length-1]),l.splice(0,1)}return s}async function pr(t,n){for(var e=n||14,a=[],r=[],l=0;l<t.length;l++)if(r.push(t[l]),r.length>=e){var s=await Math.max.apply(null,r),h=await Math.min.apply(null,r);a.push((s-t[l])/(s-h)*-100),r.splice(0,1)}return a}async function lsma(t,n){for(var e=n||25,a=[],r=[],l=0;l<t.length;l++)if(a.push(t[l]),a.length>=e){for(var s,h,u=0,o=0,i=0,p=0,c=1;c<=e;c++)u+=c,o+=a[c-1],i+=a[c-1]*c,p+=c*c,a[c-1]*a[c-1];h=o/e-(s=(i-u*o/e)/(p-u*u/e))*u/e,r.push(s*e+h),a.splice(0,1)}return r}async function don(t,n){for(var e=[],a=[],r=n||20,l=0;l<t.length;l++)if(e.push(t[l]),e.length>=r){var s=[],h=[];for(let t in e)s.push(e[t][0]),h.push(e[t][1]);var u=Math.max.apply(null,s.slice()),o=Math.min.apply(null,h.slice());a.push([u,(u+o)/2,o]),e.splice(0,1)}return a}async function ichimoku(t,n,e,a,r){for(var l=[],s=n||9,h=e||26,u=a||52,o=r||26,i=[],p=[],c=0;c<t.length;c++)if(l.push(t[c]),l.length>u){var f=[],g=[];for(let t in l)f.push(l[t][0]),g.push(l[t][2]);var m=(Math.max.apply(null,f.slice(f.length-1-s,f.length-1))+Math.min.apply(null,g.slice(g.length-1-s,g.length-1)))/2,v=(Math.max.apply(null,f.slice(f.length-1-h,f.length-1))+Math.min.apply(null,g.slice(g.length-1-h,g.length-1)))/2,d=t[c][1]+v,w=(Math.max.apply(null,f.slice(f.length-1-u,f.length-1))+Math.min.apply(null,g.slice(g.length-1-h,g.length-1)))/2;chik=t[c][1],p.push([m,v,d,w,chik]),l.splice(0,1)}for(c=o;c<p.length-o;c++)i.push([p[c][0],p[c][1],p[c+(o-1)][2],p[c+(o-1)][3],p[c+o-1][4]]);return i}async function stoch(t,n,e,a){var r=n||14,l=e||3,s=a||3;r<l&&([r,l]=[l,r]),s>l&&([s,l]=[l,s]);for(var h=[],u=[],o=[],i=[],p=0;p<t.length;p++){if(u.push(t[p][0]),o.push(t[p][2]),u.length>=r){var c=await Math.max.apply(null,u),f=await Math.min.apply(null,o),g=100*(t[p][1]-f)/(c-f);i.push(g)}if(s>0&&i.length>s){var m=await module.exports.sma(i,s);i.push(m[m.length-1])}if(i.length-s>=l){var v=await module.exports.sma(i.slice(),l);h.push([g,v[v.length-1]]),u.splice(0,1),o.splice(0,1),i.splice(0,1)}}return h}async function atr(t,n){for(var e=n||14,a=[t[0][0]-t[0][2]],r=1;r<t.length;r++){var l=await Math.max(t[r][0]-t[r-1][1],t[r][2]-t[r-1][1],t[r][0]-t[r][2]);a.push((a[a.length-1]*(e-1)+l)/e)}return a}async function sma(t,n){for(var e=n||14,a=[],r=[],l=0;l<t.length;l++)if(a.push(t[l]),a.length>=e){var s=0;for(q in a)s+=a[q];r.push(s/e),a.splice(0,1)}return r}async function smma(t,n){for(var e=n||14,a=[],r=[],l=0;l<t.length;l++)if(a.push(t[l]),a.length>=e){var s=0;for(q in a)s+=a[q];r.length<=0?r.push(s/e):r.push((s-r[r.length-1])/e),a.splice(0,1)}return r.splice(0,1),r}async function wma(t,n){for(var e=n||14,a=0,r=[],l=[],s=1;s<=e;s++)a+=s;for(s=0;s<t.length;s++)if(r.push(t[s]),r.length>=e){var h=0;for(q in r)h+=r[q]*(Number(q)+1)/a;l.push(h),r.splice(0,1)}return l}async function vwma(t,n){for(var e=n||20,a=[],r=[],l=0;l<t.length;l++)if(a.push([t[l][0]*t[l][1],t[l][1]]),a.length>=e){for(var s=0,h=0,u=0;u<a.length;u++)s+=a[u][1],h+=a[u][0];r.push(h/s),a.splice(0,1)}return r}async function ema(t,n){for(var e=n||12,a=[],r=[],l=2/(e+1),s=0;s<t.length;s++)if(a.push(t[s]),a.length>=e){if(r.length>0){r.push((t[s]-r[r.length-1])*l+r[r.length-1]);continue}var h=0;for(q in a)h+=a[q];r.push(h/e)}return r}async function hull(t,n){var e=n||14,a=[],r=[],l=await module.exports.wma(t.slice(),e),s=Math.round(Math.sqrt(e)),h=await wma(t.slice(),Math.round(e/2));h.splice(0,h.length-l.length);for(let t in l)if(a.push(2*h[t]-l[t]),a.length>=s){var u=await wma(a,s);r.push(u[u.length-1])}return r}async function kama(t,n,e,a){n=n||10,e=e||2,a=a||30;for(var r=[(r=await module.exports.sma(t.slice(),n))[r.length-1]],l=n+1;l<t.length;l++){for(var s=0,h=Math.abs(t[l]-t[l-n]),u=1;u<n;u++)s+=Math.abs(t[l-u]-t[l-u-1]);var o=(h/s*(2/(e+1)-2/(a+1)+2/(a+1)))**2;r.push(r[r.length-1]+o*(t[l]-r[r.length-1]))}return r}async function macd(t,n,e){var a=n||12,r=e||26;a>r&&([a,r]=[r,a]);var l=await module.exports.ema(t,a),s=await module.exports.ema(t,r);l.splice(0,r-a);for(var h=[],u=0;u<s.length;u++)h.push(l[u]-s[u]);return h}async function bands(t,n,e){for(var a=n||14,r=e||1,l=[],s=[],h=[],u=await module.exports.sma(t,a),o=0;o<t.length;o++)if(l.push(t[o]),l.length>=a){var i=await module.exports.std(l,a);s.push(i),l.splice(0,1)}for(o=0;o<u.length;o++)h.push([u[o]+s[o]*r,u[o],u[o]-s[o]*r]);return h}async function bandwidth(t,n,e){for(var a=n||14,r=e||1,l=[],s=await module.exports.bands(t.slice(),a,r),h=0;h<s.length;h++)l.push((s[h][0]-s[h][2])/s[h][1]);return l}async function keltner(t,n,e){var a,r=n||14,l=e||1,s=[],h=await module.exports.atr(t,r),u=[];for(var o in t)s.push((t[o][0]+t[o][1]+t[o][2])/3);a=await module.exports.sma(s,r),h.splice(0,r-1);for(o=0;o<a.length;o++)u.push([a[o]+h[o]*l,a[o],a[o]-h[o]*l]);return u}async function std(t,n){var e=n||t.length,a=t.reduce((t,n)=>Number(t)+Number(n))/e;return Math.sqrt(t.reduce((t,n)=>t+Math.pow(n-a,2),0)/e)}async function cor(t,n){for(var e=await module.exports.sma(t.slice(),t.length),a=await module.exports.sma(n.slice(),n.length),r=0,l=0,s=0,h=0;h<t.length;h++){var u=t[h]-e,o=n[h]-a;r+=u*o,l+=Math.pow(u,2),s+=Math.pow(o,2)}var i=t.length-1;return l/=i,s/=i,r/(i*(l=Math.sqrt(l))*(s=Math.sqrt(s)))}async function dif(t,n){return(t-n)/n}async function aroon_up(t,n){for(var e=n||10,a=[],r=[],l=0;l<t.length;l++)if(a.push(t[l]),a.length>=e){var s=a.slice(0);s.sort((t,n)=>t-n);var h=s[e-1];r.push(100*(e-(a.findIndex(t=>t==h)+1))/e),a.splice(0,1)}return r}async function aroon_down(t,n){for(var e=n||10,a=[],r=[],l=0;l<t.length;l++)if(a.push(t[l]),a.length>=e){var s=a.slice(0);s.sort((t,n)=>t-n);var h=s[0];r.push(100*(e-(a.findIndex(t=>t==h)+1))/e),a.splice(0,1)}return r}async function aroon_osc(t,n){for(var e=n||25,a=[],r=await module.exports.aroon.up(t,e),l=await module.exports.aroon.down(t,e),s=0;s<r.length;s++)a.push(r[s]-l[s]);return a}async function mfi(t,n){for(var e=n||14,a=[],r=[],l=[],s=0;s<t.length;s++)if(l.push(t[s][0]),r.push(t[s][1]),l.length>=e){var h=0,u=0;for(q in l)h+=l[q];for(q in r)u+=r[q];a.push(100-100/(1+h/u)),l.splice(0,1),r.splice(0,1)}return a}async function roc(t,n){for(var e=n||14,a=[],r=[],l=0;l<t.length;l++)a.push(t[l]),a.length>=e&&(r.push((a[e-1]-a[0])/a[0]),a.splice(0,1));return r}async function cop(t,n,e,a){n=n||11,e=e||14,a=a||10,max=Math.max(n,e),co=[];for(var r=max+a;r<t.length;r++){var l=t.slice(r-(max+a),r),s=t.slice(r-(max+a),r),h=[];l=await module.exports.roc(l,n),s=await module.exports.roc(s,e),l.splice(0,l.length-s.length),s.splice(0,s.length-l.length);for(var u=0;u<l.length;u++)h.push(l[u]+s[u]);h=await module.exports.wma(h.slice(),a),co.push(h[h.length-1])}return co}async function kst(t,n,e,a,r,l,s,h,u,o){n=n||10,e=e||15,a=a||20,r=r||30,l=l||10,s=s||10,h=h||10,u=u||15,o=o||9;for(var i=[],p=[],c=Math.max(n,e,a,r)+Math.max(l,s,h,u),f=c;f<t.length;f++){var g=await module.exports.roc(t.slice(f-c,f),n),m=await module.exports.roc(t.slice(f-c,f),e),v=await module.exports.roc(t.slice(f-c,f),a),d=await module.exports.roc(t.slice(f-c,f),r);g=await module.exports.sma(g,l),m=await module.exports.sma(m,s),v=await module.exports.sma(v,h),d=await module.exports.sma(d,u),i.push(g[g.length-1]+m[m.length-1]+v[v.length-1]+d[d.length-1])}var w=await module.exports.sma(i.slice(),o);for(var f in i.splice(0,i.length-w.length),w)p.push([i[f],w[f]]);return p}async function obv(t){for(var n=[0],e=1;e<t.length;e++)t[e][1]>t[e-1][1]&&n.push(n[n.length-1]+t[e][0]),t[e][1]<t[e-1][1]&&n.push(n[n.length-1]-t[e][0]),t[e][1]==t[e-1][1]&&n.push(n[n.length-1]);return n}async function vwap(t,n){for(var e=!n||n>t.length?t.length:n,a=[],r=[],l=0;l<t.length;l++)if(a.push([t[l][0]*t[l][1],t[l][1]]),a.length>=e){for(var s=0,h=0,u=0;u<a.length;u++)s+=a[u][1],h+=a[u][0];r.push(h/s),a.splice(0,1)}return r}async function mom(t,n,e){for(var a=n||10,r=[],l=a-1;l<t.length;l++)e?r.push(t[l]/t[l-(a-1)]*100):r.push(t[l]-t[l-(a-1)]);return r}async function mom_osc(t,n){for(var e=n||9,a=[],r=[],l=0;l<t.length;l++)if(a.push(t[l]),a.length>e){for(var s=0,h=0,u=1;u<e;u++)a[u-1]<a[u]?s+=a[u]:h+=a[u];r.push((s-h)/(s+h)*100),a.splice(0,1)}return r}async function ha(t){for(var n=[[(Number(t[0][0])+Number(t[0][3]))/2,Number(t[0][1]),Number(t[0][2]),(Number(t[0][0])+Number(t[0][1])+Number(t[0][2])+Number(t[0][3]))/4]],e=1;e<t.length;e++)n.push([(n[n.length-1][0]+n[n.length-1][3])/2,Math.max(n[n.length-1][0],n[n.length-1][3],t[e][1]),Math.min(n[n.length-1][0],n[n.length-1][3],t[e][2]),(t[e][0]+t[e][1]+t[e][2]+t[e][3])/4]);return n}async function ren(t,n){for(var e=[],a=(n=n||1,Math.floor(n)==n?0:n.toString().split(".")[1].length||0),r=Math.ceil(t[0][0]/n*10**a)/10**a*n,l=r-n,s=1;s<t.length;s++){if(t[s][0]>r+n)do{e.push([r,r+n,r,r+n]),r+=n,l+=n}while(t[s][0]>r+n);if(t[s][1]<l-n)do{e.push([l,l,l-n,l-n]),r-=n,l-=n}while(t[s][1]<l-n)}return e}const aroon={up:aroon_up,down:aroon_down,osc:aroon_osc};
