/* ta.js (c) Nino Kroesen. MIT License. */ async function median(a,t){for(var n=[],r=t||a.length;r<=a.length;r++){var e=a.slice(r-t,r);e.sort((a,t)=>a>t?-1:a<t?1:0),n.push(e[Math.round(e.length/2)])}return n}async function kmeans(a,t){var n,r=[],e=[],l=[],o=!1,s=Math.round(a.length/(t+1));for(i=0;i<t;i++)e[i]=a[s*(i+1)];do{for(i=0;i<t;i++)r[i]=[];for(x=0;x<a.length;x++){var h=-1;for(y=0;y<t;y++){var u=Math.abs(e[y]-a[x]);-1===h?(h=u,n=y):u<=h&&(h=u,n=y)}r[n].push(a[x])}for(l=e,x=0;x<t;x++){var p=0;for(y=0;y<r[x].length;y++)p+=r[x][y];var c=p/r[n].length;e[x]=c}for(x=0;x<t;x++)e[x]!==l[x]&&(o=!0)}while(o);return r}async function normalize(a,t){t=t||0;for(var n=await Math.max.apply(null,a.slice())*(1+t),r=await Math.min.apply(null,a.slice())*(1-t),e=[],l=0;l<a.length;l++)e.push(1-(n-a[l])/(n-r));return e}async function denormalize(a,t,n){n=n||0;for(var r=await Math.max.apply(null,a.slice())*(1+n),e=await Math.min.apply(null,a.slice())*(1-n),l=[],o=0;o<t.length;o++)l.push(e+t[o]*(r-e));return l}async function mad(a,t){for(var n=t||a.length,r=[],e=n;e<=a.length;e++){var l=a.slice(e-n,e),o=await median(l),s=l.map(a=>Math.abs(a-o[o.length-1]));s=await median(s),r.push(s[s.length-1])}return r}async function aad(a,t){for(var n=t||a.length,r=[],e=n;e<=a.length;e++){var l=a.slice(e-n,e),o=0,s=await sma(l,n);for(q in l)o+=Math.abs(l[q]-s[s.length-1]);r.push(o/n)}return r}async function ssd(a,t){for(var n=t||a.length,r=[],e=n;e<a.length;e++){var l=a.slice(e-n,e),o=await sma(l,n),s=0;for(let a in l)s+=(l[a]-o[o.length-1])**2;r.push(Math.sqrt(s))}return r}async function rsi(a,t){for(var n=t||14,r=[],e=a.slice(0,n-1),l=n-1,o=0,s=0;l<a.length;l++,o=0,s=0){e.push(a[l]);for(var h=1;h<e.length;h++)e[h]-e[h-1]<0?s+=Math.abs(e[h]-e[h-1]):o+=e[h]-e[h-1];var u=100-100/(1+o/n/(s/n));r.push(u),e.splice(0,1)}return r}async function wrsi(a,t){for(var n=t||14,r=[],e=[],l=[],o=1;o<a.length;o++)console.log(a[o].toString()+" - "+a[o-1].toString()),a[o]-a[o-1]<0?(l.push(Math.abs(a[o]-a[o-1])),e.push(0)):(l.push(0),e.push(a[o]-a[o-1]));l=await wsma(l,n),e=await wsma(e,n);for(let a in l)r.push(100-100/(1+e[a]/l[a]));return r}async function tsi(a,t,n,r){for(var e=t||25,l=n||13,o=r||13,s=[],h=[],u=[],i=[],p=1;p<a.length;p++)s.push(a[p]-a[p-1]),h.push(Math.abs(a[p]-a[p-1]));var c=await ema(s,e),f=await ema(h,e),m=await ema(c,l),g=await ema(f,l);for(p=0;p<m.length;p++)u.push(m[p]/g[p]);var v=await ema(u,o);u.splice(0,u.length-v.length);for(p=0;p<v.length;p++)i.push([v[p],u[p]]);return i}async function bop(a,t){var n=a.map(a=>(a[3]-a[0])/(a[1]-a[2]));t=t||14;return n=await sma(n,t)}async function fi(a,t){for(var n=t||13,r=[],e=[],l=1;l<a.length;l++)if(r.push(a[l][0]-a[l-1][0]),r.length>=n){var o=await ema(r,n);e.push((a[l][0]-a[l-1][0])*o[0]),r.splice(0,1)}return e}async function asi(a){for(var t=[],n=1;n<a.length;n++){var r,e=a[n][1],l=a[n-1][1],o=a[n][0],s=a[n-1][0],h=a[n][2],u=a[n-1][2],i=s-e>u-e?s-e:u-e,p=a[n][0],c=a[n-1][0],f=Math.max(a[n][0],a[n-1][0])-Math.min(a[n][2],a[n-1][2]);o-l>h-l&&o-l>o-h&&(r=o-l-(h-l)/2+(l-c)/4),h-l>o-l&&h-l>o-h&&(r=h-l-(o-l)/2+(l-c)/4),o-h>o-l&&o-h>h-l&&(r=o-h+(l-c)/4),t.push((l-e+(l-c)/2+(e-p)/2)/r*50*i/f)}return t}async function ao(a,t,n){var r=t||5,e=n||35,l=[];a=a.map(a=>(a[0]+a[1])/2),pl=a.slice(0,e-1);for(var o=e-1;o<a.length;o++){pl.push(a[o]);var s=await sma(pl,r),h=await sma(pl,e);l.push(s[s.length-1]-h[h.length-1]),pl.splice(0,1)}return l}async function pr(a,t){for(var n=t||14,r=[],e=n;e<=a.length;e++){var l=a.slice(e-n,e),o=await Math.max.apply(null,l),s=await Math.min.apply(null,l);r.push((o-a[e-1])/(o-s)*-100)}return r}async function lsma(a,t){for(var n=t||25,r=[],e=n;e<=a.length;e++){for(var l,o,s=a.slice(e-n,e),h=0,u=0,i=0,p=0,c=1;c<=n;c++)h+=c,u+=s[c-1],i+=s[c-1]*c,p+=c*c,s[c-1]*s[c-1];o=u/n-(l=(i-h*u/n)/(p-h*h/n))*h/n,r.push(l*n+o)}return r}async function don(a,t){for(var n=[],r=t||20,e=r;e<=a.length;e++){var l=a.slice(e-r,e),o=[],s=[];for(let a in l)o.push(l[a][0]),s.push(l[a][1]);var h=Math.max.apply(null,o.slice()),u=Math.min.apply(null,s.slice());n.push([h,(h+u)/2,u])}return n}async function ichimoku(a,t,n,r,e){for(var l=[],o=t||9,s=n||26,h=r||52,u=e||26,i=[],p=[],c=0;c<a.length;c++)if(l.push(a[c]),l.length>h){var f=[],m=[];for(let a in l)f.push(l[a][0]),m.push(l[a][2]);var g=(Math.max.apply(null,f.slice(f.length-1-o,f.length-1))+Math.min.apply(null,m.slice(m.length-1-o,m.length-1)))/2,v=(Math.max.apply(null,f.slice(f.length-1-s,f.length-1))+Math.min.apply(null,m.slice(m.length-1-s,m.length-1)))/2,d=a[c][1]+v,x=(Math.max.apply(null,f.slice(f.length-1-h,f.length-1))+Math.min.apply(null,m.slice(m.length-1-s,m.length-1)))/2;chik=a[c][1],p.push([g,v,d,x,chik]),l.splice(0,1)}for(c=u;c<p.length-u;c++)i.push([p[c][0],p[c][1],p[c+(u-1)][2],p[c+(u-1)][3],p[c+u-1][4]]);return i}async function stoch(a,t,n,r){var e=t||14,l=n||3,o=r||3,s=[],h=[],u=[],i=[];e<l&&([e,l]=[l,e]),o>l&&([o,l]=[l,o]);for(var p=0;p<a.length;p++){if(h.push(a[p][0]),u.push(a[p][2]),h.length>=e){var c=await Math.max.apply(null,h),f=await Math.min.apply(null,u),m=100*(a[p][1]-f)/(c-f);i.push(m)}if(o>0&&i.length>o){var g=await sma(i,o);i.push(g[g.length-1])}if(i.length-o>=l){var v=await sma(i,l);s.push([m,v[v.length-1]]),h.splice(0,1),u.splice(0,1),i.splice(0,1)}}return s}async function atr(a,t){for(var n=t||14,r=[a[0][0]-a[0][2]],e=1;e<a.length;e++){var l=await Math.max(a[e][0]-a[e-1][1],a[e][2]-a[e-1][1],a[e][0]-a[e][2]);r.push((r[r.length-1]*(n-1)+l)/n)}return r}async function sma(a,t){for(var n=t||14,r=[],e=n,l=0;e<=a.length;e++,l=0){var o=a.slice(e-n,e);for(q in o)l+=o[q];r.push(l/n)}return r}async function smma(a,t){for(var n=t||14,r=[],e=n;e<=a.length;e++){var l=a.slice(e-n,e),o=0;for(q in l)o+=l[q];r.length<=0?r.push(o/n):r.push((o-r[r.length-1])/n)}return r.splice(0,1),r}async function wma(a,t){for(var n=t||14,r=0,e=[],l=1;l<=n;l++)r+=l;for(l=n;l<=a.length;l++){var o=a.slice(l-n,l),s=0;for(q in o)s+=o[q]*(Number(q)+1)/r;e.push(s)}return e}async function wsma(a,t){for(var n=t||14,r=[],e=1/n,l=n;l<=a.length;l++)if(r.length>0)r.push((a[l-1]-r[r.length-1])*e+r[r.length-1]);else{var o=a.slice(l-n,l),s=0;for(q in o)s+=o[q];r.push(s/n)}return r}async function pwma(a,t){for(var n=0,r=[],e=[],l=t||14,o=l/2,s=t;o>=1;o--,s--)o%1!=0?n+=(o=Math.round(o))*s:(e.push(o*s),n+=o*s*2),e.unshift(o*s);for(o=l;o<=a.length;o++){for(var h=0,u=a.slice(o-l,o),i=l-1;i>=0;i--)h+=u[i]*e[i]/n;r.push(h)}return r}async function hwma(a,t){for(var n=0,r=[],e=[],l=t||14,o=1,s=l;o<=l/2;o++,s--)o%1!=0?n+=(o=Math.round(o))*s:(e.push(o*s),n+=o*s*2),e.unshift(o*s);for(o=l;o<=a.length;o++){for(var h=0,u=a.slice(o-l,o),i=l-1;i>=0;i--)h+=u[i]*e[i]/n;r.push(h)}return r}async function vwma(a,t){for(var n=t||20,r=[],e=(a=a.map(a=>[a[0]*a[1],a[1]]),n);e<=a.length;e++){for(var l=a.slice(e-n,e),o=0,s=0,h=0;h<l.length;h++)o+=l[h][1],s+=l[h][0];r.push(s/o)}return r}async function ema(a,t){for(var n=t||12,r=[],e=2/(n+1),l=n;l<=a.length;l++)if(r.length>0)r.push((a[l-1]-r[r.length-1])*e+r[r.length-1]);else{var o=a.slice(l-n,l),s=0;for(q in o)s+=o[q];r.push(s/n)}return r}async function hull(a,t){var n=t||14,r=[],e=[],l=await wma(a,n),o=Math.round(Math.sqrt(n)),s=await wma(a,Math.round(n/2));s.splice(0,s.length-l.length);for(let a in l)if(r.push(2*s[a]-l[a]),r.length>=o){var h=await wma(r,o);e.push(h[h.length-1])}return e}async function kama(a,t,n,r){t=t||10,n=n||2,r=r||30;for(var e=[(e=await sma(a,t))[e.length-1]],l=t+1;l<a.length;l++){for(var o=0,s=Math.abs(a[l]-a[l-t]),h=1;h<t;h++)o+=Math.abs(a[l-h]-a[l-h-1]);var u=(s/o*(2/(n+1)-2/(r+1)+2/(r+1)))**2;e.push(e[e.length-1]+u*(a[l]-e[e.length-1]))}return e}async function macd(a,t,n){var r=t||12,e=n||26;r>e&&([r,e]=[e,r]);var l=await ema(a,r),o=await ema(a,e),s=[];l.splice(0,e-r);for(var h=0;h<o.length;h++)s.push(l[h]-o[h]);return s}async function bands(a,t,n){for(var r=t||14,e=n||1,l=[],o=[],s=[],h=await sma(a,r),u=0;u<a.length;u++)if(l.push(a[u]),l.length>=r){var i=await std(l,r);o.push(i),l.splice(0,1)}for(u=0;u<h.length;u++)s.push([h[u]+o[u]*e,h[u],h[u]-o[u]*e]);return s}async function bandwidth(a,t,n){for(var r=t||14,e=n||1,l=[],o=await bands(a,r,e),s=0;s<o.length;s++)l.push((o[s][0]-o[s][2])/o[s][1]);return l}async function keltner(a,t,n){var r,e=t||14,l=n||1,o=[],s=await atr(a,e),h=[];for(var u in a)o.push((a[u][0]+a[u][1]+a[u][2])/3);r=await sma(o,e),s.splice(0,e-1);for(u=0;u<r.length;u++)h.push([r[u]+s[u]*l,r[u],r[u]-s[u]*l]);return h}async function variance(a,t){for(var n=t||a.length,r=[],e=n;e<=a.length;e++){var l=a.slice(e-n,e),o=await sma(l,n),s=0;for(x in l)s+=(l[x]-o[o.length-1])**2;r.push(s/n)}return r}async function std(a,t){var n=t||a.length,r=a.reduce((a,t)=>Number(a)+Number(t))/n;return Math.sqrt(a.reduce((a,t)=>a+Math.pow(t-r,2),0)/n)}async function normsinv(a){var t=-.00778489400243029,n=-.322396458041136,r=-2.40075827716184,e=-2.54973253934373,l=4.37466414146497,o=2.93816398269878,s=.00778469570904146,h=.32246712907004,u=2.445134137143,i=3.75440866190742;if(a<0||a>1)return 0;if(a<.02425)return(((((t*(p=Math.sqrt(-2*Math.log(a)))+n)*p+r)*p+e)*p+l)*p+o)/((((s*p+h)*p+u)*p+i)*p+1);if(a<=.97575){var p,c=(p=a-.5)*p;return(((((-39.6968302866538*c+220.946098424521)*c-275.928510446969)*c+138.357751867269)*c-30.6647980661472)*c+2.50662827745924)*p/(((((-54.4760987982241*c+161.585836858041)*c-155.698979859887)*c+66.8013118877197)*c-13.2806815528857)*c+1)}return-(((((t*(p=Math.sqrt(-2*Math.log(1-a)))+n)*p+r)*p+e)*p+l)*p+o)/((((s*p+h)*p+u)*p+i)*p+1)}async function sim(a,t,n,r){for(var e=[],l=(t=t||50,n=n||1e3,0);l<n;l++){for(var o=a.slice(),s=0;s<t;s++){for(var h=[],u=1;u<o.length;u++){var i=await dif(o[u],o[u-1]);h.push(i)}var p=await sma(h,h.length),c=await std(h),f=await normsinv(Math.random());o.push(o[o.length-1]*Math.exp(p[0]-c*c/2+c*f))}e.push(o)}if(!r)return e;var m=a.slice();for(l=a.length;l<e[0].length;l++)e.sort((a,t)=>a[l]>t[l]?1:a[l]<t[l]?-1:0),m.push(e[Math.round(e.length*r)][l]);return m}async function cor(a,t){for(var n=await sma(a,a.length),r=await sma(t,t.length),e=0,l=0,o=0,s=0;s<a.length;s++){var h=a[s]-n,u=t[s]-r;e+=h*u,l+=Math.pow(h,2),o+=Math.pow(u,2)}var i=a.length-1;return l/=i,o/=i,e/(i*(l=Math.sqrt(l))*(o=Math.sqrt(o)))}async function dif(a,t){return(a-t)/t}async function aroon_up(a,t){for(var n=t||10,r=[],e=n;e<=a.length;e++){var l=a.slice(e-n,e),o=l.slice();o.sort((a,t)=>a-t),r.push(100*(n-(l.findIndex(a=>a===o[n-1])+1))/n)}return r}async function aroon_down(a,t){for(var n=t||10,r=[],e=n;e<=a.length;e++){var l=a.slice(e-n,e),o=l.slice(0);o.sort((a,t)=>a-t),r.push(100*(n-(l.findIndex(a=>a===o[0])+1))/n)}return r}async function aroon_osc(a,t){for(var n=t||25,r=[],e=await aroon.up(a,n),l=await aroon.down(a,n),o=0;o<e.length;o++)r.push(e[o]-l[o]);return r}async function mfi(a,t){for(var n=t||14,r=[],e=a.map(a=>a[1]),l=a.map(a=>a[0]),o=n;o<=a.length;o++){var s=0,h=0;for(q=o-n;q<o;q++)s+=l[q],h+=e[q];r.push(100-100/(1+s/h))}return r}async function roc(a,t){for(var n=t||14,r=[],e=n;e<=a.length;e++)r.push((a[e-1]-a[e-n])/a[e-n]);return r}async function cop(a,t,n,r){t=t||11,n=n||14,r=r||10,max=Math.max(t,n),co=[];for(var e=max+r;e<a.length;e++){var l=a.slice(e-(max+r),e),o=l.slice(),s=[];l=await roc(l,t),o=await roc(o,n),l.splice(0,l.length-o.length),o.splice(0,o.length-l.length);for(var h=0;h<l.length;h++)s.push(l[h]+o[h]);s=await wma(s,r),co.push(s[s.length-1])}return co}async function kst(a,t,n,r,e,l,o,s,h,u){t=t||10,n=n||15,r=r||20,e=e||30,l=l||10,o=o||10,s=s||10,h=h||15,u=u||9;for(var i=[],p=[],c=Math.max(t,n,r,e)+Math.max(l,o,s,h),f=c;f<a.length;f++){var m=a.slice(f-c,f),g=await roc(m,t),v=await roc(m,n),d=await roc(m,r),x=await roc(m,e);g=await sma(g,l),v=await sma(v,o),d=await sma(d,s),x=await sma(x,h),i.push(g[g.length-1]+v[v.length-1]+d[d.length-1]+x[x.length-1])}var w=await sma(i,u);for(var f in i.splice(0,i.length-w.length),w)p.push([i[f],w[f]]);return p}async function obv(a){for(var t=[0],n=1;n<a.length;n++)a[n][1]>a[n-1][1]&&t.push(t[t.length-1]+a[n][0]),a[n][1]<a[n-1][1]&&t.push(t[t.length-1]-a[n][0]),a[n][1]===a[n-1][1]&&t.push(t[t.length-1]);return t}async function vwap(a,t){for(var n=!t||t>a.length?a.length:t,r=(a=a.map(a=>[a[0]*a[1],a[1]]),[]),e=n;e<=a.length;e++){for(var l=a.slice(e-n,e),o=0,s=0,h=0;h<l.length;h++)o+=l[h][1],s+=l[h][0];r.push(s/o)}return r}async function mom(a,t,n){for(var r=t||10,e=[],l=r-1;l<a.length;l++)n?e.push(a[l]/a[l-(r-1)]*100):e.push(a[l]-a[l-(r-1)]);return e}async function mom_osc(a,t){for(var n=t||9,r=[],e=n;e<a.length;e++){for(var l=0,o=0,s=1;s<n;s++)a[e-n+(s-1)]<a[e-n+s]?l+=a[e-n+s]:o+=a[e-n+s];r.push((l-o)/(l+o)*100)}return r}async function ha(a){for(var t=[[(Number(a[0][0])+Number(a[0][3]))/2,Number(a[0][1]),Number(a[0][2]),(Number(a[0][0])+Number(a[0][1])+Number(a[0][2])+Number(a[0][3]))/4]],n=1;n<a.length;n++)t.push([(t[t.length-1][0]+t[t.length-1][3])/2,Math.max(t[t.length-1][0],t[t.length-1][3],a[n][1]),Math.min(t[t.length-1][0],t[t.length-1][3],a[n][2]),(a[n][0]+a[n][1]+a[n][2]+a[n][3])/4]);return t}async function ren(a,t){for(var n=[],r=(t=t||1,Math.floor(t)===t?0:t.toString().split(".")[1].length||0),e=Math.ceil(a[0][0]/t*10**r)/10**r*t,l=e-t,o=1;o<a.length;o++){if(a[o][0]>e+t)do{n.push([e,e+t,e,e+t]),e+=t,l+=t}while(a[o][0]>e+t);if(a[o][1]<l-t)do{n.push([l,l,l-t,l-t]),e-=t,l-=t}while(a[o][1]<l-t)}return n}const aroon={up:aroon_up,down:aroon_down,osc:aroon_osc};
