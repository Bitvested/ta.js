/* ta.js (c) Nino Kroesen. MIT License. */ async function median(a,e){for(var n=e||a.length,t=[],r=[],s=0;s<a.length;s++)if(t.push(a[s]),t.length>=n){var l=t.slice();l.sort((a,e)=>a>e?-1:a<e?1:0),r.push(l[Math.round(l.length/2)]),t.splice(0,1)}return r}async function rsi(a,e){for(var n=e||14,t=[],r=[],s=1;s<a.length;s++){var l=a[s]-a[s-1];if(t.push(l),t.length>=n){var h=0,u=0;for(q in t)t[q]<0&&(u+=t[q]),t[q]>=0&&(h+=t[q]);h/=n,u=Math.abs(u)/n,rsi=Number(100-100/(1+h/u)),r.push(rsi),t.splice(0,1)}}return r}async function tsi(a,e,n,t){for(var r=e||25,s=n||13,l=t||13,h=[],u=[],o=[],i=[],p=1;p<a.length;p++)h.push(a[p]-a[p-1]),u.push(Math.abs(a[p]-a[p-1]));var c=await ema(h,r),f=await ema(u,r),m=await ema(c,s),g=await ema(f,s);for(p=0;p<m.length;p++)o.push(m[p]/g[p]);var v=await ema(o,l);o.splice(0,o.length-v.length);for(p=0;p<v.length;p++)i.push([v[p],o[p]]);return i}async function bop(a,e){for(var n=[],t=(e=e||14,0);t<a.length;t++)n.push((a[t][3]-a[t][0])/(a[t][1]-a[t][2]));return n=await sma(n,e)}async function fi(a,e){for(var n=e||13,t=[],r=[],s=1;s<a.length;s++)if(t.push(a[s][0]-a[s-1][0]),t.length>n){var l=await ema(t.slice(),n);r.push((a[s][0]-a[s-1][0])*l[0]),t.splice(0,1)}return ffi}async function asi(a){for(var e=[],n=1;n<a.length;n++){var t,r=a[n][1],s=a[n-1][1],l=a[n][0],h=a[n-1][0],u=a[n][2],o=a[n-1][2],i=h-r>o-r?h-r:o-r,p=a[n][0],c=a[n-1][0],f=Math.max(a[n][0],a[n-1][0])-Math.min(a[n][2],a[n-1][2]);l-s>u-s&&l-s>l-u&&(t=l-s-(u-s)/2+(s-c)/4),u-s>l-s&&u-s>l-u&&(t=u-s-(l-s)/2+(s-c)/4),l-u>l-s&&l-u>u-s&&(t=l-u+(s-c)/4),e.push((s-r+(s-c)/2+(r-p)/2)/t*50*i/f)}return e}async function ao(a,e,n){for(var t=e||5,r=n||35,s=[],l=[],h=0;h<a.length;h++)if(s.push((a[h][0]+a[h][1])/2),s.length>=r){var u=await sma(s.slice(),t),o=await sma(s.slice(),r);l.push(u[u.length-1]-o[o.length-1]),s.splice(0,1)}return l}async function pr(a,e){for(var n=e||14,t=[],r=[],s=0;s<a.length;s++)if(r.push(a[s]),r.length>=n-1){var l=await Math.max.apply(null,r),h=await Math.min.apply(null,r);t.push((l-a[s])/(l-h)*-100),r.splice(0,1)}return t}async function lsma(a,e){for(var n=e||25,t=[],r=[],s=0;s<a.length;s++)if(t.push(a[s]),t.length>=n){for(var l,h,u=0,o=0,i=0,p=0,c=1;c<=n;c++)u+=c,o+=t[c-1],i+=t[c-1]*c,p+=c*c,t[c-1]*t[c-1];h=o/n-(l=(i-u*o/n)/(p-u*u/n))*u/n,r.push(l*n+h),t.splice(0,1)}return r}async function don(a,e){for(var n=[],t=[],r=e||20,s=0;s<a.length;s++)if(n.push(a[s]),n.length>=r){var l=[],h=[];for(let a in n)l.push(n[a][0]),h.push(n[a][1]);var u=Math.max.apply(null,l.slice()),o=Math.min.apply(null,h.slice());t.push([u,(u+o)/2,o]),n.splice(0,1)}return t}async function ichimoku(a,e,n,t,r){for(var s=[],l=e||9,h=n||26,u=t||52,o=r||26,i=[],p=[],c=0;c<a.length;c++)if(s.push(a[c]),s.length>u){var f=[],m=[];for(let a in s)f.push(s[a][0]),m.push(s[a][2]);var g=(Math.max.apply(null,f.slice(f.length-1-l,f.length-1))+Math.min.apply(null,m.slice(m.length-1-l,m.length-1)))/2,v=(Math.max.apply(null,f.slice(f.length-1-h,f.length-1))+Math.min.apply(null,m.slice(m.length-1-h,m.length-1)))/2,d=a[c][1]+v,w=(Math.max.apply(null,f.slice(f.length-1-u,f.length-1))+Math.min.apply(null,m.slice(m.length-1-h,m.length-1)))/2;chik=a[c][1],p.push([g,v,d,w,chik]),s.splice(0,1)}for(c=o;c<p.length-o;c++)i.push([p[c][0],p[c][1],p[c+(o-1)][2],p[c+(o-1)][3],p[c+o-1][4]]);return i}async function stoch(a,e,n,t){var r=e||14,s=n||3,l=t||3;r<s&&([r,s]=[s,r]),l>s&&([l,s]=[s,l]);for(var h=[],u=[],o=[],i=[],p=0;p<a.length;p++){if(u.push(a[p][0]),o.push(a[p][2]),u.length>=r){var c=await Math.max.apply(null,u),f=await Math.min.apply(null,o),m=100*(a[p][1]-f)/(c-f);i.push(m)}if(l>0&&i.length>l){var g=await sma(i,l);i.push(g[g.length-1])}if(i.length-l>=s){var v=await sma(i.slice(l),s);h.push([m,v[v.length-1]]),u.splice(0,1),o.splice(0,1),i.splice(0,1)}}return h}async function atr(a,e){for(var n=e||14,t=[],r=0;r<a.length;r++)if(t.length<1)t.push(a[r][0]-a[r][2]);else{var s=await Math.max(a[r][0]-a[r-1][1],a[r][2]-a[r-1][1],a[r][0]-a[r][2]),l=(t[t.length-1]*(n-1)+s)/n;t.push(l)}return t}async function sma(a,e){for(var n=e||14,t=[],r=[],s=0;s<a.length;s++)if(t.push(a[s]),t.length>=n){var l=0;for(q in t)l+=t[q];r.push(l/n),t.splice(0,1)}return r}async function smma(a,e){for(var n=e||14,t=[],r=[],s=0;s<a.length;s++)if(t.push(a[s]),t.length>=n){var l=0;for(q in t)l+=t[q];r?r.push(l/n):r.push((l-sma1+a[s])/n),t.splice(0,1)}return r.splice(0,1),r}async function wma(a,e){for(var n=e||14,t=0,r=1;r<=n;r++)t+=r;var s=[],l=[];for(r=0;r<a.length;r++)if(s.push(a[r]),s.length>=n){var h=0,u=1;for(q in s)h+=s[q]*u/t,u++;l.push(h),s.splice(0,1)}return l}async function vwma(a,e){for(var n=e||20,t=[],r=[],s=0;s<a.length;s++)if(t.push([a[s][0]*a[s][1],a[s][1]]),t.length>=n){for(var l=0,h=0,u=0;u<t.length;u++)l+=t[u][1],h+=t[u][0];r.push(h/l),t.splice(0,1)}return r}async function ema(a,e){for(var n=e||12,t=[],r=[],s=0,l=2/(n+1),h=0;h<a.length;h++){t.push(a[h]);var u=0;if(0==s&&t.length>=n){for(q in t)u+=t[q];u/=n,r.push(u),s=u}else 0!=s&&t.length>=n&&(u=(a[h]-s)*l+s,r.push(u),s=u)}return r}async function hull(a,e){var n=e||14,t=[],r=[],s=await wma(a.slice(),n),l=Math.round(Math.sqrt(n)),h=await wma(a.slice(),Math.round(n/2));h.splice(0,h.length-s.length);for(let a in s)if(t.push(2*h[a]-s[a]),t.length>=l){var u=await wma(t,l);r.push(u[u.length-1])}return r}async function kama(a,e,n,t){e=e||10,n=n||2,t=t||30;for(var r=await sma(a.slice(),e),s=e+1;s<a.length;s++){for(var l=0,h=Math.abs(a[s]-a[s-e]),u=1;u<e;u++)l+=Math.abs(a[s]-a[s-1]);var o=(h/l*(2/(n+1)-2/(t+1)+2/(t+1)))**2;r.push(r[r.length-1]+o*(a[s]-r[r.length-1]))}return r}async function macd(a,e,n){var t=e||12,r=n||26;t>r&&([t,r]=[r,t]);var s=await ema(a,t),l=await ema(a,r);s.splice(0,r-t);for(var h=[],u=0;u<l.length;u++)h.push([s[u]-l[u]]);return h}async function bands(a,e,n){for(var t=e||14,r=n||1,s=[],l=[],h=[],u=await sma(a,t),o=0;o<a.length;o++)if(s.push(a[o]),s.length>=t){var i=await std(s,t);l.push(i),s.splice(0,1)}for(o=0;o<u.length;o++)h.push([u[o]+l[o]*r,u[o],u[o]-l[o]*r]);return h}async function bandwidth(a,e,n){for(var t=e||14,r=n||1,s=[],l=[],h=[],u=await sma(a,t),o=0;o<a.length;o++)if(s.push(a[o]),s.length>=t){var i=await std(s);l.push(i),s.push(a[o]),s.splice(0,1)}for(o=0;o<l.length;o++){var p=(u[o]+l[o]*r-(u[o]-l[o]*r))/u[o];h.push(p)}return h}async function keltner(a,e,n){var t,r=e||14,s=n||1,l=[],h=await atr(a,r),u=[];for(var o in a)l.push((a[o][0]+a[o][1]+a[o][2])/3);t=await sma(l,r),h.splice(0,r-1);for(o=0;o<t.length;o++)u.push([t[o]+h[o]*s,t[o],t[o]-h[o]*s]);return u}async function std(a,e){var n=e||a.length,t=a.reduce((a,e)=>Number(a)+Number(e))/n;return Math.sqrt(a.reduce((a,e)=>a+Math.pow(e-t,2),0)/n)}async function cor(a,e){for(var n=await sma(a.slice(),a.length),t=await sma(e.slice(),e.length),r=0,s=0,l=0,h=0;h<a.length;h++){var u=a[h]-n,o=e[h]-t;r+=u*o,s+=Math.pow(u,2),l+=Math.pow(o,2)}var i=a.length-1;return s/=i,l/=i,r/(i*(s=Math.sqrt(s))*(l=Math.sqrt(l)))}async function dif(a,e){return(a-e)/e}async function aroon_up(a,e){for(var n=e||10,t=[],r=[],s=0;s<a.length;s++)if(t.push(a[s]),t.length>=n){var l=t.slice(0);l.sort((a,e)=>a-e);var h=l[n-1];r.push(100*(n-(t.findIndex(a=>a==h)+1))/n),t.splice(0,1)}return r}async function aroon_down(a,e){for(var n=e||10,t=[],r=[],s=0;s<a.length;s++)if(t.push(a[s]),t.length>=n){var l=t.slice(0);l.sort((a,e)=>a-e);var h=l[0];r.push(100*(n-(t.findIndex(a=>a==h)+1))/n),t.splice(0,1)}return r}async function aroon_osc(a,e){for(var n=e||25,t=[],r=await aroon.up(a,n),s=await aroon.down(a,n),l=0;l<r.length;l++)t.push(r[l]-s[l]);return t}async function mfi(a,e){for(var n=e||14,t=[],r=[],s=[],l=0;l<a.length;l++)if(s.push(a[l][0]),r.push(a[l][1]),s.length>=n){var h=0,u=0;for(q in s)h+=s[q];for(q in r)u+=r[q];t.push(100-100/(1+h/u)),s.splice(0,1),r.splice(0,1)}return t}async function roc(a,e){for(var n=e||14,t=[],r=[],s=0;s<a.length;s++)t.push(a[s]),t.length>=n&&(r.push((t[n-1]-t[0])/t[0]),t.splice(0,1));return r}async function cop(a,e,n,t){e=e||11,n=n||14,t=t||10,max=Math.max(e,n),co=[];for(var r=max+t;r<a.length;r++){var s=a.slice(r-(max+t),r),l=a.slice(r-(max+t),r),h=[];s=await roc(s,e),l=await roc(l,n);for(var u=0;u<Math.max(s,l);u++)h.push(s[u]+l[u]);h=await wma(h.slice(),t),co.push(h[h.length-1])}return co}async function kst(a,e,n,t,r,s,l,h,u,o){e=e||10,n=n||15,t=t||20,r=r||30,s=s||10,l=l||10,h=h||10,u=u||15,o=o||9;for(var i=[],p=[],c=Math.max(e,n,t,r)+Math.max(s,l,h,u),f=c;f<a.length;f++){var m=await roc(a.slice(f-c,f),e),g=await roc(a.slice(f-c,f),n),v=await roc(a.slice(f-c,f),t),d=await roc(a.slice(f-c,f),r);m=await sma(m,s),g=await sma(g,l),v=await sma(v,h),d=await sma(d,u),i.push(m[m.length-1]+g[g.length-1]+v[v.length-1]+d[d.length-1])}var w=await sma(i.slice(),o);for(var f in i.splice(0,i.length-w.length),w)p.push([i[f],w[f]]);return p}async function obv(a){for(var e=[0],n=1;n<a.length;n++)a[n][1]>a[n-1][1]&&e.push(e[e.length-1]+a[n][0]),a[n][1]<a[n-1][1]&&e.push(e[e.length-1]-a[n][0]),a[n][1]==a[n-1][1]&&e.push(e[e.length-1]);return e}async function vwap(a,e){for(var n=!e||e>a.length?a.length:e,t=[],r=[],s=0;s<a.length;s++)if(t.push([a[s][0]*a[s][1],a[s][1]]),t.length>=n){for(var l=0,h=0,u=0;u<t.length;u++)l+=t[u][1],h+=t[u][0];r.push(h/l),t.splice(0,1)}return r}async function mom(a,e,n){for(var t=e||10,r=[],s=t-1;s<a.length;s++)n?r.push(a[s]/a[s-(t-1)]*100):r.push(a[s]-a[s-(t-1)]);return r}async function mom_osc(a,e){for(var n=e||9,t=[],r=[],s=0;s<a.length;s++)if(t.push(a[s]),t.length>n){for(var l=0,h=0,u=1;u<n;u++)t[u-1]<t[u]?l+=t[u]:h+=t[u];r.push((l-h)/(l+h)*100),t.splice(0,1)}return r}async function ha(a){for(var e=[(Number(a[0][1])+Number(a[0][4]))/2,Number(a[0][2]),Number(a[0][3]),(Number(a[0][1])+Number(a[0][2])+Number(a[0][3])+Number(a[0][4]))/4],n=1;n<a.length;n++)e.push((e[e.length-1][0]+e[e.length-1][3])/2,Math.max(open,close,Number(a[n][2])),Math.min(open,close,Number(a[n][3])),(Number(a[n][1])+Number(a[n][2])+Number(a[n][3])+Number(a[n][4]))/4);return e}async function ren(a,e){for(var n=[],t=(e=e||1,Math.floor(e)==e?0:e.toString().split(".")[1].length||0),r=Math.ceil(a[0][0]/e*10**t)/10**t*e,s=r-e,l=1;l<a.length;l++){if(a[l][0]>r+e)do{n.push([r,r+e,r,r+r+e]),r+=e,s+=e}while(a[l][0]>r+e);if(a[l][1]<s-e)do{n.push([r-e,r-e,s+e,s+e]),r-=e,s-=e}while(a[l][1]<s-e)}return n}const aroon={up:aroon_up,down:aroon_down,osc:aroon_osc};
