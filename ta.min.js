/* ta.js (c) Nino Kroesen. MIT License. */ async function median(n,a){for(var t=a||n.length,r=[],e=[],s=0;s<n.length;s++)if(r.push(n[s]),r.length>=t){var l=r.slice();l.sort((n,a)=>n>a?-1:n<a?1:0),e.push(l[Math.round(l.length/2)]),r.splice(0,1)}return e}async function rsi(n,a){for(var t=a||14,r=[],e=[],s=1;s<n.length;s++){var l=n[s]-n[s-1];if(r.push(l),r.length>=t){var h=0,u=0;for(q in r)r[q]<0&&(u+=r[q]),r[q]>=0&&(h+=r[q]);h/=t,u=Math.abs(u)/t,rsi=Number(100-100/(1+h/u)),e.push(rsi),r.splice(0,1)}}return e}async function tsi(n,a,t,r){for(var e=a||25,s=t||13,l=r||13,h=[],u=[],o=[],i=[],p=1;p<n.length;p++)h.push(n[p]-n[p-1]),u.push(Math.abs(n[p]-n[p-1]));var c=await ema(h,e),f=await ema(u,e),m=await ema(c,s),g=await ema(f,s);for(p=0;p<m.length;p++)o.push(m[p]/g[p]);var v=await ema(o,l);o.splice(0,o.length-v.length);for(p=0;p<v.length;p++)i.push([v[p],o[p]]);return i}async function pr(n,a){for(var t=a||14,r=[],e=[],s=0;s<n.length;s++)if(e.push(n[s]),e.length>=t-1){var l=await Math.max.apply(null,e),h=await Math.min.apply(null,e);r.push((l-n[s])/(l-h)*-100),e.splice(0,1)}return r}async function lsma(n,a){for(var t=a||25,r=[],e=[],s=0;s<n.length;s++)if(r.push(n[s]),r.length>=t){for(var l,h,u=0,o=0,i=0,p=0,c=1;c<=t;c++)u+=c,o+=r[c-1],i+=r[c-1]*c,p+=c*c,r[c-1]*r[c-1];h=o/t-(l=(i-u*o/t)/(p-u*u/t))*u/t,e.push(l*t+h),r.splice(0,1)}return e}async function don(n,a){for(var t=[],r=[],e=a||20,s=0;s<n.length;s++)if(t.push(n[s]),t.length>=e){var l=[],h=[];for(let n in t)l.push(t[n][0]),h.push(t[n][1]);var u=Math.max.apply(null,l.slice()),o=Math.min.apply(null,h.slice());r.push([u,(u+o)/2,o]),t.splice(0,1)}return r}async function ichimoku(n,a,t,r,e){for(var s=[],l=a||9,h=t||26,u=r||52,o=e||26,i=[],p=[],c=0;c<n.length;c++)if(s.push(n[c]),s.length>u){var f=[],m=[];for(let n in s)f.push(s[n][0]),m.push(s[n][2]);var g=(Math.max.apply(null,f.slice(f.length-1-l,f.length-1))+Math.min.apply(null,m.slice(m.length-1-l,m.length-1)))/2,v=(Math.max.apply(null,f.slice(f.length-1-h,f.length-1))+Math.min.apply(null,m.slice(m.length-1-h,m.length-1)))/2,d=n[c][1]+v,w=(Math.max.apply(null,f.slice(f.length-1-u,f.length-1))+Math.min.apply(null,m.slice(m.length-1-h,m.length-1)))/2;chik=n[c][1],p.push([g,v,d,w,chik]),s.splice(0,1)}for(c=o;c<p.length-o;c++)i.push([p[c][0],p[c][1],p[c+(o-1)][2],p[c+(o-1)][3],p[c+o-1][4]]);return i}async function stoch(n,a,t,r){var e=a||14,s=t||3,l=r||3;e<s&&([e,s]=[s,e]),l>s&&([l,s]=[s,l]);for(var h=[],u=[],o=[],i=[],p=0;p<n.length;p++){if(u.push(n[p][0]),o.push(n[p][2]),u.length>=e){var c=await Math.max.apply(null,u),f=await Math.min.apply(null,o),m=100*(n[p][1]-f)/(c-f);i.push(m)}if(l>0&&i.length>l){var g=await sma(i,l);i.push(g[g.length-1])}if(i.length-l>=s){var v=await sma(i.slice(l),s);h.push([m,v[v.length-1]]),u.splice(0,1),o.splice(0,1),i.splice(0,1)}}return h}async function atr(n,a){for(var t=a||14,r=[],e=0;e<n.length;e++)if(r.length<1)r.push(n[e][0]-n[e][2]);else{var s=await Math.max(n[e][0]-n[e-1][1],n[e][2]-n[e-1][1],n[e][0]-n[e][2]),l=(r[r.length-1]*(t-1)+s)/t;r.push(l)}return r}async function sma(n,a){for(var t=a||14,r=[],e=[],s=0;s<n.length;s++)if(r.push(n[s]),r.length>=t){var l=0;for(q in r)l+=r[q];e.push(l/t),r.splice(0,1)}return e}async function smma(n,a){for(var t=a||14,r=[],e=[],s=0;s<n.length;s++)if(r.push(n[s]),r.length>=t){var l=0;for(q in r)l+=r[q];e?e.push(l/t):e.push((l-sma1+n[s])/t),r.splice(0,1)}return e.splice(0,1),e}async function wma(n,a){for(var t=a||14,r=0,e=1;e<=t;e++)r+=e;var s=[],l=[];for(e=0;e<n.length;e++)if(s.push(n[e]),s.length>=t){var h=0,u=1;for(q in s)h+=s[q]*u/r,u++;l.push(h),s.splice(0,1)}return l}async function vwma(n,a){for(var t=a||20,r=[],e=[],s=0;s<n.length;s++)if(r.push([n[s][0]*n[s][1],n[s][1]]),r.length>=t){for(var l=0,h=0,u=0;u<r.length;u++)l+=r[u][1],h+=r[u][0];e.push(h/l),r.splice(0,1)}return e}async function ema(n,a){for(var t=a||12,r=[],e=[],s=0,l=2/(t+1),h=0;h<n.length;h++){r.push(n[h]);var u=0;if(0==s&&r.length>=t){for(q in r)u+=r[q];u/=t,e.push(u),s=u}else 0!=s&&r.length>=t&&(u=(n[h]-s)*l+s,e.push(u),s=u)}return e}async function hull(n,a){var t=a||14,r=[],e=[],s=await wma(n.slice(),t),l=Math.round(Math.sqrt(t)),h=await wma(n.slice(),Math.round(t/2));h.splice(0,h.length-s.length);for(let n in s)if(r.push(2*h[n]-s[n]),r.length>=l){var u=await wma(r,l);e.push(u[u.length-1])}return e}async function macd(n,a,t){var r=a||12,e=t||26;r>e&&([r,e]=[e,r]);var s=await ema(n,r),l=await ema(n,e);s.splice(0,e-r);for(var h=[],u=0;u<l.length;u++)h.push([s[u]-l[u]]);return h}async function bands(n,a,t){for(var r=a||14,e=t||1,s=[],l=[],h=[],u=await sma(n,r),o=0;o<n.length;o++)if(s.push(n[o]),s.length>=r){var i=await std(s,r);l.push(i),s.splice(0,1)}for(o=0;o<u.length;o++)h.push([u[o]+l[o]*e,u[o],u[o]-l[o]*e]);return h}async function bandwidth(n,a,t){for(var r=a||14,e=t||1,s=[],l=[],h=[],u=await sma(n,r),o=0;o<n.length;o++)if(s.push(n[o]),s.length>=r){var i=await std(s);l.push(i),s.push(n[o]),s.splice(0,1)}for(o=0;o<l.length;o++){var p=(u[o]+l[o]*e-(u[o]-l[o]*e))/u[o];h.push(p)}return h}async function keltner(n,a,t){var r,e=a||14,s=t||1,l=[],h=await atr(n,e),u=[];for(var o in n)l.push((n[o][0]+n[o][1]+n[o][2])/3);r=await sma(l,e),h.splice(0,e-1);for(o=0;o<r.length;o++)u.push([r[o]+h[o]*s,r[o],r[o]-h[o]*s]);return u}async function std(n,a){var t=a||n.length,r=n.reduce((n,a)=>Number(n)+Number(a))/t;return Math.sqrt(n.reduce((n,a)=>n+Math.pow(a-r,2),0)/t)}async function cor(n,a){for(var t=await sma(n.slice(),n.length),r=await sma(a.slice(),a.length),e=0,s=0,l=0,h=0;h<n.length;h++){var u=n[h]-t,o=a[h]-r;e+=u*o,s+=Math.pow(u,2),l+=Math.pow(o,2)}var i=n.length-1;return s/=i,l/=i,e/(i*(s=Math.sqrt(s))*(l=Math.sqrt(l)))}async function dif(n,a){return(n-a)/a}async function aroon_up(n,a){for(var t=a||10,r=[],e=[],s=0;s<n.length;s++)if(r.push(n[s]),r.length>=t){var l=r.slice(0);l.sort((n,a)=>n-a);var h=l[t-1];e.push(100*(t-(r.findIndex(n=>n==h)+1))/t),r.splice(0,1)}return e}async function aroon_down(n,a){for(var t=a||10,r=[],e=[],s=0;s<n.length;s++)if(r.push(n[s]),r.length>=t){var l=r.slice(0);l.sort((n,a)=>n-a);var h=l[0];e.push(100*(t-(r.findIndex(n=>n==h)+1))/t),r.splice(0,1)}return e}async function aroon_osc(n,a){for(var t=a||25,r=[],e=await aroon.up(n,t),s=await aroon.down(n,t),l=0;l<e.length;l++)r.push(e[l]-s[l]);return r}async function mfi(n,a){for(var t=a||14,r=[],e=[],s=[],l=0;l<n.length;l++)if(s.push(n[l][0]),e.push(n[l][1]),s.length>=t){var h=0,u=0;for(q in s)h+=s[q];for(q in e)u+=e[q];r.push(100-100/(1+h/u)),s.splice(0,1),e.splice(0,1)}return r}async function roc(n,a){for(var t=a||14,r=[],e=[],s=0;s<n.length;s++)r.push(n[s]),r.length>=t&&(e.push((r[t-1]-r[0])/r[0]),r.splice(0,1));return e}async function obv(n){for(var a=[0],t=1;t<n.length;t++)n[t][1]>n[t-1][1]&&a.push(a[a.length-1]+n[t][0]),n[t][1]<n[t-1][1]&&a.push(a[a.length-1]-n[t][0]),n[t][1]==n[t-1][1]&&a.push(a[a.length-1]);return a}async function vwap(n,a){for(var t=!a||a>n.length?n.length:a,r=[],e=[],s=0;s<n.length;s++)if(r.push([n[s][0]*n[s][1],n[s][1]]),r.length>=t){for(var l=0,h=0,u=0;u<r.length;u++)l+=r[u][1],h+=r[u][0];e.push(h/l),r.splice(0,1)}return e}async function mom(n,a,t){for(var r=a||10,e=[],s=r-1;s<n.length;s++)t?e.push(n[s]/n[s-(r-1)]*100):e.push(n[s]-n[s-(r-1)]);return e}const aroon={up:aroon_up,down:aroon_down,osc:aroon_osc};
