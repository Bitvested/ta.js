/* ta.js (c) Nino Kroesen. MIT License. */ async function median(a,e=a.length){for(var n=e,t=[];n<=a.length;n++){var r=a.slice(n-e,n);r.sort(((a,e)=>a-e)),t.push(r[Math.round(r.length/2)-1])}return t}async function kmeans(a,e){for(var n,t=[],r=[],l=[],s=!1,h=Math.round(a.length/(e+1)),u=0;u<e;u++)r[u]=a[h*(u+1)];do{for(u=0;u<e;u++)t[u]=[];for(var o=0;o<a.length;o++){for(var i=-1,p=0;p<e;p++){var c=Math.abs(r[p]-a[o]);(-1===i||c<=i)&&(i=c,n=p)}t[n].push(a[o])}l=r;for(o=0;o<e;o++){var g=0;for(p=0;p<t[o].length;p++)g+=t[o][p];var f=g/t[n].length;r[o]=f}for(o=0;o<e;o++)r[o]!==l[o]&&(s=!0)}while(s);return t}async function normalize(a,e=0){for(var n=0,t=await Math.max.apply(null,a.slice())*(1+e),r=await Math.min.apply(null,a.slice())*(1-e),l=[];n<a.length;n++)l.push(1-(t-a[n])/(t-r));return l}async function denormalize(a,e,n=0){for(var t=0,r=await Math.max.apply(null,a.slice())*(1+n),l=await Math.min.apply(null,a.slice())*(1-n),s=[];t<e.length;t++)s.push(l+e[t]*(r-l));return s}async function normalize_pair(a,e){for(var n=1,t=(a[0]+e[0])/2,r=[[t,t]];n<a.length;n++)r.push([r[r.length-1][0]*((a[n]-a[n-1])/a[n-1]+1),r[r.length-1][1]*((e[n]-e[n-1])/e[n-1]+1)]);return r}async function normalize_from(a,e){for(var n=1,t=[e];n<a.length;n++)t.push(t[t.length-1]*((a[n]-a[n-1])/a[n-1]+1));return t}async function standardize(a){for(var e=await module.exports.sma(a,a.length),n=await module.exports.std(a),t=[],r=0;r<a.length;r++)t.push((a[r]-e[0])/n);return t}async function mad(a,e=a.length){for(var n=e,t=[];n<=a.length;n++){var r=a.slice(n-e,n),l=await module.exports.median(r),s=r.map((a=>Math.abs(a-l[l.length-1])));s=await module.exports.median(s),t.push(s[s.length-1])}return t}async function aad(a,e=a.length){for(var n=e,t=[];n<=a.length;n++){var r=a.slice(n-e,n),l=0,s=await module.exports.sma(r,e);for(var h in r)l+=Math.abs(r[h]-s[s.length-1]);t.push(l/e)}return t}async function ssd(a,e=a.length){for(var n=e,t=[];n<=a.length;n++){var r=a.slice(n-e,n),l=await module.exports.sma(r,e),s=0;for(var h in r)s+=(r[h]-l[l.length-1])**2;t.push(Math.sqrt(s))}return t}async function er(a){var e=[],n=[],t=1,r=1;for(var l in a)a[l]>=0?e.push(1+a[l]):n.push(1+a[l]);var s=e.length/a.length,h=n.length/a.length;for(var l in n)r*=n[l];for(var l in e)t*=e[l];return(100*(t**(1/e.length)-1)*s+100*(r**(1/n.length)-1)*h)/100}async function ar(a,e=a.length){for(var n=e,t=[];n<a.length;n++){var r=await module.exports.er(a.slice(n-e,n));t.push(a[n]-r)}return t}async function kelly(a){var e=await module.exports.er(a)+1,n=await module.exports.winratio(a);return isNaN(e)&&(e=1),n-(1-n)/e}async function martingale(a,e,n,t=2){var r=e;for(var l in a)a[l]<0?r*=t:a[l]>0&&(r=e);return r>n?n:r}async function antimartingale(a,e,n,t=2){var r=e;for(var l in a)a[l]>0?r*=t:a[l]<0&&(r=e);return r>n?n:r}async function winratio(a){var e=0,n=0;for(var t in a)a[t]>=0?e++:n++;return e/(n+e)}async function avgwin(a){for(var e=0,n=[];e<a.length;e++)a[e]>=0&&n.push(a[e]);return(await module.exports.sma(n,n.length))[0]}async function avgloss(a){for(var e=[],n=0;n<a.length;n++)a[n]<0&&e.push(a[n]);return(await module.exports.sma(e,e.length))[0]}async function zscore(a,e=a.length){for(var n=e-1,t=[],r=a.slice(0,e-1);n<a.length;n++){r.push(a[n]);var l=await module.exports.sma(r,e),s=await module.exports.std(r,e);t.push((a[n]-l[0])/s),r.splice(0,1)}return t}async function rsi(a,e=14){for(var n=e-1,t=0,r=0,l=[],s=a.slice(0,e-1);n<a.length;n++,t=0,r=0){s.push(a[n]);for(var h=1;h<s.length;h++)s[h]-s[h-1]<0?r+=Math.abs(s[h]-s[h-1]):t+=s[h]-s[h-1];var u=100-100/(1+t/e/(r/e));l.push(u),s.splice(0,1)}return l}async function wrsi(a,e=14){for(var n=1,t=[],r=[],l=[];n<a.length;n++)a[n]-a[n-1]<0?(l.push(Math.abs(a[n]-a[n-1])),r.push(0)):(l.push(0),r.push(a[n]-a[n-1]));for(var n in l=await module.exports.wsma(l,e),r=await module.exports.wsma(r,e),l)t.push(100-100/(1+r[n]/l[n]));return t}async function tsi(a,e=25,n=13,t=13){for(var r=1,l=[],s=[],h=[],u=[];r<a.length;r++)l.push(a[r]-a[r-1]),s.push(Math.abs(a[r]-a[r-1]));var o=await module.exports.ema(l,e),i=await module.exports.ema(s,e),p=await module.exports.ema(o,n),c=await module.exports.ema(i,n);for(r=0;r<p.length;r++)h.push(p[r]/c[r]);var g=await module.exports.ema(h,t);h.splice(0,h.length-g.length);for(r=0;r<g.length;r++)u.push([g[r],h[r]]);return u}async function bop(a,e=14){var n=a.map((a=>(a[3]-a[0])/(a[1]-a[2])));return n=await module.exports.sma(n,e)}async function fi(a,e=13){for(var n=1,t=[],r=[];n<a.length;n++)if(t.push((a[n][0]-a[n-1][0])*a[n][1]),t.length>=e){var l=await module.exports.ema(t,e);r.push(l[l.length-1]),t.splice(0,1)}return r}async function asi(a){for(var e=1,n=[];e<a.length;e++){var t,r=a[e][1],l=a[e-1][1],s=a[e][0],h=a[e-1][0],u=a[e][2],o=a[e-1][2],i=h-r>o-r?h-r:o-r,p=a[e][0],c=a[e-1][0],g=Math.max(a[e][0],a[e-1][0])-Math.min(a[e][2],a[e-1][2]);s-l>u-l&&s-l>s-u&&(t=s-l-(u-l)/2+(l-c)/4),u-l>s-l&&u-l>s-u&&(t=u-l-(s-l)/2+(l-c)/4),s-u>s-l&&s-u>u-l&&(t=s-u+(l-c)/4),n.push((l-r+(l-c)/2+(r-p)/2)/t*50*i/g)}return n}async function ao(a,e=5,n=35){a=a.map((a=>(a[0]+a[1])/2));for(var t=n,r=[];t<=a.length;t++){var l=a.slice(t-n,t),s=await module.exports.sma(l,e),h=await module.exports.sma(l,n);r.push(s[s.length-1]-h[h.length-1])}return r}async function ac(a,e=5,n=35){var t=await ao(a,e,n),r=await sma(t,e),l=[];for(var s in t.length>r.length?t.splice(0,t.length-r.length):r.splice(0,r.length-t.length),t)l.push(t[s]-r[s]);return l}const fib=async(a,e)=>[a,.236*(e-a)+a,.382*(e-a)+a,.5*(e-a)+a,.618*(e-a)+a,.786*(e-a)+a,e,1.618*(e-a)+a,2.618*(e-a)+a,3.618*(e-a)+a,4.236*(e-a)+a];async function pr(a,e=14){for(var n=e,t=[];n<=a.length;n++){var r=a.slice(n-e,n),l=await Math.max.apply(null,r),s=await Math.min.apply(null,r);t.push((l-a[n-1])/(l-s)*-100)}return t}async function lsma(a,e=25){for(var n=e,t=[];n<=a.length;n++){for(var r,l,s=a.slice(n-e,n),h=0,u=0,o=0,i=0,p=1;p<=e;p++)h+=p,u+=s[p-1],o+=s[p-1]*p,i+=p*p,s[p-1]*s[p-1];l=u/e-(r=(o-h*u/e)/(i-h*h/e))*h/e,t.push(r*e+l)}return t}async function don(a,e=20){for(var n=e,t=[];n<=a.length;n++){var r=a.slice(n-e,n),l=[],s=[];for(var h in r)l.push(r[h][0]),s.push(r[h][1]);var u=Math.max.apply(null,l.slice()),o=Math.min.apply(null,s.slice());t.push([u,(u+o)/2,o])}return t}async function ichimoku(a,e=9,n=26,t=52,r=26){for(var l=0,s=[],h=[],u=[];l<a.length;l++)if(s.push(a[l]),s.length>=t){var o=[],i=[];for(var p in s)o.push(s[p][0]),i.push(s[p][2]);var c=(Math.max.apply(null,o.slice(o.length-e,o.length))+Math.min.apply(null,i.slice(i.length-e,i.length)))/2,g=(Math.max.apply(null,o.slice(o.length-n,o.length))+Math.min.apply(null,i.slice(i.length-n,i.length)))/2,f=a[l][1]+g,v=(Math.max.apply(null,o.slice(o.length-t,o.length))+Math.min.apply(null,i.slice(i.length-n,i.length)))/2;chik=a[l][1],u.push([c,g,f,v,chik]),s.splice(0,1)}for(l=r;l<u.length-r;l++)h.push([u[l][0],u[l][1],u[l+r][2],u[l+r][3],u[l-r][4]]);return h}async function stoch(a,e=14,n=3,t=3){e<n&&([e,n]=[n,e]),t>n&&([t,n]=[n,t]);for(var r=0,l=[],s=[],h=[],u=[];r<a.length;r++){if(s.push(a[r][0]),h.push(a[r][2]),s.length>=e){var o=await Math.max.apply(null,s),i=await Math.min.apply(null,h),p=100*(a[r][1]-i)/(o-i);u.push(p)}if(t>0&&u.length>t){var c=await module.exports.sma(u,t);u.push(c[c.length-1])}if(u.length-t>=n){var g=await module.exports.sma(u,n);l.push([p,g[g.length-1]]),s.splice(0,1),h.splice(0,1),u.splice(0,1)}}return l}async function atr(a,e=14){for(var n=1,t=[a[0][0]-a[0][2]];n<a.length;n++){var r=await Math.max(a[n][0]-a[n-1][1],a[n][2]-a[n-1][1],a[n][0]-a[n][2]);t.push((t[t.length-1]*(e-1)+r)/e)}return t}async function sma(a,e=14){for(var n=e,t=[];n<=a.length;n++){var r=await module.exports.sum(a.slice(n-e,n));t.push(r/e)}return t}async function smma(a,e=14){for(var n=e,t=[];n<=a.length;n++){var r=a.slice(n-e,n),l=0;for(var s in r)l+=r[s];t.length<=0?t.push(l/e):t.push((l-t[t.length-1])/e)}return t.splice(0,1),t}async function wma(a,e=14){for(var n=1,t=0,r=[];n<=e;n++)t+=n;for(n=e;n<=a.length;n++){var l=a.slice(n-e,n),s=0;for(var h in l)s+=l[h]*(Number(h)+1)/t;r.push(s)}return r}async function wsma(a,e=14){for(var n=e,t=[],r=1/e;n<=a.length;n++)if(t.length>0)t.push((a[n-1]-t[t.length-1])*r+t[t.length-1]);else{var l=a.slice(n-e,n),s=0;for(var h in l)s+=l[h];t.push(s/e)}return t}async function pwma(a,e=14){for(var n=e/2,t=e,r=0,l=[],s=[];n>=1;n--,t--)n%1!=0?r+=(n=Math.round(n))*t:(s.push(n*t),r+=n*t*2),s.unshift(n*t);for(n=e;n<=a.length;n++){for(var h=0,u=a.slice(n-e,n),o=e-1;o>=0;o--)h+=u[o]*s[o]/r;l.push(h)}return l}async function hwma(a,e=14){for(var n=1,t=e,r=0,l=[],s=[];n<=e/2;n++,t--)n%1!=0?r+=(n=Math.round(n))*t:(s.push(n*t),r+=n*t*2),s.unshift(n*t);for(n=e;n<=a.length;n++){for(var h=0,u=a.slice(n-e,n),o=e-1;o>=0;o--)h+=u[o]*s[o]/r;l.push(h)}return l}async function vwma(a,e=20){a=a.map((a=>[a[0]*a[1],a[1]]));for(var n=e,t=[];n<=a.length;n++){for(var r=a.slice(n-e,n),l=0,s=0,h=0;h<r.length;h++)l+=r[h][1],s+=r[h][0];t.push(s/l)}return t}async function ema(a,e=12){for(var n=e,t=[],r=2/(e+1);n<=a.length;n++)if(t.length>0)t.push((a[n-1]-t[t.length-1])*r+t[t.length-1]);else{var l=a.slice(n-e,n),s=0;for(var h in l)s+=l[h];t.push(s/e)}return t}async function hull(a,e=14){var n=[],t=[],r=await module.exports.wma(a,e),l=Math.round(Math.sqrt(e)),s=await wma(a,Math.round(e/2));for(var h in s.splice(0,s.length-r.length),r)if(n.push(2*s[h]-r[h]),n.length>=l){var u=await wma(n,l);t.push(u[0]),n.splice(0,1)}return t}async function kama(a,e=10,n=2,t=30){for(var r=e+1,l=[(l=await module.exports.sma(a,e))[l.length-1]];r<a.length;r++){for(var s=0,h=Math.abs(a[r]-a[r-e]),u=1;u<e;u++)s+=Math.abs(a[r-u]-a[r-u-1]);var o=(h/s*(2/(n+1)-2/(t+1)+2/(t+1)))**2;l.push(l[l.length-1]+o*(a[r]-l[l.length-1]))}return l}async function macd(a,e=12,n=26){e>n&&([e,n]=[n,e]);var t=await module.exports.ema(a,e),r=await module.exports.ema(a,n),l=[];t.splice(0,n-e);for(var s=0;s<r.length;s++)l.push(t[s]-r[s]);return l}async function macd_signal(a,e=12,n=26,t=9){var r=await module.exports.macd(a,e,n);return await module.exports.ema(r,t)}async function macd_bars(a,e=12,n=26,t=9){var r=await module.exports.macd(a,e,n),l=await module.exports.ema(r,t),s=[];for(var h in r.splice(0,r.length-l.length),r)s.push(r[h]-l[h]);return s}async function bands(a,e=14,n=1){for(var t=0,r=[],l=[],s=[],h=await module.exports.sma(a,e);t<a.length;t++)if(r.push(a[t]),r.length>=e){var u=await module.exports.std(r,e);l.push(u),r.splice(0,1)}for(t=0;t<h.length;t++)s.push([h[t]+l[t]*n,h[t],h[t]-l[t]*n]);return s}async function bandwidth(a,e=14,n=1){for(var t=0,r=[],l=await module.exports.bands(a,e,n);t<l.length;t++)r.push((l[t][0]-l[t][2])/l[t][1]);return r}async function keltner(a,e=14,n=1){var t,r=[],l=await module.exports.atr(a,e),s=[];for(var h in a)r.push((a[h][0]+a[h][1]+a[h][2])/3);t=await module.exports.sma(r,e),l.splice(0,e-1);for(h=0;h<t.length;h++)s.push([t[h]+l[h]*n,t[h],t[h]-l[h]*n]);return s}async function variance(a,e=a.length){for(var n=e,t=[];n<=a.length;n++){var r=a.slice(n-e,n),l=await module.exports.sma(r,e),s=0;for(var h in r)s+=(r[h]-l[l.length-1])**2;t.push(s/e)}return t}async function std(a,e=a.length){e<a.length&&a.splice(0,a.length-e);var n=a.reduce(((a,e)=>a+e))/e;return Math.sqrt(a.reduce(((a,e)=>a+Math.pow(e-n,2)),0)/e)}async function normsinv(a){var e=-.00778489400243029,n=-.322396458041136,t=-2.40075827716184,r=-2.54973253934373,l=4.37466414146497,s=2.93816398269878,h=.00778469570904146,u=.32246712907004,o=2.445134137143,i=3.75440866190742,p=.02425;if(a<0||a>1)return 0;if(a<p)return(((((e*(c=Math.sqrt(-2*Math.log(a)))+n)*c+t)*c+r)*c+l)*c+s)/((((h*c+u)*c+o)*c+i)*c+1);if(a<=.97575){var c,g=(c=a-.5)*c;return(((((-39.6968302866538*g+220.946098424521)*g-275.928510446969)*g+138.357751867269)*g-30.6647980661472)*g+2.50662827745924)*c/(((((-54.4760987982241*g+161.585836858041)*g-155.698979859887)*g+66.8013118877197)*g-13.2806815528857)*g+1)}return-(((((e*(c=Math.sqrt(-2*Math.log(1-a)))+n)*c+t)*c+r)*c+l)*c+s)/((((h*c+u)*c+o)*c+i)*c+1)}async function sim(a,e=50,n=1e3,t){for(var r=0,l=[];r<n;r++){for(var s=a.slice(),h=0;h<e;h++){for(var u=[],o=1;o<s.length;o++){var i=await module.exports.dif(s[o],s[o-1]);u.push(i)}var p=await module.exports.sma(u,u.length),c=await module.exports.std(u),g=await module.exports.normsinv(Math.random());s.push(s[s.length-1]*Math.exp(p[0]-c*c/2+c*g))}l.push(s)}return t?await module.exports.percentile(l,t):l}async function percentile(a,e){for(var n=0,t=[];n<a[0].length;n++)a.sort(((a,e)=>a[n]-e[n])),t.push(a[Math.round((a.length-1)*e)][n]);return t}async function cor(a,e){for(var n=await module.exports.sma(a,a.length),t=await module.exports.sma(e,e.length),r=0,l=0,s=0,h=0;h<a.length;h++){var u=a[h]-n,o=e[h]-t;r+=u*o,l+=Math.pow(u,2),s+=Math.pow(o,2)}var i=a.length-1;return l/=i,s/=i,r/(i*(l=Math.sqrt(l))*(s=Math.sqrt(s)))}const dif=async(a,e)=>(a-e)/e,log=async a=>a.map((a=>Math.log(a))),exp=async a=>a.map((a=>Math.exp(a)));async function drawdown(a){for(var e=1,n=a[0],t=a[0],r=0;e<a.length;e++){if(a[e]>n){if(0!=t)(l=await module.exports.dif(t,n))<r&&(r=l),t=a[e];n=a[e]}a[e]<t&&(t=a[e])}var l;return(l=await module.exports.dif(t,n))<r&&(r=l),r}async function aroon_up(a,e=10){for(var n=e,t=[];n<=a.length;n++){var r=a.slice(n-e,n),l=r.slice();l.sort(((a,e)=>a-e)),t.push(100*(e-1-r.reverse().findIndex((a=>a===l[e-1])))/(e-1))}return t}async function aroon_down(a,e=10){for(var n=e,t=[];n<=a.length;n++){var r=a.slice(n-e,n),l=r.slice();l.sort(((a,e)=>a-e)),t.push(100*(e-1-r.reverse().findIndex((a=>a===l[0])))/(e-1))}return t}async function aroon_osc(a,e=25){for(var n=0,t=[],r=await module.exports.aroon.up(a,e),l=await module.exports.aroon.down(a,e);n<r.length;n++)t.push(r[n]-l[n]);return t}async function mfi(a,e=14){for(var n=e,t=[],r=a.map((a=>a[1])),l=a.map((a=>a[0])),s=0,h=0;n<=a.length;n++,s=0,h=0){for(var u=n-e;u<n;u++)s+=l[u],h+=r[u];t.push(100-100/(1+s/h))}return t}async function roc(a,e=14){for(var n=e,t=[];n<=a.length;n++)t.push((a[n-1]-a[n-e])/a[n-e]);return t}async function cop(a,e=11,n=14,t=10){for(var r=Math.max(e,n),l=[],s=r+t;s<a.length;s++){var h=a.slice(s-(r+t),s),u=h.slice(),o=[];h=await module.exports.roc(h,e),u=await module.exports.roc(u,n),h.splice(0,h.length-u.length),u.splice(0,u.length-h.length);for(var i=0;i<h.length;i++)o.push(h[i]+u[i]);o=await module.exports.wma(o,t),l.push(o[o.length-1])}return l}async function kst(a,e=10,n=15,t=20,r=30,l=10,s=10,h=10,u=15,o=9){for(var i=[],p=[],c=Math.max(e,n,t,r)+Math.max(l,s,h,u),g=c;g<=a.length;g++){var f=a.slice(g-c,g),v=await module.exports.roc(f,e),m=await module.exports.roc(f,n),d=await module.exports.roc(f,t),x=await module.exports.roc(f,r);v=await module.exports.sma(v,l),m=await module.exports.sma(m,s),d=await module.exports.sma(d,h),x=await module.exports.sma(x,u),i.push(v[v.length-1]+m[m.length-1]+d[d.length-1]+x[x.length-1])}var w=await module.exports.sma(i,o);for(var g in i.splice(0,i.length-w.length),w)p.push([i[g],w[g]]);return p}async function obv(a){for(var e=1,n=[0];e<a.length;e++)a[e][1]>a[e-1][1]&&n.push(n[n.length-1]+a[e][0]),a[e][1]<a[e-1][1]&&n.push(n[n.length-1]-a[e][0]),a[e][1]===a[e-1][1]&&n.push(n[n.length-1]);return n}async function vwap(a,e=a.length){a=a.map((a=>[a[0]*a[1],a[1]]));for(var n=e,t=[];n<=a.length;n++){for(var r=a.slice(n-e,n),l=0,s=0,h=0;h<r.length;h++)l+=r[h][1],s+=r[h][0];t.push(s/l)}return t}async function mom(a,e=10,n){for(var t=e-1,r=[];t<a.length;t++)n?r.push(a[t]/a[t-(e-1)]*100):r.push(a[t]-a[t-(e-1)]);return r}async function mom_osc(a,e=10){for(var n=++e,t=[],r=0,l=0;n<=a.length;n++,r=0,l=0){for(var s=1;s<e;s++)a[n-e+(s-1)]<a[n-e+s]?r+=a[n-e+s]:l+=a[n-e+s];t.push((r-l)/(r+l)*100)}return t}async function ha(a){for(var e=[[(a[0][0]+a[0][3])/2,a[0][1],a[0][2],(a[0][0]+a[0][1]+a[0][2]+a[0][3])/4]],n=1;n<a.length;n++)e.push([(e[e.length-1][0]+e[e.length-1][3])/2,Math.max(e[e.length-1][0],e[e.length-1][3],a[n][1]),Math.min(e[e.length-1][0],e[e.length-1][3],a[n][2]),(a[n][0]+a[n][1]+a[n][2]+a[n][3])/4]);return e}async function ren(a,e=1){for(var n=[],t=Math.floor(e)===e?0:e.toString().split(".")[1].length||0,r=Math.ceil(a[0][0]/e*10**t)/10**t*e,l=r-e,s=1;s<a.length;s++){if(a[s][0]>r+e)do{n.push([r,r+e,r,r+e]),r+=e,l+=e}while(a[s][0]>r+e);if(a[s][1]<l-e)do{n.push([l,l,l-e,l-e]),r-=e,l-=e}while(a[s][1]<l-e)}return n}async function envelope(a,e=10,n=.005){for(var t=e,r=[];t<a.length;t++){var l=await module.exports.sma(a.slice(t-e,t),e);r.push([l[0]*(1+n),l[0],l[0]*(1-n)])}return r}async function chaikin_osc(a,e=3,n=10){for(var t=0,r=[],l=[];t<a.length;t++){var s=(a[t][1]-a[t][2]-(a[t][0]-a[t][1]))/(a[t][0]-a[t][2]);isNaN(s)?l.push(0):l.push(s*a[t][3])}var h=await module.exports.ema(l,e),u=await module.exports.ema(l,n);h.length>u.length?h.splice(0,h.length-u.length):u.splice(0,u.length-h.length);for(t=0;t<h.length;t++)r.push(h[t]-u[t]);return r}async function fractals(a){for(var e=[[!1,!1],[!1,!1]],n=2;n<a.length-2;n++){var t=a[n-2][0]<a[n][0]&&a[n-1][0]<a[n][0]&&a[n][0]>a[n+1][0]&&a[n][0]>a[n+2][0],r=a[n-2][1]>a[n][1]&&a[n-1][1]>a[n][1]&&a[n][1]<a[n+1][1]&&a[n][1]<a[n+2][1];e.push([t,r])}return e.push([!1,!1],[!1,!1]),e}async function alligator(a,e=13,n=8,t=5,r=8,l=5,s=3){var h=[],u=await module.exports.smma(a,e),o=await module.exports.smma(a,n),i=await module.exports.smma(a,t);o.splice(0,o.length-u.length),i.splice(0,i.length-u.length);for(var p=u.length-1;p>=7;p--)h.push([u[p-(r-1)],o[p-(l-1)],i[p-(s-1)]]);return h}async function gator(a,e=13,n=8,t=5,r=8,l=5,s=3){var h=[],u=await module.exports.smma(a,e),o=await module.exports.smma(a,n),i=await module.exports.smma(a,t);o.splice(0,o.length-u.length),i.splice(0,i.length-u.length);for(var p=u.length-1;p>=r-1;p--)h.push([u[p-(r-1)]-o[p-(l-1)],-Math.abs(o[p-(l-1)]-i[p-(s-1)])]);return h}async function recent_high(a,e=25){for(var n=a.length-2,t=e,r=0,l=a[a.length-1];n>=0&&(a[n]>=l&&t>0?(l=a[n],r=n,t=e):t--,!(t<=0));n--);return{index:r,value:l}}async function recent_low(a,e=25){for(var n=a.length-2,t=e,r=0,l=a[a.length-1];n>=0&&(a[n]<=l&&t>0?(l=a[n],r=n,t=e):t--,!(t<=0));n--);return{index:r,value:l}}async function support(a,e=recent_low(a)){var n,t,r=(e=await e).value;do{for(var l=e.index;l<a.length;l++){var s=(e.value-a[l])/(e.index-l);s<r&&(r=s,n=l)}e.index+1==n&&n!=a.length-1?(e.index=n,r=Math.min.apply(null,a.slice()),e.value=a[e.index],t=!1):t=!0,e.index==a.length-1&&(t=!0)}while(!t);return n==a.length-1||e.index==a.length-1?{calculate:async a=>e.value,slope:0,lowest:e.value,index:e.index}:{calculate:async a=>a*r+e.value,slope:r,lowest:e.value,index:e.index}}async function resistance(a,e){var n,t,r=(e=e||await recent_high(a)).value;do{for(var l=e.index;l<a.length;l++){var s=(a[l]-e.value)/(e.index-l);s<r&&(r=s,n=l)}e.index+1==n&&n!=a.length-1?(e.index=n,r=Math.max.apply(null,a.slice()),e.value=a[e.index],t=!1):t=!0,e.index==a.length-1&&(t=!0)}while(!t);return n==a.length-1||e.index==a.length-1?{calculate:async a=>e.value,slope:0,highest:e.value,index:e.index}:{calculate:async a=>a*-r+e.value,slope:r,highest:e.value,index:e.index}}async function fisher(a,e){for(var n=[],t=0,r=0,l=e;l<=a.length;l++){var s=a.slice(l-e,l),h=t,u=Math.min.apply(null,s);(r=.66*((a[l-1]-u)/(Math.max.apply(null,s)-u)-.5)+.67*r)>.99&&(r=.999),r<-.99&&(r=-.999),t=.5*Math.log((1+r)/(1-r))+.5*h,n.push([t,h])}return n.slice(1,n.length)}async function cross(a,e){a.splice(0,a.length-e.length);for(var n=a[0]>e[0],t=[],r=0;r<a.length;r++)a[r]<e[r]&&n&&(t.push({index:r,cross:!1}),n=!1),a[r]>e[r]&&!n&&(t.push({index:r,cross:!0}),n=!0);return t}async function se(a,e){return e=e||a.length,await module.exports.std(a)/e**.5}async function halftrend(a,e,n,t){for(var r=[],l=[0],s=[0],h=[0],u=[0],o=void 0,i=e;i<=a.length;i++){var p=a.slice(i-e,i);maxlow=p[p.length-2][2],minhigh=p[p.length-2][0],atr2=await module.exports.atr(p,e),atr2=atr2[atr2.length-1]/2;var c=t*atr2,g=Math.max.apply(null,p.slice(p.length-1,p.length).map((a=>a[0]))),f=Math.min.apply(null,p.slice(p.length-1,p.length).map((a=>a[2]))),v=await module.exports.sma(p.slice(p.length-n,n).map((a=>a[0])),n),m=await module.exports.sma(p.slice(p.length-n,n).map((a=>a[2])),n);if(1==l[l.length-1]?(maxlow=Math.max(f,maxlow),v[0]<maxlow&&p[p.length-1][1]<p[p.length-2][2]&&(s.push(1),l.push(0),minhigh=p[p.length-2][0])):(minhigh=Math.min(g,minhigh),m[0]>minhigh&&p[p.length-1][1]<p[p.length-2][0]&&(s.push(0),l.push(1),maxlow=f)),0==s[s.length-1]){isNaN(s[s.length-2])||0==s[s.length-2]?h.push(isNaN(h[h.length-2])?maxlow:Math.max(h[h.length-2],maxlow)):h.push(isNaN(u[u.length-2])?u[u.length-1]:u[u.length-2]),o="long";var d=h[h.length-1]+c,x=h[h.length-1]-c}else{isNaN(s[s.length-2])||1==s[s.length-2]?u.push(isNaN(u[u.length-2])?minhigh:Math.min(minhigh,u[u.length-2])):u.push(isNaN(h[h.len-2])?h[h.length-1]:h[h.length-2]),o="short";d=u[u.length-1]+c,x=u[u.length-1]-c}r.push([d,0==s[s.length-1]?h[h.length-1]:u[u.length-1],x,o])}return r}const sum=async a=>a.reduce(((a,e)=>a+e));async function covariance(a,e,n){for(var t=[],r=await module.exports.sma(a,a.length),l=await module.exports.sma(e,e.length),s=n;s<=a.length;s++){for(var h=a.slice(s-n,s),u=e.slice(s-n,s),o=(r=await module.exports.sma(h,n),[]),i=(l=await module.exports.sma(u,n),0);i<n;i++)o.push((h[i]-r[0])*(u[i]-l[0]));o=await module.exports.sum(o),t.push(o/n)}return t}const range=(a,e,n)=>Math.floor(n?n()*(Math.floor(e)-Math.ceil(a))+Math.ceil(a):Math.random()*(Math.floor(e)-Math.ceil(a))+Math.ceil(a)),pick=(a,e)=>a[Math.floor(e?e()*Math.floor(a.length):Math.random()*Math.floor(a.length))],float=(a,e,n)=>n?n()*(e-a)+a:Math.random()*(e-a)+a;function prng(a){for(var e=0,n=1779033703^a.length;e<a.length;e++)n=(n=Math.imul(n^a.charCodeAt(e),3432918353))<<13|n>>>19;return n=Math.imul(n^n>>>16,2246822507),n=Math.imul(n^n>>>13,3266489909),a=(n^=n>>>16)>>>0,function(){var e=a+=1831565813;return e=Math.imul(e^e>>>15,1|e),(((e^=e+Math.imul(e^e>>>7,61|e))^e>>>14)>>>0)/4294967296}}async function ncdf(a,e,n){a=e||n?(a-e)/n:a;var t=1/(1+.2315419*Math.abs(a)),r=.3989423*Math.exp(-a*a/2)*t*(.3193815+t*(t*(1.781478+t*(1.330274*t-1.821256))-.3565638));return a>0?1-r:r}async function zigzag(a,e=.05){var n=[],t=1/0,r=-1/0,l=!1,s=!1,h=[];if(Array.isArray(a[0]))for(var u=0;u<a.length;u++){if(l)n[n.length-1].value>=a[u][1]&&(n[n.length-1].value=a[u][1],n[n.length-1].index=u),t>=a[u][1]&&(t=a[u][1]),(o=(a[u][0]-t)/t)>e&&(n.push({index:u,value:a[u][0]}),s=!0,l=!1,t=1/0);else if(s){n[n.length-1].value<=a[u][0]&&(n[n.length-1].value=a[u][0],n[n.length-1].index=u),r<=a[u][1]&&(r=a[u][1]),(i=(r-a[u][1])/a[u][1])>e&&(n.push({index:u,value:a[u][1]}),l=!0,s=!1,r=-1/0)}else{t>=a[u][1]&&(t=a[u][1]),r<=a[u][0]&&(r=a[u][0]);var o=(a[u][0]-t)/t;(i=(r-a[u][1])/r)>e&&o<e?(l=!0,n.push({index:0,value:a[0][0]}),n.push({index:u,value:a[u][1]})):o>e&&i<e?(s=!0,n.push({index:0,value:a[0][1]}),n.push({index:u,value:a[u][0]})):i>o?(l=!0,n.push({index:0,value:a[0][0]}),n.push({index:u,value:a[u][1]})):(s=!0,n.push({index:0,value:a[0][1]}),n.push({index:u,value:a[u][0]}))}}else for(u=0;u<a.length;u++){if(l)n[n.length-1].value>=a[u]&&(n[n.length-1].value=a[u],n[n.length-1].index=u),t>=a[u]&&(t=a[u]),(o=(a[u]-t)/t)>e&&(n.push({index:u,value:a[u]}),s=!0,l=!1,t=1/0);else if(s){n[n.length-1].value<=a[u]&&(n[n.length-1].value=a[u],n[n.length-1].index=u),r<=a[u]&&(r=a[u]),(i=(r-a[u])/a[u])>e&&(n.push({index:u,value:a[u]}),l=!0,s=!1,r=-1/0)}else{t>=a[u]&&(t=a[u]),r<=a[u]&&(r=a[u]);var i;o=(a[u]-t)/t;(i=(r-a[u])/r)>e&&o<e?(l=!0,n.push({index:0,value:a[0]}),n.push({index:u,value:a[u]})):o>e&&i<e?(s=!0,n.push({index:0,value:a[0]}),n.push({index:u,value:a[u]})):i>o?(l=!0,n.push({index:0,value:a[0]}),n.push({index:u,value:a[u]})):(s=!0,n.push({index:0,value:a[0]}),n.push({index:u,value:a[u]}))}}h=[n[0].value];for(u=1;u<n.length;u++)for(var p=n[u].index-n[u-1].index,c=(n[u].value-n[u-1].value)/p,g=1;g<=p;g++)h.push(g*c+n[u-1].value);return h}async function psar(a,e=.02,n=.2){for(var t=a[0],r=!0,l=e,s=a[0],h=a[0][1],u=a[0][0],o=[h],i=1;i<a.length;i++)h+=l*(u-h),r?(h=Math.min(h,t[1],s[1]),a[i][0]>u&&(u=a[i][0],l=Math.min(l+e,n))):(h=Math.max(h,t[0],s[0]),a[i][1]<u&&(u=a[i][0],l=Math.min(l+e,n))),(r&&a[i][1]<h||!r&&a[i][0]>h)&&(l=e,h=u,u=(r=!r)?a[i][0]:a[i][1]),t=s,s=a[i],o.push(h);return o}async function fibbands(a,e=20,n=3){for(var t=0,r=[],l=[],s=await module.exports.vwma(a,e);t<a.length;t++)if(r.push(a[t][0]),r.length>=e){var h=await module.exports.std(r,e);l.push(h*n),r.splice(0,1)}t=0;for(var u=[];t<s.length;t++){var o=s[t]+.236*l[t],i=s[t]+.382*l[t],p=s[t]+.5*l[t],c=s[t]+.618*l[t],g=s[t]+.764*l[t],f=s[t]+l[t],v=s[t]-.236*l[t],m=s[t]-.382*l[t],d=s[t]-.5*l[t],x=s[t]-.618*l[t],w=s[t]-.764*l[t],y=s[t]-l[t];u.push([f,g,c,p,i,o,s[t],v,m,d,x,w,y])}return u}async function supertrend(a,e=20,n=3){for(var t=e-1,r=await module.exports.atr(a,e),l=[];t<a.length;t++)l.push([(a[t][0]+a[t][2])/2+n*r[t],(a[t][0]+a[t][2])/2-n*r[t]]);return l}async function cwma(a,e){for(var n=e.length,t=[];n<=a.length;n++){for(var r=a.slice(n-e.length,n),l=0,s=0,h=0;h<e.length;h++)l+=r[h]*e[h],s+=e[h];t.push(l/s)}return t}const fibnumbers=[0,1,1,2,3,5,8,13,21,34,55,89,144,233,377,610,987,1597,2584,4181],permutations=async a=>a.reduce(((a,e)=>a*e));async function mse(a,e){for(var n=0,t=0;n<a.length;n++)t+=Math.pow(e[n]-a[n],2);return t/a.length}async function cum(a,e){for(var n=e,t=[];n<=a.length;n++)t.push(await module.exports.sum(a.slice(n-e,n)));return t}async function vwwma(a,e=20){a=a.map((a=>[a[0]*a[1],a[1]]));for(var n=1,t=0;n<=e;n++)t+=n;n=e;for(var r=[];n<=a.length;n++){var l=a.slice(n-e,n),s=0,h=0;for(var u in l)s+=l[u][1]*(Number(u)+1)/t,h+=l[u][0]*(Number(u)+1)/t;r.push(h/s)}return r}async function elderray(a,e=13){for(var n=e,t=[];n<=a.length;n++){var r=a.slice(n-e,n),l=Math.min.apply(void 0,r),s=Math.max.apply(void 0,r),h=await module.exports.ema(r,r.length);t.push([s-h[0],l-h[0]])}return t}async function hv(a,e=10){for(var n=e,t=[];n<=a.length;n++){var r=await ssd(a.slice(n-e,n))/e;t.push(Math.sqrt(r))}return t}const t_table=[{value:.5,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0,25:0},{value:.25,1:1,2:.816,3:.765,4:.741,5:.727,6:.718,7:.711,8:.706,9:.703,10:.7,11:.697,12:.695,13:.694,14:.692,15:.691,16:.69,17:.689,18:.688,19:.688,20:.687,21:.686,22:.686,23:.685,24:.685,25:.684},{value:.2,1:1.376,2:1.061,3:.978,4:.941,5:.92,6:.906,7:.896,8:.889,9:.883,10:.879,11:.876,12:.873,13:.87,14:.868,15:.866,16:.865,17:.863,18:.862,19:.861,20:.86,21:.859,22:.858,23:.858,24:.857,25:.856},{value:.15,1:1.963,2:1.386,3:1.25,4:1.19,5:1.156,6:1.134,7:1.119,8:1.108,9:1.1,10:1.093,11:1.088,12:1.088,13:1.079,14:1.076,15:1.074,16:1.071,17:1.069,18:1.067,19:1.066,20:1.064,21:1.063,22:1.061,23:1.06,24:1.059,25:1.058},{value:.1,1:3.078,2:1.886,3:1.638,4:1.533,5:1.476,6:1.44,7:1.415,8:1.397,9:1.383,10:1.372,11:1.363,12:1.356,13:1.35,14:1.345,15:1.341,16:1.337,17:1.333,18:1.33,19:1.328,20:1.325,21:1.323,22:1.321,23:1.319,24:1.318,25:1.316},{value:.05,1:6.314,2:2.92,3:2.353,4:2.132,5:2.015,6:1.943,7:1.895,8:1.86,9:1.833,10:1.812,11:1.796,12:1.782,13:1.771,14:1.761,15:1.753,16:1.746,17:1.74,18:1.734,19:1.729,20:1.725,21:1.721,22:1.717,23:1.714,24:1.711,25:1.708},{value:.025,1:12.71,2:4.303,3:3.182,4:2.776,5:2.571,6:2.447,7:2.365,8:2.306,9:2.262,10:2.228,11:2.201,12:2.179,13:2.16,14:2.145,15:2.131,16:2.12,17:2.11,18:2.101,19:2.093,20:2.086,21:2.08,22:2.074,23:2.069,24:2.064,25:2.06},{value:.01,1:31.82,2:6.965,3:4.541,4:3.747,5:3.365,6:3.143,7:2.998,8:2.896,9:2.821,10:2.764,11:2.718,12:2.681,13:2.65,14:2.624,15:2.602,16:2.583,17:2.567,18:2.552,19:2.539,20:2.528,21:2.518,22:2.508,23:2.5,24:2.492,25:2.485},{value:.005,1:63.66,2:9.925,3:5.841,4:4.604,5:4.032,6:3.707,7:3.499,8:3.355,9:3.25,10:3.169,11:3.106,12:3.055,13:3.012,14:2.977,15:2.947,16:2.921,17:2.898,18:2.878,19:2.861,20:2.845,21:2.831,22:2.819,23:2.807,24:2.797,25:2.787},{value:.001,1:318.13,2:22.327,3:10.215,4:7.173,5:5.893,6:5.208,7:4.785,8:4.501,9:4.297,10:4.144,11:4.025,12:3.93,13:3.852,14:3.787,15:3.733,16:3.686,17:3.646,18:3.61,19:3.579,20:3.552,21:3.527,22:3.505,23:3.485,24:3.467,25:3.45},{value:5e-4,1:636.62,2:31.599,3:12.924,4:8.61,5:6.869,6:5.959,7:5.408,8:5.041,9:4.781,10:4.587,11:4.437,12:4.318,13:4.221,14:4.14,15:4.073,16:4.015,17:3.965,18:3.922,19:3.883,20:3.85,21:3.819,22:3.792,23:3.768,24:3.745,25:3.725}];async function pvalue(a,e){if(e>25)throw new Error("ta.js | pvalue | df too high!");if(e<1)throw new Error("ta.js | pvalue | df too low!");for(var n=0;n<t_table.length-1;n++)if(a>=t_table[n][Number(e).toString()]&&a<=t_table[Number(n)+1][Number(e).toString()])return t_table[n+1].value+(t_table[Number(n)+1].value-t_table[n].value)*(t_table[n+1][Number(e).toString()]-a)/(t_table[n][Number(e).toString()]-t_table[n+1][Number(e).toString()]);return 1e-4}async function rvi(a,e=20){for(var n=3,t=[],r=[],l=[];n<a.length;n++)if(t.push((a[n][3]-a[n][0]+2*(a[n][3]-a[n-1][0])+2*(a[n][3]-a[n-2][0])+(a[n][3]-a[n-3][0]))/6),r.push((a[n][1]-a[n][2]+2*(a[n][1]-a[n-1][2])+2*(a[n][1]-a[n-2][2])+(a[n][1]-a[n-3][2]))/6),t.length>=e){var s=await module.exports.sma(t,e),h=await module.exports.sma(r,e);l.push(s[0]/h[0]),t.splice(0,1),r.splice(0,1)}return l}async function rvi_signal(a){for(var e=3,n=[];e<a.length;e++)n.push((a[e]+2*a[e-1]+2*a[e-2]+a[e-3])/6);return n}const random={range,pick,float,prng};const aroon={up:aroon_up,down:aroon_down,osc:aroon_osc};
