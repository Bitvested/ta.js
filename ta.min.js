/* ta.js (c) Nino Kroesen. MIT License. */ async function median(b,d=b.length){for(var a=d,e=[];a<=b.length;a++){var c=b.slice(a-d,a);c.sort((a,b)=>a-b),e.push(c[Math.round(c.length/2)-1])}return e}async function kmeans(f,d){for(var h,e=[],g=[],k=[],l=!1,n=Math.round(f.length/(d+1)),c=0;c<d;c++)g[c]=f[n*(c+1)];do{for(var c=0;c<d;c++)e[c]=[];for(var a=0;a<f.length;a++){for(var i=-1,b=0;b<d;b++){var j=Math.abs(g[b]-f[a]);-1===i?(i=j,h=b):j<=i&&(i=j,h=b)}e[h].push(f[a])}k=g;for(var a=0;a<d;a++){var m=0;for(b=0;b<e[a].length;b++)m+=e[a][b];var o=m/e[h].length;g[a]=o}for(var a=0;a<d;a++)g[a]!==k[a]&&(l=!0)}while(l)return e}async function normalize(a,c=0){for(var b=0,d=await Math.max.apply(null,a.slice())*(1+c),f=await Math.min.apply(null,a.slice())*(1-c),e=[];b<a.length;b++)e.push(1-(d-a[b])/(d-f));return e}async function denormalize(b,c,d=0){for(var a=0,g=await Math.max.apply(null,b.slice())*(1+d),e=await Math.min.apply(null,b.slice())*(1-d),f=[];a<c.length;a++)f.push(e+c[a]*(g-e));return f}async function normalize_pair(c,d){for(var a=1,e=(c[0]+d[0])/2,b=[[e,e]];a<c.length;a++)b.push([b[b.length-1][0]*((c[a]-c[a-1])/c[a-1]+1),b[b.length-1][1]*((d[a]-d[a-1])/d[a-1]+1)]);return b}async function normalize_from(b,d){for(var a=1,c=[d];a<b.length;a++)c.push(c[c.length-1]*((b[a]-b[a-1])/b[a-1]+1));return c}async function standardize(a){for(var d=await module.exports.sma(a,a.length),e=await module.exports.std(a),c=[],b=0;b<a.length;b++)c.push((a[b]-d[0])/e);return c}async function mad(c,d=c.length){for(var a=d,e=[];a<=c.length;a++){var f=c.slice(a-d,a),g=await module.exports.median(f),b=f.map(a=>Math.abs(a-g[g.length-1]));b=await module.exports.median(b),e.push(b[b.length-1])}return e}async function aad(c,a=c.length){for(var b=a,e=[];b<=c.length;b++){var d=c.slice(b-a,b),f=0,g=await module.exports.sma(d,a);for(q in d)f+=Math.abs(d[q]-g[g.length-1]);e.push(f/a)}return e}async function ssd(b,c=b.length){for(var a=c,e=[];a<=b.length;a++){var d=b.slice(a-c,a),f=await module.exports.sma(d,c),g=0;for(let h in d)g+=(d[h]-f[f.length-1])**2;e.push(Math.sqrt(g))}return e}async function er(a){var b=[],c=[],e=1,f=1;for(let d in a)a[d]>=0?b.push(1+a[d]):c.push(1+a[d]);var g=b.length/a.length,h=c.length/a.length;for(let i in c)f*=c[i];for(let j in b)e*=b[j];return((e**(1/b.length)-1)*100*g+(f**(1/c.length)-1)*100*h)/100}async function ar(b,c=b.length){for(var a=c,d=[];a<b.length;a++){var e=await module.exports.er(b.slice(a-c,a));d.push(b[a]-e)}return d}async function kelly(b){var a=await module.exports.er(b)+1,c=await module.exports.winratio(b);return isNaN(a)&&(a=1),c-(1-c)/a}async function martingale(b,c,f,d=2){var a=c;for(let e in b)b[e]<0?a*=d:a=c;return a}async function antimartingale(b,c,f,d=2){var a=c;for(let e in b)b[e]>0?a*=d:a=c;return a}async function winratio(b){var a=0,c=0;for(let d in b)b[d]>=0?a++:c++;return a/(c+a)}async function avgwin(b){for(var a=0,c=[];a<b.length;a++)b[a]>=0&&c.push(b[a]);return(await module.exports.sma(c,c.length))[0]}async function avgloss(b){for(var c=[],a=0;a<b.length;a++)b[a]<0&&c.push(b[a]);return(await module.exports.sma(c,c.length))[0]}async function zscore(a,b=a.length){for(var c=b-1,e=[],d=a.slice(0,b-1);c<a.length;c++){d.push(a[c]);var f=await module.exports.sma(d,b),g=await module.exports.std(d,b);e.push((a[c]-f[0])/g),d.splice(0,1)}return e}async function rsi(d,c=14){for(var e=c-1,f=0,g=0,h=[],a=d.slice(0,c-1);e<d.length;e++,f=0,g=0){a.push(d[e]);for(var b=1;b<a.length;b++)a[b]-a[b-1]<0?g+=Math.abs(a[b]-a[b-1]):f+=a[b]-a[b-1];var i=100-100/(1+f/c/(g/c));h.push(i),a.splice(0,1)}return h}async function wrsi(b,e=14){for(var a=1,f=[],d=[],c=[];a<b.length;a++)b[a]-b[a-1]<0?(c.push(Math.abs(b[a]-b[a-1])),d.push(0)):(c.push(0),d.push(b[a]-b[a-1]));for(let g in c=await module.exports.wsma(c,e),d=await module.exports.wsma(d,e),c)f.push(100-100/(1+d[g]/c[g]));return f}async function tsi(b,e=25,f=13,k=13){for(var a=1,g=[],h=[],c=[],i=[];a<b.length;a++)g.push(b[a]-b[a-1]),h.push(Math.abs(b[a]-b[a-1]));for(var l=await module.exports.ema(g,e),m=await module.exports.ema(h,e),j=await module.exports.ema(l,f),n=await module.exports.ema(m,f),a=0;a<j.length;a++)c.push(j[a]/n[a]);var d=await module.exports.ema(c,k);c.splice(0,c.length-d.length);for(var a=0;a<d.length;a++)i.push([d[a],c[a]]);return i}async function bop(b,c=14){var a=b.map(a=>(a[3]-a[0])/(a[1]-a[2])),a=await module.exports.sma(a,c);return a}async function fi(b,d=13){for(var a=1,c=[],e=[];a<b.length;a++)if(c.push((b[a][0]-b[a-1][0])*b[a][1]),c.length>=d){var f=await module.exports.ema(c,d);e.push(f[f.length-1]),c.splice(0,1)}return e}async function asi(c){for(var b=1,i=[];b<c.length;b++){var g,f=c[b][1],a=c[b-1][1],d=c[b][0],j=c[b-1][0],e=c[b][2],k=c[b-1][2],l=j-f>k-f?j-f:k-f,m=c[b][0],h=c[b-1][0],n=Math.max(c[b][0],c[b-1][0])-Math.min(c[b][2],c[b-1][2]);d-a>e-a&&d-a>d-e&&(g=d-a-(e-a)/2+(a-h)/4),e-a>d-a&&e-a>d-e&&(g=e-a-(d-a)/2+(a-h)/4),d-e>d-a&&d-e>e-a&&(g=d-e+(a-h)/4),i.push(50*((a-f+(a-h)/2+(f-m)/2)/g)*l/n)}return i}async function ao(a,h=5,c=35){a=a.map(a=>(a[0]+a[1])/2);for(var b=c,d=[];b<=a.length;b++){var e=a.slice(b-c,b),f=await module.exports.sma(e,h),g=await module.exports.sma(e,c);d.push(f[f.length-1]-g[g.length-1])}return d}async function ac(f,c=5,g=35){var a=await ao(f,c,g),b=await sma(a,c),d=[];for(let e in a.length>b.length?a.splice(0,a.length-b.length):b.splice(0,b.length-a.length),a)d.push(a[e]-b[e]);return d}const fib=async(a,b)=>[a,(b-a)*.236+a,(b-a)*.382+a,(b-a)*.5+a,(b-a)*.618+a,(b-a)*.786+a,b,(b-a)*1.618+a,(b-a)*2.618+a,(b-a)*3.618+a,(b-a)*4.236+a];async function pr(b,c=14){for(var a=c,d=[];a<=b.length;a++){var e=b.slice(a-c,a),f=await Math.max.apply(null,e),g=await Math.min.apply(null,e);d.push(-((f-b[a-1])/(f-g)*100))}return d}async function lsma(h,b=25){for(var d=b,i=[];d<=h.length;d++){for(var f,j,e=h.slice(d-b,d),c=0,g=0,k=0,l=0,a=1;a<=b;a++)c+=a,g+=e[a-1],k+=e[a-1]*a,l+=a*a,e[a-1],e[a-1];f=(k-c*g/b)/(l-c*c/b),j=g/b-f*c/b,i.push(f*b+j)}return i}async function don(c,d=20){for(var a=d,e=[];a<=c.length;a++){var b=c.slice(a-d,a),f=[],g=[];for(let h in b)f.push(b[h][0]),g.push(b[h][1]);var i=Math.max.apply(null,f.slice()),j=Math.min.apply(null,g.slice());e.push([i,(i+j)/2,j])}return e}async function ichimoku(g,i=9,h=26,j=52,f=26){for(var a=0,e=[],k=[],d=[];a<g.length;a++)if(e.push(g[a]),e.length>=j){var b=[],c=[];for(let l in e)b.push(e[l][0]),c.push(e[l][2]);var n=(Math.max.apply(null,b.slice(b.length-i,b.length))+Math.min.apply(null,c.slice(c.length-i,c.length)))/2,m=(Math.max.apply(null,b.slice(b.length-h,b.length))+Math.min.apply(null,c.slice(c.length-h,c.length)))/2,o=g[a][1]+m,p=(Math.max.apply(null,b.slice(b.length-j,b.length))+Math.min.apply(null,c.slice(c.length-h,c.length)))/2;chik=g[a][1],d.push([n,m,o,p,chik]),e.splice(0,1)}for(var a=f;a<d.length-f;a++)k.push([d[a][0],d[a][1],d[a+f][2],d[a+f][3],d[a-f][4]]);return k}async function stoch(e,f=14,a=3,b=3){f<a&&([f,a]=[a,f]),b>a&&([b,a]=[a,b]);for(var d=0,i=[],g=[],h=[],c=[];d<e.length;d++){if(g.push(e[d][0]),h.push(e[d][2]),g.length>=f){var n=await Math.max.apply(null,g),j=await Math.min.apply(null,h),k=100*(e[d][1]-j)/(n-j);c.push(k)}if(b>0&&c.length>b){var l=await module.exports.sma(c,b);c.push(l[l.length-1])}if(c.length-b>=a){var m=await module.exports.sma(c,a);i.push([k,m[m.length-1]]),g.splice(0,1),h.splice(0,1),c.splice(0,1)}}return i}async function atr(a,d=14){for(var b=1,c=[a[0][0]-a[0][2]];b<a.length;b++){var e=await Math.max(a[b][0]-a[b-1][1],a[b][2]-a[b-1][1],a[b][0]-a[b][2]);c.push((c[c.length-1]*(d-1)+e)/d)}return c}async function sma(c,b=14){for(var a=b,d=[];a<=c.length;a++){let e=await module.exports.sum(c.slice(a-b,a));d.push(e/b)}return d}async function smma(e,b=14){for(var c=b,a=[];c<=e.length;c++){var f=e.slice(c-b,c),d=0;for(q in f)d+=f[q];a.length<=0?a.push(d/b):a.push((d-a[a.length-1])/b)}return a.splice(0,1),a}async function wma(c,b=14){for(var a=1,d=0,e=[];a<=b;a++)d+=a;for(var a=b;a<=c.length;a++){var f=c.slice(a-b,a),g=0;for(q in f)g+=f[q]*(Number(q)+1)/d;e.push(g)}return e}async function wsma(d,c=14){for(var b=c,a=[],g=1/c;b<=d.length;b++){if(a.length>0){a.push((d[b-1]-a[a.length-1])*g+a[a.length-1]);continue}var e=d.slice(b-c,b),f=0;for(q in e)f+=e[q];a.push(f/c)}return a}async function pwma(g,b=14){for(var a=b/2,c=b,e=0,h=[],f=[];a>=1;a--,c--)a%1!=0?e+=(a=Math.round(a))*c:(f.push(a*c),e+=a*c*2),f.unshift(a*c);for(var a=b;a<=g.length;a++){for(var i=0,j=g.slice(a-b,a),d=b-1;d>=0;d--)i+=j[d]*f[d]/e;h.push(i)}return h}async function hwma(g,b=14){for(var a=1,c=b,e=0,h=[],f=[];a<=b/2;a++,c--)a%1!=0?e+=(a=Math.round(a))*c:(f.push(a*c),e+=a*c*2),f.unshift(a*c);for(var a=b;a<=g.length;a++){for(var i=0,j=g.slice(a-b,a),d=b-1;d>=0;d--)i+=j[d]*f[d]/e;h.push(i)}return h}async function vwma(a,e=20){a=a.map(a=>[a[0]*a[1],a[1]]);for(var b=e,f=[];b<=a.length;b++){for(var d=a.slice(b-e,b),g=0,h=0,c=0;c<d.length;c++)g+=d[c][1],h+=d[c][0];f.push(h/g)}return f}async function ema(d,c=12){for(var b=c,a=[],g=2/(c+1);b<=d.length;b++){if(a.length>0){a.push((d[b-1]-a[a.length-1])*g+a[a.length-1]);continue}var e=d.slice(b-c,b),f=0;for(q in e)f+=e[q];a.push(f/c)}return a}async function hull(e,b=14){var a=[],f=[],c=await module.exports.wma(e,b),g=Math.round(Math.sqrt(b)),d=await wma(e,Math.round(b/2));for(let h in d.splice(0,d.length-c.length),c)if(a.push(2*d[h]-c[h]),a.length>=g){var i=await wma(a,g);f.push(i[0]),a.splice(0,1)}return f}async function kama(b,d=10,h=2,f=30){for(var c=d+1,a=await module.exports.sma(b,d),a=[a[a.length-1]];c<b.length;c++){for(var g=0,i=Math.abs(b[c]-b[c-d]),e=1;e<d;e++)g+=Math.abs(b[c-e]-b[c-e-1]);var j=(i/g*(2/(h+1)-2/(f+1)+2/(f+1)))**2;a.push(a[a.length-1]+j*(b[c]-a[a.length-1]))}return a}async function macd(d,a=12,b=26){a>b&&([a,b]=[b,a]);var e=await module.exports.ema(d,a),f=await module.exports.ema(d,b),g=[];e.splice(0,b-a);for(var c=0;c<f.length;c++)g.push(e[c]-f[c]);return g}async function macd_signal(a,b=12,c=26,d=9){let e=await module.exports.macd(a,b,c),f=await module.exports.ema(e,d);return f}async function macd_bars(e,f=12,g=26,h=9){var a=await module.exports.macd(e,f,g),b=await module.exports.ema(a,h),c=[];for(let d in a.splice(0,a.length-b.length),a)c.push(a[d]-b[d]);return c}async function bands(d,e=14,g=1){for(var a=0,b=[],f=[],h=[],c=await module.exports.sma(d,e);a<d.length;a++)if(b.push(d[a]),b.length>=e){var i=await module.exports.std(b,e);f.push(i),b.splice(0,1)}for(var a=0;a<c.length;a++)h.push([c[a]+f[a]*g,c[a],c[a]-f[a]*g]);return h}async function bandwidth(d,e=14,f=1){for(var a=0,c=[],b=await module.exports.bands(d,e,f);a<b.length;a++)c.push((b[a][0]-b[a][2])/b[a][1]);return c}async function keltner(b,d=14,g=1){var c,h=[],e=await module.exports.atr(b,d),i=[];for(let f in b)h.push((b[f][0]+b[f][1]+b[f][2])/3);c=await module.exports.sma(h,d),e.splice(0,d-1);for(var a=0;a<c.length;a++)i.push([c[a]+e[a]*g,c[a],c[a]-e[a]*g]);return i}async function variance(c,a=c.length){for(var b=a,e=[];b<=c.length;b++){var d=c.slice(b-a,b),f=await module.exports.sma(d,a),g=0;for(x in d)g+=(d[x]-f[f.length-1])**2;e.push(g/a)}return e}async function std(a,b=a.length){var c=a.reduce((a,b)=>a+b)/b;return Math.sqrt(a.reduce((a,b)=>a+Math.pow(b-c,2),0)/b)}async function normsinv(c){if(c<0||c>1)return 0;if(c<.02425){var a=Math.sqrt(-2*Math.log(c));return(((((-0.00778489400243029*a+ -0.322396458041136)*a+ -2.40075827716184)*a+ -2.54973253934373)*a+4.37466414146497)*a+2.93816398269878)/((((.00778469570904146*a+.32246712907004)*a+2.445134137143)*a+3.75440866190742)*a+1)}if(c<=.97575){var a=c-.5,b=a*a;return(((((-39.6968302866538*b+220.946098424521)*b+ -275.928510446969)*b+138.357751867269)*b+ -30.6647980661472)*b+2.50662827745924)*a/(((((-54.4760987982241*b+161.585836858041)*b+ -155.698979859887)*b+66.8013118877197)*b+ -13.2806815528857)*b+1)}var a=Math.sqrt(-2*Math.log(1-c));return-(((((-0.00778489400243029*a+ -0.322396458041136)*a+ -2.40075827716184)*a+ -2.54973253934373)*a+4.37466414146497)*a+2.93816398269878)/((((.00778469570904146*a+.32246712907004)*a+2.445134137143)*a+3.75440866190742)*a+1)}async function sim(i,j=50,k=1e3,f){for(var g=0,d=[];g<k;g++){for(var a=i.slice(),h=0;h<j;h++){for(var b=[],c=1;c<a.length;c++){var l=await module.exports.dif(a[c],a[c-1]);b.push(l)}var m=await module.exports.sma(b,b.length),e=await module.exports.std(b),n=await module.exports.normsinv(Math.random());a.push(a[a.length-1]*Math.exp(m[0]-e*e/2+e*n))}d.push(a)}return f?await module.exports.percentile(d,f):d}async function percentile(a,d){for(var b=0,c=[];b<a[0].length;b++)a.sort((a,c)=>a[b]-c[b]),c.push(a[Math.round((a.length-1)*d)][b]);return c}async function cor(a,e){for(var j=await module.exports.sma(a,a.length),k=await module.exports.sma(e,e.length),g=0,b=0,c=0,d=0;d<a.length;d++){var h=a[d]-j,i=e[d]-k;g+=h*i,b+=Math.pow(h,2),c+=Math.pow(i,2)}var f=a.length-1;return b/=f,c/=f,b=Math.sqrt(b),g/(f*b*(c=Math.sqrt(c)))}const dif=async(b,a)=>(b-a)/a,log=async a=>a.map(a=>Math.log(a)),exp=async a=>a.map(a=>Math.exp(a));async function drawdown(a){for(var b=1,f=a[0],c=a[0],d=0;b<a.length;b++){if(a[b]>f){if(0!=c){var e=await module.exports.dif(c,f);e<d&&(d=e),c=a[b]}f=a[b]}a[b]<c&&(c=a[b])}var e=await module.exports.dif(c,f);return e<d&&(d=e),d}async function aroon_up(c,a=10){for(var b=a,d=[];b<=c.length;b++){var e=c.slice(b-a,b),f=e.slice();f.sort((a,b)=>a-b),d.push(100*(a-1-e.reverse().findIndex(b=>b===f[a-1]))/(a-1))}return d}async function aroon_down(c,a=10){for(var b=a,d=[];b<=c.length;b++){var e=c.slice(b-a,b),f=e.slice();f.sort((a,b)=>a-b),d.push(100*(a-1-e.reverse().findIndex(a=>a===f[0]))/(a-1))}return d}async function aroon_osc(b,c=25){for(var a=0,d=[],e=await module.exports.aroon.up(b,c),f=await module.exports.aroon.down(b,c);a<e.length;a++)d.push(e[a]-f[a]);return d}async function mfi(b,e=14){for(var a=e,f=[],g=b.map(a=>a[1]),h=b.map(a=>a[0]),c=0,d=0;a<=b.length;a++,c=0,d=0){for(q=a-e;q<a;q++)c+=h[q],d+=g[q];f.push(100-100/(1+c/d))}return f}async function roc(b,c=14){for(var a=c,d=[];a<=b.length;a++)d.push((b[a-1]-b[a-c])/b[a-c]);return d}async function cop(g,h=11,i=14,f=10){for(var j=Math.max(h,i),k=[],d=j+f;d<g.length;d++){var a=g.slice(d-(j+f),d),b=a.slice(),c=[];a=await module.exports.roc(a,h),b=await module.exports.roc(b,i),a.splice(0,a.length-b.length),b.splice(0,b.length-a.length);for(var e=0;e<a.length;e++)c.push(a[e]+b[e]);c=await module.exports.wma(c,f),k.push(c[c.length-1])}return k}async function kst(i,j=10,k=15,l=20,m=30,n=10,o=10,p=10,q=15,t=9){for(var b=[],r=[],s=Math.max(j,k,l,m)+Math.max(n,o,p,q),a=s;a<=i.length;a++){var c=i.slice(a-s,a),d=await module.exports.roc(c,j),e=await module.exports.roc(c,k),f=await module.exports.roc(c,l),g=await module.exports.roc(c,m);d=await module.exports.sma(d,n),e=await module.exports.sma(e,o),f=await module.exports.sma(f,p),g=await module.exports.sma(g,q),b.push(d[d.length-1]+e[e.length-1]+f[f.length-1]+g[g.length-1])}var h=await module.exports.sma(b,t);for(var a in b.splice(0,b.length-h.length),h)r.push([b[a],h[a]]);return r}async function obv(c){for(var a=1,b=[0];a<c.length;a++)c[a][1]>c[a-1][1]&&b.push(b[b.length-1]+c[a][0]),c[a][1]<c[a-1][1]&&b.push(b[b.length-1]-c[a][0]),c[a][1]===c[a-1][1]&&b.push(b[b.length-1]);return b}async function vwap(a,e=a.length){a=a.map(a=>[a[0]*a[1],a[1]]);for(var b=e,f=[];b<=a.length;b++){for(var d=a.slice(b-e,b),g=0,h=0,c=0;c<d.length;c++)g+=d[c][1],h+=d[c][0];f.push(h/g)}return f}async function mom(b,c=10,e){for(var a=c-1,d=[];a<b.length;a++)e?d.push(b[a]/b[a-(c-1)]*100):d.push(b[a]-b[a-(c-1)]);return d}async function mom_osc(d,a=10){a++;for(var b=a,g=[],e=0,f=0;b<=d.length;b++,e=0,f=0){for(var c=1;c<a;c++)d[b-a+(c-1)]<d[b-a+c]?e+=d[b-a+c]:f+=d[b-a+c];g.push((e-f)/(e+f)*100)}return g}async function ha(a){for(var b=[[(a[0][0]+a[0][3])/2,a[0][1],a[0][2],(a[0][0]+a[0][1]+a[0][2]+a[0][3])/4]],c=1;c<a.length;c++)b.push([(b[b.length-1][0]+b[b.length-1][3])/2,Math.max(b[b.length-1][0],b[b.length-1][3],a[c][1]),Math.min(b[b.length-1][0],b[b.length-1][3],a[c][2]),(a[c][0]+a[c][1]+a[c][2]+a[c][3])/4]);return b}async function ren(d,a=1){for(var f=[],g=Math.floor(a)===a?0:a.toString().split(".")[1].length||0,b=Math.ceil(d[0][0]/a*10**g)/10**g*a,c=b-a,e=1;e<d.length;e++){if(d[e][0]>b+a)do f.push([b,b+a,b,b+a]),b+=a,c+=a;while(d[e][0]>b+a)if(d[e][1]<c-a)do f.push([c,c,c-a,c-a]),b-=a,c-=a;while(d[e][1]<c-a)}return f}async function envelope(d,b=10,e=.005){for(var a=b,f=[];a<d.length;a++){var c=await module.exports.sma(d.slice(a-b,a),b);f.push([c[0]*(1+e),c[0],c[0]*(1-e)])}return f}async function chaikin_osc(b,h=3,i=10){for(var a=0,f=[],e=[];a<b.length;a++){var g=(b[a][1]-b[a][2]-(b[a][0]-b[a][1]))/(b[a][0]-b[a][2]);isNaN(g)?e.push(0):e.push(g*b[a][3])}var c=await module.exports.ema(e,h),d=await module.exports.ema(e,i);c.length>d.length?c.splice(0,c.length-d.length):d.splice(0,d.length-c.length);for(var a=0;a<c.length;a++)f.push(c[a]-d[a]);return f}async function fractals(b){for(var c=[[!1,!1],[!1,!1]],a=2;a<b.length-2;a++){var d=b[a-2][0]<b[a][0]&&b[a-1][0]<b[a][0]&&b[a][0]>b[a+1][0]&&b[a][0]>b[a+2][0],e=b[a-2][1]>b[a][1]&&b[a-1][1]>b[a][1]&&b[a][1]<b[a+1][1]&&b[a][1]<b[a+2][1];c.push([d,e])}return c.push([!1,!1],[!1,!1]),c}async function alligator(c,g=13,h=8,i=5,j=8,k=5,l=3){var f=[],b=await module.exports.smma(c,g),d=await module.exports.smma(c,h),e=await module.exports.smma(c,i);d.splice(0,d.length-b.length),e.splice(0,e.length-b.length);for(var a=b.length-1;a>=7;a--)f.push([b[a-(j-1)],d[a-(k-1)],e[a-(l-1)]]);return f}async function gator(d,i=13,j=8,k=5,f=8,g=5,l=3){var h=[],b=await module.exports.smma(d,i),c=await module.exports.smma(d,j),e=await module.exports.smma(d,k);c.splice(0,c.length-b.length),e.splice(0,e.length-b.length);for(var a=b.length-1;a>=f-1;a--)h.push([b[a-(f-1)]-c[a-(g-1)],-Math.abs(c[a-(g-1)]-e[a-(l-1)])]);return h}async function recent_high(a,e=25){for(var b=a.length-2,c=e,f=0,d=a[a.length-1];b>=0&&(a[b]>=d&&c>0?(d=a[b],f=b,c=e):c--,!(c<=0));b--);return{index:f,value:d}}async function recent_low(a,e=25){for(var b=a.length-2,c=e,f=0,d=a[a.length-1];b>=0&&(a[b]<=d&&c>0?(d=a[b],f=b,c=e):c--,!(c<=0));b--);return{index:f,value:d}}async function support(b,a=recent_low(b)){var c,e,f=(a=await a).value;do{for(var d=a.index;d<b.length;d++){var g=(a.value-b[d])/(a.index-d);g<f&&(f=g,c=d)}a.index+1==c&&c!=b.length-1?(a.index=c,f=Math.min.apply(null,b.slice()),a.value=b[a.index],e=!1):e=!0,a.index==b.length-1&&(e=!0)}while(!e)return c==b.length-1||a.index==b.length-1?{calculate:async b=>a.value,slope:0,lowest:a.value,index:a.index}:{calculate:async b=>b*f+a.value,slope:f,lowest:a.value,index:a.index}}async function resistance(b,a){var c,e,f=(a=a||await recent_high(b)).value;do{for(var d=a.index;d<b.length;d++){var g=(b[d]-a.value)/(a.index-d);g<f&&(f=g,c=d)}a.index+1==c&&c!=b.length-1?(a.index=c,f=Math.max.apply(null,b.slice()),a.value=b[a.index],e=!1):e=!0,a.index==b.length-1&&(e=!0)}while(!e)return c==b.length-1||a.index==b.length-1?{calculate:async b=>a.value,slope:0,highest:a.value,index:a.index}:{calculate:async b=>-(b*f)+a.value,slope:f,highest:a.value,index:a.index}}async function fisher(c,f){var d=[],e=0,a=0;for(let b=f;b<=c.length;b++){var g=c.slice(b-f,b),h=e,i=Math.min.apply(null,g),a=.66*((c[b-1]-i)/(Math.max.apply(null,g)-i)-.5)+.67*a;a>.99&&(a=.999),a< -0.99&&(a=-0.999),e=.5*Math.log((1+a)/(1-a))+.5*h,d.push([e,h])}return d.slice(1,d.length)}async function cross(b,c){b.splice(0,b.length-c.length);for(var d=b[0]>c[0],e=[],a=0;a<b.length;a++)b[a]<c[a]&&d&&(e.push({index:a,cross:!1}),d=!1),b[a]>c[a]&&!d&&(e.push({index:a,cross:!0}),d=!0);return e}async function se(b,a){a=a||b.length;var c=await module.exports.std(b);return c/a**.5}async function halftrend(k,i,e,p){let l=[],f=[0],d=[0],b=[0],c=[0],j;for(let g=i;g<=k.length;g++){let a=k.slice(g-i,g);maxlow=a[a.length-2][2],minhigh=a[a.length-2][0],atr2=(atr2=await module.exports.atr(a,i))[atr2.length-1]/2;let h=p*atr2,q=Math.max.apply(null,a.slice(a.length-1,a.length).map(a=>a[0])),m=Math.min.apply(null,a.slice(a.length-1,a.length).map(a=>a[2])),r=await module.exports.sma(a.slice(a.length-e,e).map(a=>a[0]),e),s=await module.exports.sma(a.slice(a.length-e,e).map(a=>a[2]),e);if(1==f[f.length-1]?(maxlow=Math.max(m,maxlow),r[0]<maxlow&&a[a.length-1][1]<a[a.length-2][2]&&(d.push(1),f.push(0),minhigh=a[a.length-2][0])):(minhigh=Math.min(q,minhigh),s[0]>minhigh&&a[a.length-1][1]<a[a.length-2][0]&&(d.push(0),f.push(1),maxlow=m)),0==d[d.length-1]){isNaN(d[d.length-2])||0==d[d.length-2]?b.push(isNaN(b[b.length-2])?maxlow:Math.max(b[b.length-2],maxlow)):b.push(isNaN(c[c.length-2])?c[c.length-1]:c[c.length-2]),j="long";var n=b[b.length-1]+h,o=b[b.length-1]-h}else{isNaN(d[d.length-2])||1==d[d.length-2]?c.push(isNaN(c[c.length-2])?minhigh:Math.min(minhigh,c[c.length-2])):c.push(isNaN(b[b.len-2])?b[b.length-1]:b[b.length-2]),j="short";var n=c[c.length-1]+h,o=c[c.length-1]-h}l.push([n,0==d[d.length-1]?b[b.length-1]:c[c.length-1],o,j])}return l}const sum=async a=>a.reduce((a,b)=>a+b);async function covariance(c,f,a){let g=[];await module.exports.sma(c,c.length),await module.exports.sma(f,f.length);for(let b=a;b<=c.length;b++){let h=c.slice(b-a,b),i=f.slice(b-a,b),j=await module.exports.sma(h,a),d=[],k=await module.exports.sma(i,a);for(let e=0;e<a;e++)d.push((h[e]-j[0])*(i[e]-k[0]));d=await module.exports.sum(d),g.push(d/a)}return g}const range=(a,b,c)=>Math.floor(c?c()*(Math.floor(b)-Math.ceil(a))+Math.ceil(a):Math.random()*(Math.floor(b)-Math.ceil(a))+Math.ceil(a)),pick=(a,b)=>a[Math.floor(b?b()*Math.floor(a.length):Math.random()*Math.floor(a.length))],float=(a,b,c)=>c?c()*(b-a)+a:Math.random()*(b-a)+a;function prng(b){for(var c=0,a=1779033703^b.length;c<b.length;c++)a=(a=Math.imul(a^b.charCodeAt(c),3432918353))<<13|a>>>19;return a=Math.imul(a^a>>>16,2246822507),a=Math.imul(a^a>>>13,3266489909),b=(a^=a>>>16)>>>0,function(){var a=b+=1831565813;return a=Math.imul(a^a>>>15,1|a),(((a^=a+Math.imul(a^a>>>7,61|a))^a>>>14)>>>0)/4294967296}}async function ncdf(a,c,d){var b=1/(1+.2315419*Math.abs(a=c||d?(a-c)/d:a)),e=.3989423*Math.exp(-a*a/2)*b*(.3193815+b*(-0.3565638+b*(1.781478+b*(-1.821256+1.330274*b))));return a>0?1-e:e}async function zigzag(a,g=.05){let b=[],e=1/0,f=-1/0,h=!1,i=!1,k=[];if(Array.isArray(a[0]))for(let c=0;c<a.length;c++)if(h)b[b.length-1].value>=a[c][1]&&(b[b.length-1].value=a[c][1],b[b.length-1].index=c),e>=a[c][1]&&(e=a[c][1]),(a[c][0]-e)/e>g&&(b.push({index:c,value:a[c][0]}),i=!0,h=!1,e=1/0);else if(i)b[b.length-1].value<=a[c][0]&&(b[b.length-1].value=a[c][0],b[b.length-1].index=c),f<=a[c][1]&&(f=a[c][1]),(f-a[c][1])/a[c][1]>g&&(b.push({index:c,value:a[c][1]}),h=!0,i=!1,f=-1/0);else{e>=a[c][1]&&(e=a[c][1]),f<=a[c][0]&&(f=a[c][0]);let l=(a[c][0]-e)/e,m=(f-a[c][1])/f;m>g&&l<g?(h=!0,b.push({index:0,value:a[0][0]}),b.push({index:c,value:a[c][1]})):l>g&&m<g?(i=!0,b.push({index:0,value:a[0][1]}),b.push({index:c,value:a[c][0]})):m>l?(h=!0,b.push({index:0,value:a[0][0]}),b.push({index:c,value:a[c][1]})):(i=!0,b.push({index:0,value:a[0][1]}),b.push({index:c,value:a[c][0]}))}else for(let d=0;d<a.length;d++)if(h)b[b.length-1].value>=a[d]&&(b[b.length-1].value=a[d],b[b.length-1].index=d),e>=a[d]&&(e=a[d]),(a[d]-e)/e>g&&(b.push({index:d,value:a[d]}),i=!0,h=!1,e=1/0);else if(i)b[b.length-1].value<=a[d]&&(b[b.length-1].value=a[d],b[b.length-1].index=d),f<=a[d]&&(f=a[d]),(f-a[d])/a[d]>g&&(b.push({index:d,value:a[d]}),h=!0,i=!1,f=-1/0);else{e>=a[d]&&(e=a[d]),f<=a[d]&&(f=a[d]);let n=(a[d]-e)/e,o=(f-a[d])/f;o>g&&n<g?(h=!0,b.push({index:0,value:a[0]}),b.push({index:d,value:a[d]})):n>g&&o<g?(i=!0,b.push({index:0,value:a[0]}),b.push({index:d,value:a[d]})):o>n?(h=!0,b.push({index:0,value:a[0]}),b.push({index:d,value:a[d]})):(i=!0,b.push({index:0,value:a[0]}),b.push({index:d,value:a[d]}))}k=[b[0].value];for(let j=1;j<b.length;j++){let q=b[j].index-b[j-1].index,r=(b[j].value-b[j-1].value)/q;for(let p=1;p<=q;p++)k.push(p*r+b[j-1].value)}return k}async function psar(a,g=.02,j=.2){let i=a[0],f=!0,e=g,h=a[0],b=a[0][1],d=a[0][0],k=[b];for(let c=1;c<a.length;c++)b+=e*(d-b),f?(b=Math.min(b,i[1],h[1]),a[c][0]>d&&(d=a[c][0],e=Math.min(e+g,j))):(b=Math.max(b,i[0],h[0]),a[c][1]<d&&(d=a[c][0],e=Math.min(e+g,j))),(f&&a[c][1]<b|| !f&&a[c][0]>b)&&(e=g,b=d,d=(f=!f)?a[c][0]:a[c][1]),i=h,h=a[c],k.push(b);return k}async function fibbands(e,f=20,h=3){for(var a=0,d=[],c=[],b=await module.exports.vwma(e,f);a<e.length;a++)if(d.push(e[a][0]),d.length>=f){var i=await module.exports.std(d,f);c.push(i*h),d.splice(0,1)}for(var a=0,g=[];a<b.length;a++){let j=b[a]+.236*c[a],k=b[a]+.382*c[a],l=b[a]+.5*c[a],m=b[a]+.618*c[a],n=b[a]+.764*c[a],o=b[a]+c[a],p=b[a]-.236*c[a],q=b[a]-.382*c[a],r=b[a]-.5*c[a],s=b[a]-.618*c[a],t=b[a]-.764*c[a],u=b[a]-c[a];g.push([o,n,m,l,k,j,b[a],p,q,r,s,t,u])}return g}async function supertrend(b,c=20,d=3){for(var a=c-1,e=await module.exports.atr(b,c),f=[];a<b.length;a++)f.push([b[a][0]+b[a][2]/2+d*e[a],(b[a][0]+b[a][2])/2-d*e[a]]);return f}async function cwma(d,a){for(var c=a.length,e=[];c<=d.length;c++){for(var h=d.slice(c-a.length,c),f=0,g=0,b=0;b<a.length;b++)f+=h[b]*a[b],g+=a[b];e.push(f/g)}return e}const fibnumbers=[0,1,1,2,3,5,8,13,21,34,55,89,144,233,377,610,987,1597,2584,4181],permutations=async a=>a.reduce((a,b)=>a*b);const random={range,pick,float,prng};const aroon={up:aroon_up,down:aroon_down,osc:aroon_osc};
