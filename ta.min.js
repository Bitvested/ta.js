/* ta.js (c) Nino Kroesen. MIT License. */ async function median(n,t){for(var e=[],a=t||n.length;a<=n.length;a++){var r=n.slice(a-t,a);r.sort((n,t)=>n-t),e.push(r[Math.round(r.length/2)-1])}return e}async function kmeans(n,t){var e,a=[],r=[],l=[],s=!1,h=Math.round(n.length/(t+1));for(i=0;i<t;i++)r[i]=n[h*(i+1)];do{for(i=0;i<t;i++)a[i]=[];for(x=0;x<n.length;x++){var o=-1;for(y=0;y<t;y++){var u=Math.abs(r[y]-n[x]);-1===o?(o=u,e=y):u<=o&&(o=u,e=y)}a[e].push(n[x])}for(l=r,x=0;x<t;x++){var p=0;for(y=0;y<a[x].length;y++)p+=a[x][y];var c=p/a[e].length;r[x]=c}for(x=0;x<t;x++)r[x]!==l[x]&&(s=!0)}while(s);return a}async function normalize(n,t){t=t||0;for(var e=await Math.max.apply(null,n.slice())*(1+t),a=await Math.min.apply(null,n.slice())*(1-t),r=[],l=0;l<n.length;l++)r.push(1-(e-n[l])/(e-a));return r}async function denormalize(n,t,e){e=e||0;for(var a=await Math.max.apply(null,n.slice())*(1+e),r=await Math.min.apply(null,n.slice())*(1-e),l=[],s=0;s<t.length;s++)l.push(r+t[s]*(a-r));return l}async function normalize_pair(n,t){for(var e=(n[0]+t[0])/2,a=[[e,e]],r=1;r<n.length;r++)a.push([a[a.length-1][0]*((n[r]-n[r-1])/n[r-1]+1),a[a.length-1][1]*((t[r]-t[r-1])/t[r-1]+1)]);return a}async function normalize_from(n,t){for(var e=[t],a=1;a<n.length;a++)e.push(e[e.length-1]*((n[a]-n[a-1])/n[a-1]+1));return e}async function standardize(n){for(var t=await sma(n,n.length),e=await std(n),a=[],r=0;r<n.length;r++)a.push((n[r]-t[0])/e);return a}async function mad(n,t){for(var e=t||n.length,a=[],r=e;r<=n.length;r++){var l=n.slice(r-e,r),s=await median(l),h=l.map(n=>Math.abs(n-s[s.length-1]));h=await median(h),a.push(h[h.length-1])}return a}async function aad(n,t){for(var e=t||n.length,a=[],r=e;r<=n.length;r++){var l=n.slice(r-e,r),s=0,h=await sma(l,e);for(q in l)s+=Math.abs(l[q]-h[h.length-1]);a.push(s/e)}return a}async function ssd(n,t){for(var e=t||n.length,a=[],r=e;r<=n.length;r++){var l=n.slice(r-e,r),s=await sma(l,e),h=0;for(let n in l)h+=(l[n]-s[s.length-1])**2;a.push(Math.sqrt(h))}return a}async function er(n){var t=[],e=[],a=1,r=1;for(let a in n)n[a]>=0?t.push(1+n[a]):e.push(1+n[a]);var l=t.length/n.length,s=e.length/n.length;for(let n in e)r*=e[n];for(let n in t)a*=t[n];return(100*(a**(1/t.length)-1)*l+100*(r**(1/e.length)-1)*s)/100}async function ar(n,t){for(var e=[],a=t;a<n.length;a++){var r=await er(n.slice(a-t,a));e.push(n[a]-r)}return e}async function kelly(n){var t=await er(n)+1,e=await winratio(n);return e-(1-e)/t}async function winratio(n){var t=0,e=0;for(let a in n)n[a]>=0?t++:e++;return t/(e+t)}async function avgwin(n){for(var t=[],e=0;e<n.length;e++)n[e]>=0&&t.push(n[e]);return(await sma(t,t.length))[0]}async function avgloss(n){for(var t=[],e=0;e<n.length;e++)n[e]<0&&t.push(n[e]);return(await sma(t,t.length))[0]}async function zscore(n,t){var e=[],a=n.slice(0,t-1);for(let s=t-1;s<n.length;s++){a.push(n[s]);var r=await sma(a,t),l=await std(a,t);e.push((n[s]-r[0])/l),a.splice(0,1)}return e}async function rsi(n,t){for(var e=t||14,a=[],r=n.slice(0,e-1),l=e-1,s=0,h=0;l<n.length;l++,s=0,h=0){r.push(n[l]);for(var o=1;o<r.length;o++)r[o]-r[o-1]<0?h+=Math.abs(r[o]-r[o-1]):s+=r[o]-r[o-1];var u=100-100/(1+s/e/(h/e));a.push(u),r.splice(0,1)}return a}async function wrsi(n,t){for(var e=t||14,a=[],r=[],l=[],s=1;s<n.length;s++)n[s]-n[s-1]<0?(l.push(Math.abs(n[s]-n[s-1])),r.push(0)):(l.push(0),r.push(n[s]-n[s-1]));l=await wsma(l,e),r=await wsma(r,e);for(let n in l)a.push(100-100/(1+r[n]/l[n]));return a}async function tsi(n,t,e,a){for(var r=t||25,l=e||13,s=a||13,h=[],o=[],u=[],i=[],p=1;p<n.length;p++)h.push(n[p]-n[p-1]),o.push(Math.abs(n[p]-n[p-1]));var c=await ema(h,r),g=await ema(o,r),m=await ema(c,l),f=await ema(g,l);for(p=0;p<m.length;p++)u.push(m[p]/f[p]);var v=await ema(u,s);u.splice(0,u.length-v.length);for(p=0;p<v.length;p++)i.push([v[p],u[p]]);return i}async function bop(n,t){var e=n.map(n=>(n[3]-n[0])/(n[1]-n[2]));t=t||14;return e=await sma(e,t)}async function fi(n,t){for(var e=t||13,a=[],r=[],l=1;l<n.length;l++)if(a.push((n[l][0]-n[l-1][0])*n[l][1]),a.length>=e){var s=await ema(a,e);r.push(s[s.length-1]),a.splice(0,1)}return r}async function asi(n){for(var t=[],e=1;e<n.length;e++){var a,r=n[e][1],l=n[e-1][1],s=n[e][0],h=n[e-1][0],o=n[e][2],u=n[e-1][2],i=h-r>u-r?h-r:u-r,p=n[e][0],c=n[e-1][0],g=Math.max(n[e][0],n[e-1][0])-Math.min(n[e][2],n[e-1][2]);s-l>o-l&&s-l>s-o&&(a=s-l-(o-l)/2+(l-c)/4),o-l>s-l&&o-l>s-o&&(a=o-l-(s-l)/2+(l-c)/4),s-o>s-l&&s-o>o-l&&(a=s-o+(l-c)/4),t.push((l-r+(l-c)/2+(r-p)/2)/a*50*i/g)}return t}async function ao(n,t,e){var a=t||5,r=e||35,l=[];n=n.map(n=>(n[0]+n[1])/2);for(var s=r;s<=n.length;s++){var h=n.slice(s-r,s),o=await sma(h,a),u=await sma(h,r);l.push(o[o.length-1]-u[u.length-1])}return l}async function ac(n,t,e){t=t||5,e=e||35;var a=await ao(n,t,e),r=await sma(a,t),l=[];a.length>r.length?a.splice(0,a.length-r.length):r.splice(0,r.length-a.length);for(let n in a)l.push(a[n]-r[n]);return l}async function fib(n,t){return[n,.236*(t-n)+n,.382*(t-n)+n,.5*(t-n)+n,.618*(t-n)+n,.786*(t-n)+n,t,1.618*(t-n)+n,2.618*(t-n)+n,3.618*(t-n)+n,4.236*(t-n)+n]}async function pr(n,t){for(var e=t||14,a=[],r=e;r<=n.length;r++){var l=n.slice(r-e,r),s=await Math.max.apply(null,l),h=await Math.min.apply(null,l);a.push((s-n[r-1])/(s-h)*-100)}return a}async function lsma(n,t){for(var e=t||25,a=[],r=e;r<=n.length;r++){for(var l,s,h=n.slice(r-e,r),o=0,u=0,i=0,p=0,c=1;c<=e;c++)o+=c,u+=h[c-1],i+=h[c-1]*c,p+=c*c,h[c-1]*h[c-1];s=u/e-(l=(i-o*u/e)/(p-o*o/e))*o/e,a.push(l*e+s)}return a}async function don(n,t){for(var e=[],a=t||20,r=a;r<=n.length;r++){var l=n.slice(r-a,r),s=[],h=[];for(let n in l)s.push(l[n][0]),h.push(l[n][1]);var o=Math.max.apply(null,s.slice()),u=Math.min.apply(null,h.slice());e.push([o,(o+u)/2,u])}return e}async function ichimoku(n,t,e,a,r){for(var l=[],s=t||9,h=e||26,o=a||52,u=r||26,i=[],p=[],c=0;c<n.length;c++)if(l.push(n[c]),l.length>=o){var g=[],m=[];for(let n in l)g.push(l[n][0]),m.push(l[n][2]);var f=(Math.max.apply(null,g.slice(g.length-s,g.length))+Math.min.apply(null,m.slice(m.length-s,m.length)))/2,v=(Math.max.apply(null,g.slice(g.length-h,g.length))+Math.min.apply(null,m.slice(m.length-h,m.length)))/2,x=n[c][1]+v,d=(Math.max.apply(null,g.slice(g.length-o,g.length))+Math.min.apply(null,m.slice(m.length-h,m.length)))/2;chik=n[c][1],p.push([f,v,x,d,chik]),l.splice(0,1)}for(c=u;c<p.length-u;c++)i.push([p[c][0],p[c][1],p[c+u][2],p[c+u][3],p[c-u][4]]);return i}async function stoch(n,t,e,a){var r=t||14,l=e||3,s=a||3,h=[],o=[],u=[],i=[];r<l&&([r,l]=[l,r]),s>l&&([s,l]=[l,s]);for(var p=0;p<n.length;p++){if(o.push(n[p][0]),u.push(n[p][2]),o.length>=r){var c=await Math.max.apply(null,o),g=await Math.min.apply(null,u),m=100*(n[p][1]-g)/(c-g);i.push(m)}if(s>0&&i.length>s){var f=await sma(i,s);i.push(f[f.length-1])}if(i.length-s>=l){var v=await sma(i,l);h.push([m,v[v.length-1]]),o.splice(0,1),u.splice(0,1),i.splice(0,1)}}return h}async function atr(n,t){for(var e=t||14,a=[n[0][0]-n[0][2]],r=1;r<n.length;r++){var l=await Math.max(n[r][0]-n[r-1][1],n[r][2]-n[r-1][1],n[r][0]-n[r][2]);a.push((a[a.length-1]*(e-1)+l)/e)}return a}async function sma(n,t){for(var e=t||14,a=[],r=e,l=0;r<=n.length;r++,l=0){var s=n.slice(r-e,r);for(q in s)l+=s[q];a.push(l/e)}return a}async function smma(n,t){for(var e=t||14,a=[],r=e;r<=n.length;r++){var l=n.slice(r-e,r),s=0;for(q in l)s+=l[q];a.length<=0?a.push(s/e):a.push((s-a[a.length-1])/e)}return a.splice(0,1),a}async function wma(n,t){for(var e=t||14,a=0,r=[],l=1;l<=e;l++)a+=l;for(l=e;l<=n.length;l++){var s=n.slice(l-e,l),h=0;for(q in s)h+=s[q]*(Number(q)+1)/a;r.push(h)}return r}async function wsma(n,t){for(var e=t||14,a=[],r=1/e,l=e;l<=n.length;l++)if(a.length>0)a.push((n[l-1]-a[a.length-1])*r+a[a.length-1]);else{var s=n.slice(l-e,l),h=0;for(q in s)h+=s[q];a.push(h/e)}return a}async function pwma(n,t){for(var e=0,a=[],r=[],l=t||14,s=l/2,h=t;s>=1;s--,h--)s%1!=0?e+=(s=Math.round(s))*h:(r.push(s*h),e+=s*h*2),r.unshift(s*h);for(s=l;s<=n.length;s++){for(var o=0,u=n.slice(s-l,s),i=l-1;i>=0;i--)o+=u[i]*r[i]/e;a.push(o)}return a}async function hwma(n,t){for(var e=0,a=[],r=[],l=t||14,s=1,h=l;s<=l/2;s++,h--)s%1!=0?e+=(s=Math.round(s))*h:(r.push(s*h),e+=s*h*2),r.unshift(s*h);for(s=l;s<=n.length;s++){for(var o=0,u=n.slice(s-l,s),i=l-1;i>=0;i--)o+=u[i]*r[i]/e;a.push(o)}return a}async function vwma(n,t){for(var e=t||20,a=[],r=(n=n.map(n=>[n[0]*n[1],n[1]]),e);r<=n.length;r++){for(var l=n.slice(r-e,r),s=0,h=0,o=0;o<l.length;o++)s+=l[o][1],h+=l[o][0];a.push(h/s)}return a}async function ema(n,t){for(var e=t||12,a=[],r=2/(e+1),l=e;l<=n.length;l++)if(a.length>0)a.push((n[l-1]-a[a.length-1])*r+a[a.length-1]);else{var s=n.slice(l-e,l),h=0;for(q in s)h+=s[q];a.push(h/e)}return a}async function hull(n,t){var e=t||14,a=[],r=[],l=await wma(n,e),s=Math.round(Math.sqrt(e)),h=await wma(n,Math.round(e/2));h.splice(0,h.length-l.length);for(let n in l)if(a.push(2*h[n]-l[n]),a.length>=s){var o=await wma(a,s);r.push(o[0]),a.splice(0,1)}return r}async function kama(n,t,e,a){t=t||10,e=e||2,a=a||30;for(var r=[(r=await sma(n,t))[r.length-1]],l=t+1;l<n.length;l++){for(var s=0,h=Math.abs(n[l]-n[l-t]),o=1;o<t;o++)s+=Math.abs(n[l-o]-n[l-o-1]);var u=(h/s*(2/(e+1)-2/(a+1)+2/(a+1)))**2;r.push(r[r.length-1]+u*(n[l]-r[r.length-1]))}return r}async function macd(n,t,e){var a=t||12,r=e||26;a>r&&([a,r]=[r,a]);var l=await ema(n,a),s=await ema(n,r),h=[];l.splice(0,r-a);for(var o=0;o<s.length;o++)h.push(l[o]-s[o]);return h}async function bands(n,t,e){for(var a=t||14,r=e||1,l=[],s=[],h=[],o=await sma(n,a),u=0;u<n.length;u++)if(l.push(n[u]),l.length>=a){var i=await std(l,a);s.push(i),l.splice(0,1)}for(u=0;u<o.length;u++)h.push([o[u]+s[u]*r,o[u],o[u]-s[u]*r]);return h}async function bandwidth(n,t,e){for(var a=t||14,r=e||1,l=[],s=await bands(n,a,r),h=0;h<s.length;h++)l.push((s[h][0]-s[h][2])/s[h][1]);return l}async function keltner(n,t,e){var a,r=t||14,l=e||1,s=[],h=await atr(n,r),o=[];for(var u in n)s.push((n[u][0]+n[u][1]+n[u][2])/3);a=await sma(s,r),h.splice(0,r-1);for(u=0;u<a.length;u++)o.push([a[u]+h[u]*l,a[u],a[u]-h[u]*l]);return o}async function variance(n,t){for(var e=t||n.length,a=[],r=e;r<=n.length;r++){var l=n.slice(r-e,r),s=await sma(l,e),h=0;for(x in l)h+=(l[x]-s[s.length-1])**2;a.push(h/e)}return a}async function std(n,t){var e=t||n.length,a=n.reduce((n,t)=>Number(n)+Number(t))/e;return Math.sqrt(n.reduce((n,t)=>n+Math.pow(t-a,2),0)/e)}async function normsinv(n){var t=-.00778489400243029,e=-.322396458041136,a=-2.40075827716184,r=-2.54973253934373,l=4.37466414146497,s=2.93816398269878,h=.00778469570904146,o=.32246712907004,u=2.445134137143,i=3.75440866190742;if(n<0||n>1)return 0;if(n<.02425)return(((((t*(p=Math.sqrt(-2*Math.log(n)))+e)*p+a)*p+r)*p+l)*p+s)/((((h*p+o)*p+u)*p+i)*p+1);if(n<=.97575){var p,c=(p=n-.5)*p;return(((((-39.6968302866538*c+220.946098424521)*c-275.928510446969)*c+138.357751867269)*c-30.6647980661472)*c+2.50662827745924)*p/(((((-54.4760987982241*c+161.585836858041)*c-155.698979859887)*c+66.8013118877197)*c-13.2806815528857)*c+1)}return-(((((t*(p=Math.sqrt(-2*Math.log(1-n)))+e)*p+a)*p+r)*p+l)*p+s)/((((h*p+o)*p+u)*p+i)*p+1)}async function sim(n,t,e,a){for(var r=[],l=(t=t||50,e=e||1e3,0);l<e;l++){for(var s=n.slice(),h=0;h<t;h++){for(var o=[],u=1;u<s.length;u++){var i=await dif(s[u],s[u-1]);o.push(i)}var p=await sma(o,o.length),c=await std(o),g=await normsinv(Math.random());s.push(s[s.length-1]*Math.exp(p[0]-c*c/2+c*g))}r.push(s)}return a?await percentile(r,a):r}async function percentile(n,t){for(var e=[],a=0;a<n[0].length;a++)n.sort((n,t)=>n[a]-t[a]),e.push(n[Math.round((n.length-1)*t)][a]);return e}async function cor(n,t){for(var e=await sma(n,n.length),a=await sma(t,t.length),r=0,l=0,s=0,h=0;h<n.length;h++){var o=n[h]-e,u=t[h]-a;r+=o*u,l+=Math.pow(o,2),s+=Math.pow(u,2)}var i=n.length-1;return l/=i,s/=i,r/(i*(l=Math.sqrt(l))*(s=Math.sqrt(s)))}async function dif(n,t){return(n-t)/t}async function log(n){return n.map(n=>Math.log(n))}async function exp(n){return n.map(n=>Math.exp(n))}async function drawdown(n){for(var t=n[0],e=n[0],a=0,r=1;r<n.length;r++){if(n[r]>t){if(0!=e)(l=await dif(e,t))<a&&(a=l),e=n[r];t=n[r]}n[r]<e&&(e=n[r])}var l;return(l=await dif(e,t))<a&&(a=l),a}async function aroon_up(n,t){for(var e=t||10,a=[],r=e;r<=n.length;r++){var l=n.slice(r-e,r),s=l.slice();s.sort((n,t)=>n-t),a.push(100*(e-1-l.reverse().findIndex(n=>n===s[e-1]))/(e-1))}return a}async function aroon_down(n,t){for(var e=t||10,a=[],r=e;r<=n.length;r++){var l=n.slice(r-e,r),s=l.slice();s.sort((n,t)=>n-t),a.push(100*(e-1-l.reverse().findIndex(n=>n===s[0]))/(e-1))}return a}async function aroon_osc(n,t){for(var e=t||25,a=[],r=await aroon.up(n,e),l=await aroon.down(n,e),s=0;s<r.length;s++)a.push(r[s]-l[s]);return a}async function mfi(n,t){for(var e=t||14,a=[],r=n.map(n=>n[1]),l=n.map(n=>n[0]),s=e;s<=n.length;s++){var h=0,o=0;for(q=s-e;q<s;q++)h+=l[q],o+=r[q];a.push(100-100/(1+h/o))}return a}async function roc(n,t){for(var e=t||14,a=[],r=e;r<=n.length;r++)a.push((n[r-1]-n[r-e])/n[r-e]);return a}async function cop(n,t,e,a){t=t||11,e=e||14,a=a||10,max=Math.max(t,e),co=[];for(var r=max+a;r<n.length;r++){var l=n.slice(r-(max+a),r),s=l.slice(),h=[];l=await roc(l,t),s=await roc(s,e),l.splice(0,l.length-s.length),s.splice(0,s.length-l.length);for(var o=0;o<l.length;o++)h.push(l[o]+s[o]);h=await wma(h,a),co.push(h[h.length-1])}return co}async function kst(n,t,e,a,r,l,s,h,o,u){t=t||10,e=e||15,a=a||20,r=r||30,l=l||10,s=s||10,h=h||10,o=o||15,u=u||9;for(var i=[],p=[],c=Math.max(t,e,a,r)+Math.max(l,s,h,o),g=c;g<=n.length;g++){var m=n.slice(g-c,g),f=await roc(m,t),v=await roc(m,e),x=await roc(m,a),d=await roc(m,r);f=await sma(f,l),v=await sma(v,s),x=await sma(x,h),d=await sma(d,o),i.push(f[f.length-1]+v[v.length-1]+x[x.length-1]+d[d.length-1])}var w=await sma(i,u);for(var g in i.splice(0,i.length-w.length),w)p.push([i[g],w[g]]);return p}async function obv(n){for(var t=[0],e=1;e<n.length;e++)n[e][1]>n[e-1][1]&&t.push(t[t.length-1]+n[e][0]),n[e][1]<n[e-1][1]&&t.push(t[t.length-1]-n[e][0]),n[e][1]===n[e-1][1]&&t.push(t[t.length-1]);return t}async function vwap(n,t){for(var e=!t||t>n.length?n.length:t,a=(n=n.map(n=>[n[0]*n[1],n[1]]),[]),r=e;r<=n.length;r++){for(var l=n.slice(r-e,r),s=0,h=0,o=0;o<l.length;o++)s+=l[o][1],h+=l[o][0];a.push(h/s)}return a}async function mom(n,t,e){for(var a=t||10,r=[],l=a-1;l<n.length;l++)e?r.push(n[l]/n[l-(a-1)]*100):r.push(n[l]-n[l-(a-1)]);return r}async function mom_osc(n,t){for(var e=t?t+1:10,a=[],r=e;r<=n.length;r++){for(var l=0,s=0,h=1;h<e;h++)n[r-e+(h-1)]<n[r-e+h]?l+=n[r-e+h]:s+=n[r-e+h];a.push((l-s)/(l+s)*100)}return a}async function ha(n){for(var t=[[(Number(n[0][0])+Number(n[0][3]))/2,Number(n[0][1]),Number(n[0][2]),(Number(n[0][0])+Number(n[0][1])+Number(n[0][2])+Number(n[0][3]))/4]],e=1;e<n.length;e++)t.push([(t[t.length-1][0]+t[t.length-1][3])/2,Math.max(t[t.length-1][0],t[t.length-1][3],n[e][1]),Math.min(t[t.length-1][0],t[t.length-1][3],n[e][2]),(n[e][0]+n[e][1]+n[e][2]+n[e][3])/4]);return t}async function ren(n,t){for(var e=[],a=(t=t||1,Math.floor(t)===t?0:t.toString().split(".")[1].length||0),r=Math.ceil(n[0][0]/t*10**a)/10**a*t,l=r-t,s=1;s<n.length;s++){if(n[s][0]>r+t)do{e.push([r,r+t,r,r+t]),r+=t,l+=t}while(n[s][0]>r+t);if(n[s][1]<l-t)do{e.push([l,l,l-t,l-t]),r-=t,l-=t}while(n[s][1]<l-t)}return e}async function envelope(n,t,e){e=e||.005;for(var a=[],r=t=t||10;r<n.length;r++){var l=await sma(n.slice(r-t,r),t);a.push([l[0]*(1+e),l[0],l[0]*(1-e)])}return a}async function chaikin_osc(n,t,e){t=t||3,e=e||10;for(var a=[],r=[],l=0;l<n.length;l++){var s=(n[l][1]-n[l][2]-(n[l][0]-n[l][1]))/(n[l][0]-n[l][2]);isNaN(s)?r.push(0):r.push(s*n[l][3])}var h=await ema(r,t),o=await ema(r,e);h.length>o.length?h.splice(0,h.length-o.length):o.splice(0,o.length-h.length);for(l=0;l<h.length;l++)a.push(h[l]-o[l]);return a}async function fractals(n){for(var t=[[!1,!1],[!1,!1]],e=2;e<n.length-2;e++){var a=n[e-2][0]<n[e][0]&&n[e-1][0]<n[e][0]&&n[e][0]>n[e+1][0]&&n[e][0]>n[e+2][0],r=n[e-2][1]>n[e][1]&&n[e-1][1]>n[e][1]&&n[e][1]<n[e+1][1]&&n[e][1]<n[e+2][1];t.push([a,r])}return t.push([!1,!1],[!1,!1]),t}async function alligator(n,t,e,a,r,l,s){t=t||13,e=e||8,a=a||5,r=r||8,l=l||5,s=s||3;var h=[],o=await smma(n,t),u=await smma(n,e),i=await smma(n,a);u.splice(0,u.length-o.length),i.splice(0,i.length-o.length);for(var p=o.length-1;p>=7;p--)h.push([o[p-(r-1)],u[p-(l-1)],i[p-(s-1)]]);return h}async function gator(n,t,e,a,r,l,s){t=t||13,e=e||8,a=a||5,r=r||8,l=l||5,s=s||3;var h=[],o=await smma(n,t),u=await smma(n,e),i=await smma(n,a);u.splice(0,u.length-o.length),i.splice(0,i.length-o.length);for(var p=o.length-1;p>=r-1;p--)h.push([o[p-(r-1)]-u[p-(l-1)],-Math.abs(u[p-(l-1)]-i[p-(s-1)])]);return h}async function recent_high(n,t){for(var e=t=t||25,a=0,r=n[n.length-1],l=n.length-2;l>=0&&(n[l]>=r&&e>0?(r=n[l],a=l,e=t):e--,!(e<=0));l--);return{index:a,value:r}}async function recent_low(n,t){for(var e=t=t||25,a=0,r=n[n.length-1],l=n.length-2;l>=0&&(n[l]<=r&&e>0?(r=n[l],a=l,e=t):e--,!(e<=0));l--);return{index:a,value:r}}async function support(n,t){var e,a,r=(t=t||await recent_low(n)).value;do{for(var l=t.index;l<n.length;l++){var s=(t.value-n[l])/(t.index-l);s<r&&(r=s,e=l)}t.index+1==e&&e!=n.length-1?(t.index=e,r=Math.min.apply(null,n.slice()),t.value=n[t.index],a=!1):a=!0,t.index==n.length-1&&(a=!0)}while(!a);return e==n.length-1||t.index==n.length-1?{calculate:async n=>t.value,slope:0,lowest:t.value,index:t.index}:{calculate:async n=>n*r+t.value,slope:r,lowest:t.value,index:t.index}}async function resistance(n,t){var e,a,r=(t=t||await recent_high(n)).value;do{for(var l=t.index;l<n.length;l++){var s=(n[l]-t.value)/(t.index-l);s<r&&(r=s,e=l)}t.index+1==e&&e!=n.length-1?(t.index=e,r=Math.max.apply(null,n.slice()),t.value=n[t.index],a=!1):a=!0,t.index==n.length-1&&(a=!0)}while(!a);return e==n.length-1||t.index==n.length-1?{calculate:async n=>t.value,slope:0,highest:t.value,index:t.index}:{calculate:async n=>n*-r+t.value,slope:r,highest:t.value,index:t.index}}async function fisher(n,t){var e=[],a=0,r=0;for(let o=t;o<=n.length;o++){var l=n.slice(o-t,o),s=a,h=Math.min.apply(null,l);(r=.66*((n[o-1]-h)/(Math.max.apply(null,l)-h)-.5)+.67*r)>.99&&(r=.999),r<-.99&&(r=-.999),a=.5*Math.log((1+r)/(1-r))+.5*s,e.push([a,s])}return e.slice(1,e.length)}async function cross(n,t){n.splice(0,n.length-t.length);for(var e=n[0]>t[0],a=[],r=0;r<n.length;r++)n[r]<t[r]&&e&&(a.push({index:r,cross:!1}),e=!1),n[r]>t[r]&&!e&&(a.push({index:r,cross:!0}),e=!0);return a}async function se(n,t){return t=t||n.length,await std(n)/t**.5}async function halftrend(n,t,e,a){let r=[],l=[0],s=[0],h=[0],o=[0],u=void 0;for(let c=t;c<=n.length;c++){let g=n.slice(c-t,c);maxlow=g[g.length-2][2],minhigh=g[g.length-2][0],atr2=await atr(g,t),atr2=atr2[atr2.length-1]/2;let m=a*atr2,f=Math.max.apply(null,g.slice(g.length-1,g.length).map(n=>n[0])),v=Math.min.apply(null,g.slice(g.length-1,g.length).map(n=>n[2])),x=await sma(g.slice(g.length-e,g.length).map(n=>n[0]),e),d=await sma(g.slice(g.length-e,g.length).map(n=>n[2]),e);if(1==l[l.length-1]?(maxlow=Math.max(v,maxlow),x[0]<maxlow&&g[g.length-1][1]<g[g.length-2][2]&&(s.push(1),l.push(0),minhigh=g[g.length-2][0])):(minhigh=Math.min(f,minhigh),d[0]>minhigh&&g[g.length-1][1]<g[g.length-2][0]&&(s.push(0),l.push(1),maxlow=v)),0==s[s.length-1]){isNaN(s[s.length-2])||0==s[s.length-2]?h.push(isNaN(h[h.length-2])?maxlow:Math.max(h[h.length-2],maxlow)):h.push(isNaN(o[o.length-2])?o[o.length-1]:o[o.length-2]),u="long";var i=h[h.length-1]+m,p=h[h.length-1]-m}else{isNaN(s[s.length-2])||1==s[s.length-2]?o.push(isNaN(o[o.length-2])?minhigh:Math.min(minhigh,o[o.length-2])):o.push(isNaN(h[h.len-2])?h[h.length-1]:h[h.length-2]),u="short";i=o[o.length-1]+m,p=o[o.length-1]-m}r.push([i,0==s[s.length-1]?h[h.length-1]:o[o.length-1],p,u])}return r}const aroon={up:aroon_up,down:aroon_down,osc:aroon_osc}
