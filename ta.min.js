/* ta.js (c) Nino Kroesen. MIT License. */ async function rsi(a,n){for(var r=n?n-1:13,t=[],e=[],s=1;s<a.length;s++){var o=(a[s]-a[s-1])/a[s]*100;if(t.push(o),t.length>=r){var u=0,h=0;for(q in t)t[q]<0&&(h+=t[q]),t[q]>=0&&(u+=t[q]);u/=r,h=Math.abs(h)/r,rsi=Number(100-100/(1+u/h)),e.push(rsi);o=(a[s]-a[s-1])/a[s]*100;t.push(o),t.splice(0,1)}}return e}async function tsi(a,n,r,t){for(var e=n||25,s=r||13,o=t||13,u=[],h=[],l=[],i=[],p=1;p<a.length;p++)u.push(a[p]-a[p-1]),h.push(Math.abs(a[p]-a[p-1]));var c=await ema(u,e),f=await ema(h,e),m=await ema(c,s),g=await ema(f,s);for(p=0;p<m.length;p++)l.push(m[p]/g[p]);var v=await ema(l,o);l.splice(0,l.length-v.length);for(p=0;p<v.length;p++)i.push([v[p],l[p]]);return i}async function pr(a,n){for(var r=n||14,t=[],e=[],s=0;s<a.length;s++)if(e.push(a[s]),e.length>=r-1){var o=await Math.max.apply(null,e),u=await Math.min.apply(null,e);t.push((o-a[s])/(o-u)*-100),e.splice(0,1)}return t}async function stoch(a,n,r,t){var e=n||14,s=r||3,o=t||3;e<s&&([e,s]=[s,e]),o>s&&([o,s]=[s,o]);for(var u=[],h=[],l=[],i=[],p=0;p<a.length;p++){if(h.push(a[p][0]),l.push(a[p][2]),h.length>=e){var c=await Math.max.apply(null,h),f=await Math.min.apply(null,l),m=100*(a[p][1]-f)/(c-f);i.push(m)}if(o>0&&i.length>o){var g=await sma(i,o);i.push(g[g.length-1])}if(i.length-o>=s){var v=await sma(i.slice(o),s);u.push([m,v[v.length-1]]),h.splice(0,1),l.splice(0,1),i.splice(0,1)}}return u}async function atr(a,n){for(var r=n||14,t=[],e=0;e<a.length;e++)if(t.length<1)t.push(a[e][0]-a[e][2]);else{var s=await Math.max(a[e][0]-a[e-1][1],a[e][2]-a[e-1][1],a[e][0]-a[e][2]),o=(t[t.length-1]*(r-1)+s)/r;t.push(o)}return t}async function sma(a,n){for(var r=n||14,t=[],e=[],s=0;s<a.length;s++)if(t.push(a[s]),t.length>=r){var o=0;for(q in t)o+=t[q];e.push(o/r),t.splice(0,1)}return e}async function smma(a,n){for(var r=n||14,t=[],e=[],s=0;s<a.length;s++)if(t.push(a[s]),t.length>=r){var o=0;for(q in t)o+=t[q];e?e.push(o/r):e.push((o-sma1+a[s])/r),t.splice(0,1)}return e.splice(0,1),e}async function wma(a,n){for(var r=n||14,t=0,e=1;e<=r;e++)t+=e;var s=[],o=[];for(e=0;e<a.length;e++)if(s.push(a[e]),s.length>=r){var u=0,h=1;for(q in s)u+=s[q]*h/t,h++;o.push(u),s.splice(0,1)}return o}async function vwma(a,n){for(var r=n||20,t=[],e=[],s=0;s<a.length;s++)if(t.push([a[s][0]*a[s][1],a[s][1]]),t.length>=r){for(var o=0,u=0,h=0;h<t.length;h++)o+=t[h][1],u+=t[h][0];e.push(u/o),t.splice(0,1)}return e}async function ema(a,n){for(var r=n||12,t=[],e=[],s=0,o=2/(r+1),u=0;u<a.length;u++){t.push(a[u]);var h=0;if(0==s&&t.length>=r){for(q in t)h+=t[q];h/=r,e.push(h),s=h}else 0!=s&&t.length>=r&&(h=(a[u]-s)*o+s,e.push(h),s=h)}return e}async function hull(a,n){var r=n||14,t=[],e=[],s=await wma(a.slice(),r),o=Math.round(Math.sqrt(r)),u=await wma(a.slice(),Math.round(r/2));u.splice(0,u.length-s.length);for(let a in s)if(t.push(2*u[a]-s[a]),t.length>=o){var h=await wma(t,o);e.push(h[h.length-1])}return e}async function macd(a,n,r){var t=n||12,e=r||26;t>e&&([t,e]=[e,t]);var s=await ema(a,t),o=await ema(a,e);s.splice(0,e-t);for(var u=[],h=0;h<o.length;h++)u.push([s[h]-o[h]]);return u}async function bands(a,n,r){for(var t=n||14,e=r||1,s=[],o=[],u=[],h=await sma(a,t),l=0;l<a.length;l++)if(s.push(a[l]),s.length>=t){var i=await std(s,t);o.push(i),s.splice(0,1)}for(l=0;l<h.length;l++)u.push([h[l]+o[l]*e,h[l],h[l]-o[l]*e]);return u}async function bandwidth(a,n,r){for(var t=n||14,e=r||1,s=[],o=[],u=[],h=await sma(a,t),l=0;l<a.length;l++)if(s.push(a[l]),s.length>=t){var i=await std(s);o.push(i),s.push(a[l]),s.splice(0,1)}for(l=0;l<o.length;l++){var p=(h[l]+o[l]*e-(h[l]-o[l]*e))/h[l];u.push(p)}return u}async function keltner(a,n,r){var t,e=n||14,s=r||1,o=[],u=await atr(a,e),h=[];for(var l in a)o.push((a[l][0]+a[l][1]+a[l][2])/3);t=await sma(o,e),u.splice(0,e-1);for(l=0;l<t.length;l++)h.push([t[l]+u[l]*s,t[l],t[l]-u[l]*s]);return h}async function std(a,n){var r=n||a.length,t=a.reduce((a,n)=>Number(a)+Number(n))/r;return Math.sqrt(a.reduce((a,n)=>a+Math.pow(n-t,2),0)/r)}async function dif(a,n){return(a-n)/n}async function aroon_up(a,n){for(var r=n||10,t=[],e=[],s=0;s<a.length;s++)if(t.push(a[s]),t.length>=r){var o=t.slice(0);o.sort((a,n)=>a-n);var u=o[r-1];e.push(100*(r-(t.findIndex(a=>a==u)+1))/r),t.splice(0,1)}return e}async function aroon_down(a,n){for(var r=n||10,t=[],e=[],s=0;s<a.length;s++)if(t.push(a[s]),t.length>=r){var o=t.slice(0);o.sort((a,n)=>a-n);var u=o[0];e.push(100*(r-(t.findIndex(a=>a==u)+1))/r),t.splice(0,1)}return e}async function aroon_osc(a,n){for(var r=n||25,t=[],e=await aroon.up(a,r),s=await aroon.down(a,r),o=0;o<e.length;o++)t.push(e[o]-s[o]);return t}async function mfi(a,n){for(var r=n||14,t=[],e=[],s=[],o=0;o<a.length;o++)if(s.push(a[o][0]),e.push(a[o][1]),s.length>=r){var u=0,h=0;for(q in s)u+=s[q];for(q in e)h+=e[q];t.push(100-100/(1+u/h)),s.splice(0,1),e.splice(0,1)}return t}async function roc(a,n){for(var r=n||14,t=[],e=[],s=0;s<a.length;s++)t.push(a[s]),t.length>=r&&(e.push((t[r-1]-t[0])/t[0]),t.splice(0,1));return e}async function obv(a){for(var n=[0],r=1;r<a.length;r++)a[r][1]>a[r-1][1]&&n.push(n[n.length-1]+a[r][0]),a[r][1]<a[r-1][1]&&n.push(n[n.length-1]-a[r][0]),a[r][1]==a[r-1][1]&&n.push(n[n.length-1]);return n}async function vwap(a,n){for(var r=!n||n>a.length?a.length:n,t=[],e=[],s=0;s<a.length;s++)if(t.push([a[s][0]*a[s][1],a[s][1]]),t.length>=r){for(var o=0,u=0,h=0;h<t.length;h++)o+=t[h][1],u+=t[h][0];e.push(u/o),t.splice(0,1)}return e}async function mom(a,n,r){for(var t=n||10,e=[],s=t-1;s<a.length;s++)r?e.push(a[s]/a[s-(t-1)]*100):e.push(a[s]-a[s-(t-1)]);return e}const aroon={up:aroon_up,down:aroon_down,osc:aroon_osc};
