/* ta.js (c) Nino Kroesen. MIT License. */ async function median(a,n){for(var t=n||a.length,e=[],r=[],s=0;s<a.length;s++)if(e.push(a[s]),e.length>=t){var l=e.slice();l.sort((a,n)=>a>n?-1:a<n?1:0),r.push(l[Math.round(l.length/2)]),e.splice(0,1)}return r}async function rsi(a,n){for(var t=n||14,e=[],r=[],s=1;s<a.length;s++){var l=a[s]-a[s-1];if(e.push(l),e.length>=t){var h=0,o=0;for(q in e)e[q]<0&&(o+=e[q]),e[q]>=0&&(h+=e[q]);h/=t,o=Math.abs(o)/t,rsi=Number(100-100/(1+h/o)),r.push(rsi),e.splice(0,1)}}return r}async function tsi(a,n,t,e){for(var r=n||25,s=t||13,l=e||13,h=[],o=[],u=[],i=[],p=1;p<a.length;p++)h.push(a[p]-a[p-1]),o.push(Math.abs(a[p]-a[p-1]));var c=await ema(h,r),f=await ema(o,r),m=await ema(c,s),g=await ema(f,s);for(p=0;p<m.length;p++)u.push(m[p]/g[p]);var v=await ema(u,l);u.splice(0,u.length-v.length);for(p=0;p<v.length;p++)i.push([v[p],u[p]]);return i}async function fi(a,n){for(var t=n||13,e=[],r=[],s=1;s<a.length;s++)if(e.push(a[s][0]-a[s-1][0]),e.length>t){var l=await ema(e.slice(),t);r.push((a[s][0]-a[s-1][0])*l[0]),e.splice(0,1)}return ffi}async function asi(a){for(var n=[],t=1;t<a.length;t++){var e,r=a[t][1],s=a[t-1][1],l=a[t][0],h=a[t-1][0],o=a[t][2],u=a[t-1][2],i=h-r>u-r?h-r:u-r,p=a[t][0],c=a[t-1][0],f=Math.max(a[t][0],a[t-1][0])-Math.min(a[t][2],a[t-1][2]);l-s>o-s&&l-s>l-o&&(e=l-s-(o-s)/2+(s-c)/4),o-s>l-s&&o-s>l-o&&(e=o-s-(l-s)/2+(s-c)/4),l-o>l-s&&l-o>o-s&&(e=l-o+(s-c)/4),n.push((s-r+(s-c)/2+(r-p)/2)/e*50*i/f)}return n}async function ao(a,n,t){for(var e=n||5,r=t||35,s=[],l=[],h=0;h<a.length;h++)if(s.push((a[h][0]+a[h][1])/2),s.length>=r){var o=await sma(s.slice(),e),u=await sma(s.slice(),r);l.push(o[o.length-1]-u[u.length-1]),s.splice(0,1)}return l}async function pr(a,n){for(var t=n||14,e=[],r=[],s=0;s<a.length;s++)if(r.push(a[s]),r.length>=t-1){var l=await Math.max.apply(null,r),h=await Math.min.apply(null,r);e.push((l-a[s])/(l-h)*-100),r.splice(0,1)}return e}async function lsma(a,n){for(var t=n||25,e=[],r=[],s=0;s<a.length;s++)if(e.push(a[s]),e.length>=t){for(var l,h,o=0,u=0,i=0,p=0,c=1;c<=t;c++)o+=c,u+=e[c-1],i+=e[c-1]*c,p+=c*c,e[c-1]*e[c-1];h=u/t-(l=(i-o*u/t)/(p-o*o/t))*o/t,r.push(l*t+h),e.splice(0,1)}return r}async function don(a,n){for(var t=[],e=[],r=n||20,s=0;s<a.length;s++)if(t.push(a[s]),t.length>=r){var l=[],h=[];for(let a in t)l.push(t[a][0]),h.push(t[a][1]);var o=Math.max.apply(null,l.slice()),u=Math.min.apply(null,h.slice());e.push([o,(o+u)/2,u]),t.splice(0,1)}return e}async function ichimoku(a,n,t,e,r){for(var s=[],l=n||9,h=t||26,o=e||52,u=r||26,i=[],p=[],c=0;c<a.length;c++)if(s.push(a[c]),s.length>o){var f=[],m=[];for(let a in s)f.push(s[a][0]),m.push(s[a][2]);var g=(Math.max.apply(null,f.slice(f.length-1-l,f.length-1))+Math.min.apply(null,m.slice(m.length-1-l,m.length-1)))/2,v=(Math.max.apply(null,f.slice(f.length-1-h,f.length-1))+Math.min.apply(null,m.slice(m.length-1-h,m.length-1)))/2,d=a[c][1]+v,w=(Math.max.apply(null,f.slice(f.length-1-o,f.length-1))+Math.min.apply(null,m.slice(m.length-1-h,m.length-1)))/2;chik=a[c][1],p.push([g,v,d,w,chik]),s.splice(0,1)}for(c=u;c<p.length-u;c++)i.push([p[c][0],p[c][1],p[c+(u-1)][2],p[c+(u-1)][3],p[c+u-1][4]]);return i}async function stoch(a,n,t,e){var r=n||14,s=t||3,l=e||3;r<s&&([r,s]=[s,r]),l>s&&([l,s]=[s,l]);for(var h=[],o=[],u=[],i=[],p=0;p<a.length;p++){if(o.push(a[p][0]),u.push(a[p][2]),o.length>=r){var c=await Math.max.apply(null,o),f=await Math.min.apply(null,u),m=100*(a[p][1]-f)/(c-f);i.push(m)}if(l>0&&i.length>l){var g=await sma(i,l);i.push(g[g.length-1])}if(i.length-l>=s){var v=await sma(i.slice(l),s);h.push([m,v[v.length-1]]),o.splice(0,1),u.splice(0,1),i.splice(0,1)}}return h}async function atr(a,n){for(var t=n||14,e=[],r=0;r<a.length;r++)if(e.length<1)e.push(a[r][0]-a[r][2]);else{var s=await Math.max(a[r][0]-a[r-1][1],a[r][2]-a[r-1][1],a[r][0]-a[r][2]),l=(e[e.length-1]*(t-1)+s)/t;e.push(l)}return e}async function sma(a,n){for(var t=n||14,e=[],r=[],s=0;s<a.length;s++)if(e.push(a[s]),e.length>=t){var l=0;for(q in e)l+=e[q];r.push(l/t),e.splice(0,1)}return r}async function smma(a,n){for(var t=n||14,e=[],r=[],s=0;s<a.length;s++)if(e.push(a[s]),e.length>=t){var l=0;for(q in e)l+=e[q];r?r.push(l/t):r.push((l-sma1+a[s])/t),e.splice(0,1)}return r.splice(0,1),r}async function wma(a,n){for(var t=n||14,e=0,r=1;r<=t;r++)e+=r;var s=[],l=[];for(r=0;r<a.length;r++)if(s.push(a[r]),s.length>=t){var h=0,o=1;for(q in s)h+=s[q]*o/e,o++;l.push(h),s.splice(0,1)}return l}async function vwma(a,n){for(var t=n||20,e=[],r=[],s=0;s<a.length;s++)if(e.push([a[s][0]*a[s][1],a[s][1]]),e.length>=t){for(var l=0,h=0,o=0;o<e.length;o++)l+=e[o][1],h+=e[o][0];r.push(h/l),e.splice(0,1)}return r}async function ema(a,n){for(var t=n||12,e=[],r=[],s=0,l=2/(t+1),h=0;h<a.length;h++){e.push(a[h]);var o=0;if(0==s&&e.length>=t){for(q in e)o+=e[q];o/=t,r.push(o),s=o}else 0!=s&&e.length>=t&&(o=(a[h]-s)*l+s,r.push(o),s=o)}return r}async function hull(a,n){var t=n||14,e=[],r=[],s=await wma(a.slice(),t),l=Math.round(Math.sqrt(t)),h=await wma(a.slice(),Math.round(t/2));h.splice(0,h.length-s.length);for(let a in s)if(e.push(2*h[a]-s[a]),e.length>=l){var o=await wma(e,l);r.push(o[o.length-1])}return r}async function macd(a,n,t){var e=n||12,r=t||26;e>r&&([e,r]=[r,e]);var s=await ema(a,e),l=await ema(a,r);s.splice(0,r-e);for(var h=[],o=0;o<l.length;o++)h.push([s[o]-l[o]]);return h}async function bands(a,n,t){for(var e=n||14,r=t||1,s=[],l=[],h=[],o=await sma(a,e),u=0;u<a.length;u++)if(s.push(a[u]),s.length>=e){var i=await std(s,e);l.push(i),s.splice(0,1)}for(u=0;u<o.length;u++)h.push([o[u]+l[u]*r,o[u],o[u]-l[u]*r]);return h}async function bandwidth(a,n,t){for(var e=n||14,r=t||1,s=[],l=[],h=[],o=await sma(a,e),u=0;u<a.length;u++)if(s.push(a[u]),s.length>=e){var i=await std(s);l.push(i),s.push(a[u]),s.splice(0,1)}for(u=0;u<l.length;u++){var p=(o[u]+l[u]*r-(o[u]-l[u]*r))/o[u];h.push(p)}return h}async function keltner(a,n,t){var e,r=n||14,s=t||1,l=[],h=await atr(a,r),o=[];for(var u in a)l.push((a[u][0]+a[u][1]+a[u][2])/3);e=await sma(l,r),h.splice(0,r-1);for(u=0;u<e.length;u++)o.push([e[u]+h[u]*s,e[u],e[u]-h[u]*s]);return o}async function std(a,n){var t=n||a.length,e=a.reduce((a,n)=>Number(a)+Number(n))/t;return Math.sqrt(a.reduce((a,n)=>a+Math.pow(n-e,2),0)/t)}async function cor(a,n){for(var t=await sma(a.slice(),a.length),e=await sma(n.slice(),n.length),r=0,s=0,l=0,h=0;h<a.length;h++){var o=a[h]-t,u=n[h]-e;r+=o*u,s+=Math.pow(o,2),l+=Math.pow(u,2)}var i=a.length-1;return s/=i,l/=i,r/(i*(s=Math.sqrt(s))*(l=Math.sqrt(l)))}async function dif(a,n){return(a-n)/n}async function aroon_up(a,n){for(var t=n||10,e=[],r=[],s=0;s<a.length;s++)if(e.push(a[s]),e.length>=t){var l=e.slice(0);l.sort((a,n)=>a-n);var h=l[t-1];r.push(100*(t-(e.findIndex(a=>a==h)+1))/t),e.splice(0,1)}return r}async function aroon_down(a,n){for(var t=n||10,e=[],r=[],s=0;s<a.length;s++)if(e.push(a[s]),e.length>=t){var l=e.slice(0);l.sort((a,n)=>a-n);var h=l[0];r.push(100*(t-(e.findIndex(a=>a==h)+1))/t),e.splice(0,1)}return r}async function aroon_osc(a,n){for(var t=n||25,e=[],r=await aroon.up(a,t),s=await aroon.down(a,t),l=0;l<r.length;l++)e.push(r[l]-s[l]);return e}async function mfi(a,n){for(var t=n||14,e=[],r=[],s=[],l=0;l<a.length;l++)if(s.push(a[l][0]),r.push(a[l][1]),s.length>=t){var h=0,o=0;for(q in s)h+=s[q];for(q in r)o+=r[q];e.push(100-100/(1+h/o)),s.splice(0,1),r.splice(0,1)}return e}async function roc(a,n){for(var t=n||14,e=[],r=[],s=0;s<a.length;s++)e.push(a[s]),e.length>=t&&(r.push((e[t-1]-e[0])/e[0]),e.splice(0,1));return r}async function kst(a,n,t,e,r,s,l,h,o,u){n=n||10,t=t||15,e=e||20,r=r||30,s=s||10,l=l||10,h=h||10,o=o||15,u=u||9;for(var i=[],p=[],c=Math.max(n,t,e,r)+Math.max(s,l,h,o),f=c;f<a.length;f++){var m=await roc(a.slice(f-c,f),n),g=await roc(a.slice(f-c,f),t),v=await roc(a.slice(f-c,f),e),d=await roc(a.slice(f-c,f),r);m=await sma(m,s),g=await sma(g,l),v=await sma(v,h),d=await sma(d,o),i.push(m[m.length-1]+g[g.length-1]+v[v.length-1]+d[d.length-1])}var w=await sma(i.slice(),u);for(var f in i.splice(0,i.length-w.length),w)p.push([i[f],w[f]]);return p}async function obv(a){for(var n=[0],t=1;t<a.length;t++)a[t][1]>a[t-1][1]&&n.push(n[n.length-1]+a[t][0]),a[t][1]<a[t-1][1]&&n.push(n[n.length-1]-a[t][0]),a[t][1]==a[t-1][1]&&n.push(n[n.length-1]);return n}async function vwap(a,n){for(var t=!n||n>a.length?a.length:n,e=[],r=[],s=0;s<a.length;s++)if(e.push([a[s][0]*a[s][1],a[s][1]]),e.length>=t){for(var l=0,h=0,o=0;o<e.length;o++)l+=e[o][1],h+=e[o][0];r.push(h/l),e.splice(0,1)}return r}async function mom(a,n,t){for(var e=n||10,r=[],s=e-1;s<a.length;s++)t?r.push(a[s]/a[s-(e-1)]*100):r.push(a[s]-a[s-(e-1)]);return r}async function mom_osc(a,n){for(var t=n||9,e=[],r=[],s=0;s<a.length;s++)if(e.push(a[s]),e.length>t){for(var l=0,h=0,o=1;o<t;o++)e[o-1]<e[o]?l+=e[o]:h+=e[o];r.push((l-h)/(l+h)*100),e.splice(0,1)}return r}const aroon={up:aroon_up,down:aroon_down,osc:aroon_osc};
