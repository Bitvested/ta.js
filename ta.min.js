/* ta.js (c) Nino Kroesen. MIT License. */ async function median(a,n){for(var t=[],r=n||a.length;r<=a.length;r++){var e=a.slice(r-n,r);e.sort((a,n)=>a>n?-1:a<n?1:0),t.push(e[Math.round(e.length/2)])}return t}async function kmeans(a,n){var t,r=[],e=[],s=[],l=!1,o=Math.round(a.length/(n+1));for(i=0;i<n;i++)e[i]=a[o*(i+1)];do{for(i=0;i<n;i++)r[i]=[];for(x=0;x<a.length;x++){var h=-1;for(y=0;y<n;y++){var u=Math.abs(e[y]-a[x]);-1===h?(h=u,t=y):u<=h&&(h=u,t=y)}r[t].push(a[x])}for(s=e,x=0;x<n;x++){var p=0;for(y=0;y<r[x].length;y++)p+=r[x][y];var c=p/r[t].length;e[x]=c}for(x=0;x<n;x++)e[x]!==s[x]&&(l=!0)}while(l);return r}async function normalize(a,n){n=n||0;for(var t=await Math.max.apply(null,a.slice())*(1+n),r=await Math.min.apply(null,a.slice())*(1-n),e=[],s=0;s<a.length;s++)e.push(1-(t-a[s])/(t-r));return e}async function denormalize(a,n,t){t=t||0;for(var r=await Math.max.apply(null,a.slice())*(1+t),e=await Math.min.apply(null,a.slice())*(1-t),s=[],l=0;l<n.length;l++)s.push(e+n[l]*(r-e));return s}async function mad(a,n){for(var t=n||a.length,r=[],e=t;e<=a.length;e++){var s=a.slice(e-t,e),l=await median(s),o=s.map(a=>Math.abs(a-l[l.length-1]));o=await median(o),r.push(o[o.length-1])}return r}async function aad(a,n){for(var t=n||a.length,r=[],e=t;e<=a.length;e++){var s=a.slice(e-t,e),l=0,o=await sma(s,t);for(q in s)l+=Math.abs(s[q]-o[o.length-1]);r.push(l/t)}return r}async function ssd(a,n){for(var t=n||a.length,r=[],e=t;e<a.length;e++){var s=a.slice(e-t,e),l=await sma(s,t),o=0;for(let a in s)o+=(s[a]-l[l.length-1])**2;r.push(Math.sqrt(o))}return r}async function rsi(a,n){for(var t=n||14,r=[],e=a.slice(0,t-1),s=t,l=0,o=0;s<a.length;s++,l=0,o=0){e.push(a[s]);for(var h=1;h<e.length;h++)e[h]-e[h-1]<0?o+=Math.abs(e[h]-e[h-1]):l+=e[h]-e[h-1];var u=Number(100-100/(1+l/t/(o/t)));r.push(u),e.splice(0,1)}return r}async function wrsi(a,n){for(var t=n||14,r=[],e=[],s=[],l=1;l<a.length;l++)a[l]-a[l-1]<0?(s.push(Math.abs(a[l]-a[l-1])),e.push(0)):(s.push(0),e.push(a[l]-a[l-1]));s=await wsma(s,t),e=await wsma(e,t);for(let a in s)r.push(100-100/(1+e[a]/s[a]));return r}async function tsi(a,n,t,r){for(var e=n||25,s=t||13,l=r||13,o=[],h=[],u=[],i=[],p=1;p<a.length;p++)o.push(a[p]-a[p-1]),h.push(Math.abs(a[p]-a[p-1]));var c=await ema(o,e),m=await ema(h,e),f=await ema(c,s),g=await ema(m,s);for(p=0;p<f.length;p++)u.push(f[p]/g[p]);var v=await ema(u,l);u.splice(0,u.length-v.length);for(p=0;p<v.length;p++)i.push([v[p],u[p]]);return i}async function bop(a,n){var t=a.map(a=>(a[3]-a[0])/(a[1]-a[2]));n=n||14;return t=await sma(t,n)}async function fi(a,n){for(var t=n||13,r=[],e=[],s=1;s<a.length;s++)if(r.push(a[s][0]-a[s-1][0]),r.length>=t){var l=await ema(r,t);e.push((a[s][0]-a[s-1][0])*l[0]),r.splice(0,1)}return e}async function asi(a){for(var n=[],t=1;t<a.length;t++){var r,e=a[t][1],s=a[t-1][1],l=a[t][0],o=a[t-1][0],h=a[t][2],u=a[t-1][2],i=o-e>u-e?o-e:u-e,p=a[t][0],c=a[t-1][0],m=Math.max(a[t][0],a[t-1][0])-Math.min(a[t][2],a[t-1][2]);l-s>h-s&&l-s>l-h&&(r=l-s-(h-s)/2+(s-c)/4),h-s>l-s&&h-s>l-h&&(r=h-s-(l-s)/2+(s-c)/4),l-h>l-s&&l-h>h-s&&(r=l-h+(s-c)/4),n.push((s-e+(s-c)/2+(e-p)/2)/r*50*i/m)}return n}async function ao(a,n,t){var r=n||5,e=t||35,s=[];a=a.map(a=>(a[0]+a[1])/2),pl=a.slice(0,e-1);for(var l=e-1;l<a.length;l++){pl.push(a[l]);var o=await sma(pl,r),h=await sma(pl,e);s.push(o[o.length-1]-h[h.length-1]),pl.splice(0,1)}return s}async function pr(a,n){for(var t=n||14,r=[],e=t;e<=a.length;e++){var s=a.slice(e-t,e),l=await Math.max.apply(null,s),o=await Math.min.apply(null,s);r.push((l-a[e-1])/(l-o)*-100)}return r}async function lsma(a,n){for(var t=n||25,r=[],e=t;e<=a.length;e++){for(var s,l,o=a.slice(e-t,e),h=0,u=0,i=0,p=0,c=1;c<=t;c++)h+=c,u+=o[c-1],i+=o[c-1]*c,p+=c*c,o[c-1]*o[c-1];l=u/t-(s=(i-h*u/t)/(p-h*h/t))*h/t,r.push(s*t+l)}return r}async function don(a,n){for(var t=[],r=n||20,e=r;e<=a.length;e++){var s=a.slice(e-r,e),l=[],o=[];for(let a in s)l.push(s[a][0]),o.push(s[a][1]);var h=Math.max.apply(null,l.slice()),u=Math.min.apply(null,o.slice());t.push([h,(h+u)/2,u])}return t}async function ichimoku(a,n,t,r,e){for(var s=[],l=n||9,o=t||26,h=r||52,u=e||26,i=[],p=[],c=0;c<a.length;c++)if(s.push(a[c]),s.length>h){var m=[],f=[];for(let a in s)m.push(s[a][0]),f.push(s[a][2]);var g=(Math.max.apply(null,m.slice(m.length-1-l,m.length-1))+Math.min.apply(null,f.slice(f.length-1-l,f.length-1)))/2,v=(Math.max.apply(null,m.slice(m.length-1-o,m.length-1))+Math.min.apply(null,f.slice(f.length-1-o,f.length-1)))/2,d=a[c][1]+v,w=(Math.max.apply(null,m.slice(m.length-1-h,m.length-1))+Math.min.apply(null,f.slice(f.length-1-o,f.length-1)))/2;chik=a[c][1],p.push([g,v,d,w,chik]),s.splice(0,1)}for(c=u;c<p.length-u;c++)i.push([p[c][0],p[c][1],p[c+(u-1)][2],p[c+(u-1)][3],p[c+u-1][4]]);return i}async function stoch(a,n,t,r){var e=n||14,s=t||3,l=r||3,o=[],h=[],u=[],i=[];e<s&&([e,s]=[s,e]),l>s&&([l,s]=[s,l]);for(var p=0;p<a.length;p++){if(h.push(a[p][0]),u.push(a[p][2]),h.length>=e){var c=await Math.max.apply(null,h),m=await Math.min.apply(null,u),f=100*(a[p][1]-m)/(c-m);i.push(f)}if(l>0&&i.length>l){var g=await sma(i,l);i.push(g[g.length-1])}if(i.length-l>=s){var v=await sma(i,s);o.push([f,v[v.length-1]]),h.splice(0,1),u.splice(0,1),i.splice(0,1)}}return o}async function atr(a,n){for(var t=n||14,r=[a[0][0]-a[0][2]],e=1;e<a.length;e++){var s=await Math.max(a[e][0]-a[e-1][1],a[e][2]-a[e-1][1],a[e][0]-a[e][2]);r.push((r[r.length-1]*(t-1)+s)/t)}return r}async function sma(a,n){for(var t=n||14,r=[],e=t,s=0;e<=a.length;e++,s=0){var l=a.slice(e-t,e);for(q in l)s+=l[q];r.push(s/t)}return r}async function smma(a,n){for(var t=n||14,r=[],e=t;e<=a.length;e++){var s=a.slice(e-t,e),l=0;for(q in s)l+=s[q];r.length<=0?r.push(l/t):r.push((l-r[r.length-1])/t)}return r.splice(0,1),r}async function wma(a,n){for(var t=n||14,r=0,e=[],s=1;s<=t;s++)r+=s;for(s=t;s<=a.length;s++){var l=a.slice(s-t,s),o=0;for(q in l)o+=l[q]*(Number(q)+1)/r;e.push(o)}return e}async function wsma(a,n){for(var t=n||14,r=[],e=1/t,s=t;s<=a.length;s++)if(r.length>0)r.push((a[s-1]-r[r.length-1])*e+r[r.length-1]);else{var l=a.slice(s-t,s),o=0;for(q in l)o+=l[q];r.push(o/t)}return r}async function pwma(a,n){for(var t=0,r=[],e=[],s=n||14,l=s/2,o=n;l>=1;l--,o--)l%1!=0?t+=(l=Math.round(l))*o:(e.push(l*o),t+=l*o*2),e.unshift(l*o);for(l=s;l<=a.length;l++){for(var h=0,u=a.slice(l-s,l),i=s-1;i>=0;i--)h+=u[i]*e[i]/t;r.push(h)}return r}async function hwma(a,n){for(var t=0,r=[],e=[],s=n||14,l=1,o=s;l<=s/2;l++,o--)l%1!=0?t+=(l=Math.round(l))*o:(e.push(l*o),t+=l*o*2),e.unshift(l*o);for(l=s;l<=a.length;l++){for(var h=0,u=a.slice(l-s,l),i=s-1;i>=0;i--)h+=u[i]*e[i]/t;r.push(h)}return r}async function vwma(a,n){for(var t=n||20,r=[],e=(a=a.map(a=>[a[0]*a[1],a[1]]),t);e<=a.length;e++){for(var s=a.slice(e-t,e),l=0,o=0,h=0;h<s.length;h++)l+=s[h][1],o+=s[h][0];r.push(o/l)}return r}async function ema(a,n){for(var t=n||12,r=[],e=2/(t+1),s=t;s<=a.length;s++)if(r.length>0)r.push((a[s-1]-r[r.length-1])*e+r[r.length-1]);else{var l=a.slice(s-t,s),o=0;for(q in l)o+=l[q];r.push(o/t)}return r}async function hull(a,n){var t=n||14,r=[],e=[],s=await wma(a,t),l=Math.round(Math.sqrt(t)),o=await wma(a,Math.round(t/2));o.splice(0,o.length-s.length);for(let a in s)if(r.push(2*o[a]-s[a]),r.length>=l){var h=await wma(r,l);e.push(h[h.length-1])}return e}async function kama(a,n,t,r){n=n||10,t=t||2,r=r||30;for(var e=[(e=await sma(a,n))[e.length-1]],s=n+1;s<a.length;s++){for(var l=0,o=Math.abs(a[s]-a[s-n]),h=1;h<n;h++)l+=Math.abs(a[s-h]-a[s-h-1]);var u=(o/l*(2/(t+1)-2/(r+1)+2/(r+1)))**2;e.push(e[e.length-1]+u*(a[s]-e[e.length-1]))}return e}async function macd(a,n,t){var r=n||12,e=t||26;r>e&&([r,e]=[e,r]);var s=await ema(a,r),l=await ema(a,e),o=[];s.splice(0,e-r);for(var h=0;h<l.length;h++)o.push(s[h]-l[h]);return o}async function bands(a,n,t){for(var r=n||14,e=t||1,s=[],l=[],o=[],h=await sma(a,r),u=0;u<a.length;u++)if(s.push(a[u]),s.length>=r){var i=await std(s,r);l.push(i),s.splice(0,1)}for(u=0;u<h.length;u++)o.push([h[u]+l[u]*e,h[u],h[u]-l[u]*e]);return o}async function bandwidth(a,n,t){for(var r=n||14,e=t||1,s=[],l=await bands(a,r,e),o=0;o<l.length;o++)s.push((l[o][0]-l[o][2])/l[o][1]);return s}async function keltner(a,n,t){var r,e=n||14,s=t||1,l=[],o=await atr(a,e),h=[];for(var u in a)l.push((a[u][0]+a[u][1]+a[u][2])/3);r=await sma(l,e),o.splice(0,e-1);for(u=0;u<r.length;u++)h.push([r[u]+o[u]*s,r[u],r[u]-o[u]*s]);return h}async function variance(a,n){for(var t=n||a.length,r=[],e=t;e<=a.length;e++){var s=a.slice(e-t,e),l=await sma(s,t),o=0;for(x in s)o+=(s[x]-l[l.length-1])**2;r.push(o/t)}return r}async function std(a,n){var t=n||a.length,r=a.reduce((a,n)=>Number(a)+Number(n))/t;return Math.sqrt(a.reduce((a,n)=>a+Math.pow(n-r,2),0)/t)}async function cor(a,n){for(var t=await sma(a,a.length),r=await sma(n,n.length),e=0,s=0,l=0,o=0;o<a.length;o++){var h=a[o]-t,u=n[o]-r;e+=h*u,s+=Math.pow(h,2),l+=Math.pow(u,2)}var i=a.length-1;return s/=i,l/=i,e/(i*(s=Math.sqrt(s))*(l=Math.sqrt(l)))}async function dif(a,n){return(a-n)/n}async function aroon_up(a,n){for(var t=n||10,r=[],e=t;e<=a.length;e++){var s=a.slice(e-t,e),l=s.slice();l.sort((a,n)=>a-n),r.push(100*(t-(s.findIndex(a=>a===l[t-1])+1))/t)}return r}async function aroon_down(a,n){for(var t=n||10,r=[],e=t;e<=a.length;e++){var s=a.slice(e-t,e),l=s.slice(0);l.sort((a,n)=>a-n),r.push(100*(t-(s.findIndex(a=>a===l[0])+1))/t)}return r}async function aroon_osc(a,n){for(var t=n||25,r=[],e=await aroon.up(a,t),s=await aroon.down(a,t),l=0;l<e.length;l++)r.push(e[l]-s[l]);return r}async function mfi(a,n){for(var t=n||14,r=[],e=a.map(a=>a[1]),s=a.map(a=>a[0]),l=t;l<=a.length;l++){var o=0,h=0;for(q=l-t;q<l;q++)o+=s[q],h+=e[q];r.push(100-100/(1+o/h))}return r}async function roc(a,n){for(var t=n||14,r=[],e=t;e<=a.length;e++)r.push((a[e-1]-a[e-t])/a[e-t]);return r}async function cop(a,n,t,r){n=n||11,t=t||14,r=r||10,max=Math.max(n,t),co=[];for(var e=max+r;e<a.length;e++){var s=a.slice(e-(max+r),e),l=s.slice(),o=[];s=await roc(s,n),l=await roc(l,t),s.splice(0,s.length-l.length),l.splice(0,l.length-s.length);for(var h=0;h<s.length;h++)o.push(s[h]+l[h]);o=await wma(o,r),co.push(o[o.length-1])}return co}async function kst(a,n,t,r,e,s,l,o,h,u){n=n||10,t=t||15,r=r||20,e=e||30,s=s||10,l=l||10,o=o||10,h=h||15,u=u||9;for(var i=[],p=[],c=Math.max(n,t,r,e)+Math.max(s,l,o,h),m=c;m<a.length;m++){var f=a.slice(m-c,m),g=await roc(f,n),v=await roc(f,t),d=await roc(f,r),w=await roc(f,e);g=await sma(g,s),v=await sma(v,l),d=await sma(d,o),w=await sma(w,h),i.push(g[g.length-1]+v[v.length-1]+d[d.length-1]+w[w.length-1])}var x=await sma(i,u);for(var m in i.splice(0,i.length-x.length),x)p.push([i[m],x[m]]);return p}async function obv(a){for(var n=[0],t=1;t<a.length;t++)a[t][1]>a[t-1][1]&&n.push(n[n.length-1]+a[t][0]),a[t][1]<a[t-1][1]&&n.push(n[n.length-1]-a[t][0]),a[t][1]===a[t-1][1]&&n.push(n[n.length-1]);return n}async function vwap(a,n){for(var t=!n||n>a.length?a.length:n,r=(a=a.map(a=>[a[0]*a[1],a[1]]),[]),e=t;e<=a.length;e++){for(var s=a.slice(e-t,e),l=0,o=0,h=0;h<s.length;h++)l+=s[h][1],o+=s[h][0];r.push(o/l)}return r}async function mom(a,n,t){for(var r=n||10,e=[],s=r-1;s<a.length;s++)t?e.push(a[s]/a[s-(r-1)]*100):e.push(a[s]-a[s-(r-1)]);return e}async function mom_osc(a,n){for(var t=n||9,r=[],e=t;e<a.length;e++){for(var s=0,l=0,o=1;o<t;o++)a[e-t+(o-1)]<a[e-t+o]?s+=a[e-t+o]:l+=a[e-t+o];r.push((s-l)/(s+l)*100)}return r}async function ha(a){for(var n=[[(Number(a[0][0])+Number(a[0][3]))/2,Number(a[0][1]),Number(a[0][2]),(Number(a[0][0])+Number(a[0][1])+Number(a[0][2])+Number(a[0][3]))/4]],t=1;t<a.length;t++)n.push([(n[n.length-1][0]+n[n.length-1][3])/2,Math.max(n[n.length-1][0],n[n.length-1][3],a[t][1]),Math.min(n[n.length-1][0],n[n.length-1][3],a[t][2]),(a[t][0]+a[t][1]+a[t][2]+a[t][3])/4]);return n}async function ren(a,n){for(var t=[],r=(n=n||1,Math.floor(n)===n?0:n.toString().split(".")[1].length||0),e=Math.ceil(a[0][0]/n*10**r)/10**r*n,s=e-n,l=1;l<a.length;l++){if(a[l][0]>e+n)do{t.push([e,e+n,e,e+n]),e+=n,s+=n}while(a[l][0]>e+n);if(a[l][1]<s-n)do{t.push([s,s,s-n,s-n]),e-=n,s-=n}while(a[l][1]<s-n)}return t}const aroon={up:aroon_up,down:aroon_down,osc:aroon_osc};
