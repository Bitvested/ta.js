/* ta.js (c) Nino Kroesen. MIT License. */ async function median(a,n){for(var t=[],r=n||a.length;r<=a.length;r++){var e=a.slice(r-n,r);e.sort((a,n)=>a>n?-1:a<n?1:0),t.push(e[Math.round(e.length/2)])}return t}async function kmeans(a,n){var t,r=[],e=[],l=[],s=!1,o=Math.round(a.length/(n+1));for(i=0;i<n;i++)e[i]=a[o*(i+1)];do{for(i=0;i<n;i++)r[i]=[];for(x=0;x<a.length;x++){var h=-1;for(y=0;y<n;y++){var u=Math.abs(e[y]-a[x]);-1===h?(h=u,t=y):u<=h&&(h=u,t=y)}r[t].push(a[x])}for(l=e,x=0;x<n;x++){var p=0;for(y=0;y<r[x].length;y++)p+=r[x][y];var c=p/r[t].length;e[x]=c}for(x=0;x<n;x++)e[x]!==l[x]&&(s=!0)}while(s);return r}async function normalize(a,n){n=n||0;for(var t=await Math.max.apply(null,a.slice())*(1+n),r=await Math.min.apply(null,a.slice())*(1-n),e=[],l=0;l<a.length;l++)e.push(1-(t-a[l])/(t-r));return e}async function denormalize(a,n,t){t=t||0;for(var r=await Math.max.apply(null,a.slice())*(1+t),e=await Math.min.apply(null,a.slice())*(1-t),l=[],s=0;s<n.length;s++)l.push(e+n[s]*(r-e));return l}async function mad(a,n){for(var t=n||a.length,r=[],e=t;e<=a.length;e++){var l=a.slice(e-t,e),s=await median(l),o=l.map(a=>Math.abs(a-s[s.length-1]));o=await median(o),r.push(o[o.length-1])}return r}async function aad(a,n){for(var t=n||a.length,r=[],e=t;e<=a.length;e++){var l=a.slice(e-t,e),s=0,o=await sma(l,t);for(q in l)s+=Math.abs(l[q]-o[o.length-1]);r.push(s/t)}return r}async function ssd(a,n){for(var t=n||a.length,r=[],e=t;e<a.length;e++){var l=a.slice(e-t,e),s=await sma(l,t),o=0;for(let a in l)o+=(l[a]-s[s.length-1])**2;r.push(Math.sqrt(o))}return r}async function rsi(a,n){for(var t=n||14,r=[],e=a.slice(0,t-1),l=t,s=0,o=0;l<a.length;l++,s=0,o=0){e.push(a[l]);for(var h=1;h<e.length;h++)e[h]-e[h-1]<0?o+=Math.abs(e[h]-e[h-1]):s+=e[h]-e[h-1];var u=100-100/(1+s/t/(o/t));r.push(u),e.splice(0,1)}return r}async function wrsi(a,n){for(var t=n||14,r=[],e=[],l=[],s=1;s<a.length;s++)a[s]-a[s-1]<0?(l.push(Math.abs(a[s]-a[s-1])),e.push(0)):(l.push(0),e.push(a[s]-a[s-1]));l=await wsma(l,t),e=await wsma(e,t);for(let a in l)r.push(100-100/(1+e[a]/l[a]));return r}async function tsi(a,n,t,r){for(var e=n||25,l=t||13,s=r||13,o=[],h=[],u=[],i=[],p=1;p<a.length;p++)o.push(a[p]-a[p-1]),h.push(Math.abs(a[p]-a[p-1]));var c=await ema(o,e),f=await ema(h,e),m=await ema(c,l),g=await ema(f,l);for(p=0;p<m.length;p++)u.push(m[p]/g[p]);var v=await ema(u,s);u.splice(0,u.length-v.length);for(p=0;p<v.length;p++)i.push([v[p],u[p]]);return i}async function bop(a,n){var t=a.map(a=>(a[3]-a[0])/(a[1]-a[2]));n=n||14;return t=await sma(t,n)}async function fi(a,n){for(var t=n||13,r=[],e=[],l=1;l<a.length;l++)if(r.push(a[l][0]-a[l-1][0]),r.length>=t){var s=await ema(r,t);e.push((a[l][0]-a[l-1][0])*s[0]),r.splice(0,1)}return e}async function asi(a){for(var n=[],t=1;t<a.length;t++){var r,e=a[t][1],l=a[t-1][1],s=a[t][0],o=a[t-1][0],h=a[t][2],u=a[t-1][2],i=o-e>u-e?o-e:u-e,p=a[t][0],c=a[t-1][0],f=Math.max(a[t][0],a[t-1][0])-Math.min(a[t][2],a[t-1][2]);s-l>h-l&&s-l>s-h&&(r=s-l-(h-l)/2+(l-c)/4),h-l>s-l&&h-l>s-h&&(r=h-l-(s-l)/2+(l-c)/4),s-h>s-l&&s-h>h-l&&(r=s-h+(l-c)/4),n.push((l-e+(l-c)/2+(e-p)/2)/r*50*i/f)}return n}async function ao(a,n,t){var r=n||5,e=t||35,l=[];a=a.map(a=>(a[0]+a[1])/2),pl=a.slice(0,e-1);for(var s=e-1;s<a.length;s++){pl.push(a[s]);var o=await sma(pl,r),h=await sma(pl,e);l.push(o[o.length-1]-h[h.length-1]),pl.splice(0,1)}return l}async function pr(a,n){for(var t=n||14,r=[],e=t;e<=a.length;e++){var l=a.slice(e-t,e),s=await Math.max.apply(null,l),o=await Math.min.apply(null,l);r.push((s-a[e-1])/(s-o)*-100)}return r}async function lsma(a,n){for(var t=n||25,r=[],e=t;e<=a.length;e++){for(var l,s,o=a.slice(e-t,e),h=0,u=0,i=0,p=0,c=1;c<=t;c++)h+=c,u+=o[c-1],i+=o[c-1]*c,p+=c*c,o[c-1]*o[c-1];s=u/t-(l=(i-h*u/t)/(p-h*h/t))*h/t,r.push(l*t+s)}return r}async function don(a,n){for(var t=[],r=n||20,e=r;e<=a.length;e++){var l=a.slice(e-r,e),s=[],o=[];for(let a in l)s.push(l[a][0]),o.push(l[a][1]);var h=Math.max.apply(null,s.slice()),u=Math.min.apply(null,o.slice());t.push([h,(h+u)/2,u])}return t}async function ichimoku(a,n,t,r,e){for(var l=[],s=n||9,o=t||26,h=r||52,u=e||26,i=[],p=[],c=0;c<a.length;c++)if(l.push(a[c]),l.length>h){var f=[],m=[];for(let a in l)f.push(l[a][0]),m.push(l[a][2]);var g=(Math.max.apply(null,f.slice(f.length-1-s,f.length-1))+Math.min.apply(null,m.slice(m.length-1-s,m.length-1)))/2,v=(Math.max.apply(null,f.slice(f.length-1-o,f.length-1))+Math.min.apply(null,m.slice(m.length-1-o,m.length-1)))/2,d=a[c][1]+v,w=(Math.max.apply(null,f.slice(f.length-1-h,f.length-1))+Math.min.apply(null,m.slice(m.length-1-o,m.length-1)))/2;chik=a[c][1],p.push([g,v,d,w,chik]),l.splice(0,1)}for(c=u;c<p.length-u;c++)i.push([p[c][0],p[c][1],p[c+(u-1)][2],p[c+(u-1)][3],p[c+u-1][4]]);return i}async function stoch(a,n,t,r){var e=n||14,l=t||3,s=r||3,o=[],h=[],u=[],i=[];e<l&&([e,l]=[l,e]),s>l&&([s,l]=[l,s]);for(var p=0;p<a.length;p++){if(h.push(a[p][0]),u.push(a[p][2]),h.length>=e){var c=await Math.max.apply(null,h),f=await Math.min.apply(null,u),m=100*(a[p][1]-f)/(c-f);i.push(m)}if(s>0&&i.length>s){var g=await sma(i,s);i.push(g[g.length-1])}if(i.length-s>=l){var v=await sma(i,l);o.push([m,v[v.length-1]]),h.splice(0,1),u.splice(0,1),i.splice(0,1)}}return o}async function atr(a,n){for(var t=n||14,r=[a[0][0]-a[0][2]],e=1;e<a.length;e++){var l=await Math.max(a[e][0]-a[e-1][1],a[e][2]-a[e-1][1],a[e][0]-a[e][2]);r.push((r[r.length-1]*(t-1)+l)/t)}return r}async function sma(a,n){for(var t=n||14,r=[],e=t,l=0;e<=a.length;e++,l=0){var s=a.slice(e-t,e);for(q in s)l+=s[q];r.push(l/t)}return r}async function smma(a,n){for(var t=n||14,r=[],e=t;e<=a.length;e++){var l=a.slice(e-t,e),s=0;for(q in l)s+=l[q];r.length<=0?r.push(s/t):r.push((s-r[r.length-1])/t)}return r.splice(0,1),r}async function wma(a,n){for(var t=n||14,r=0,e=[],l=1;l<=t;l++)r+=l;for(l=t;l<=a.length;l++){var s=a.slice(l-t,l),o=0;for(q in s)o+=s[q]*(Number(q)+1)/r;e.push(o)}return e}async function wsma(a,n){for(var t=n||14,r=[],e=1/t,l=t;l<=a.length;l++)if(r.length>0)r.push((a[l-1]-r[r.length-1])*e+r[r.length-1]);else{var s=a.slice(l-t,l),o=0;for(q in s)o+=s[q];r.push(o/t)}return r}async function pwma(a,n){for(var t=0,r=[],e=[],l=n||14,s=l/2,o=n;s>=1;s--,o--)s%1!=0?t+=(s=Math.round(s))*o:(e.push(s*o),t+=s*o*2),e.unshift(s*o);for(s=l;s<=a.length;s++){for(var h=0,u=a.slice(s-l,s),i=l-1;i>=0;i--)h+=u[i]*e[i]/t;r.push(h)}return r}async function hwma(a,n){for(var t=0,r=[],e=[],l=n||14,s=1,o=l;s<=l/2;s++,o--)s%1!=0?t+=(s=Math.round(s))*o:(e.push(s*o),t+=s*o*2),e.unshift(s*o);for(s=l;s<=a.length;s++){for(var h=0,u=a.slice(s-l,s),i=l-1;i>=0;i--)h+=u[i]*e[i]/t;r.push(h)}return r}async function vwma(a,n){for(var t=n||20,r=[],e=(a=a.map(a=>[a[0]*a[1],a[1]]),t);e<=a.length;e++){for(var l=a.slice(e-t,e),s=0,o=0,h=0;h<l.length;h++)s+=l[h][1],o+=l[h][0];r.push(o/s)}return r}async function ema(a,n){for(var t=n||12,r=[],e=2/(t+1),l=t;l<=a.length;l++)if(r.length>0)r.push((a[l-1]-r[r.length-1])*e+r[r.length-1]);else{var s=a.slice(l-t,l),o=0;for(q in s)o+=s[q];r.push(o/t)}return r}async function hull(a,n){var t=n||14,r=[],e=[],l=await wma(a,t),s=Math.round(Math.sqrt(t)),o=await wma(a,Math.round(t/2));o.splice(0,o.length-l.length);for(let a in l)if(r.push(2*o[a]-l[a]),r.length>=s){var h=await wma(r,s);e.push(h[h.length-1])}return e}async function kama(a,n,t,r){n=n||10,t=t||2,r=r||30;for(var e=[(e=await sma(a,n))[e.length-1]],l=n+1;l<a.length;l++){for(var s=0,o=Math.abs(a[l]-a[l-n]),h=1;h<n;h++)s+=Math.abs(a[l-h]-a[l-h-1]);var u=(o/s*(2/(t+1)-2/(r+1)+2/(r+1)))**2;e.push(e[e.length-1]+u*(a[l]-e[e.length-1]))}return e}async function macd(a,n,t){var r=n||12,e=t||26;r>e&&([r,e]=[e,r]);var l=await ema(a,r),s=await ema(a,e),o=[];l.splice(0,e-r);for(var h=0;h<s.length;h++)o.push(l[h]-s[h]);return o}async function bands(a,n,t){for(var r=n||14,e=t||1,l=[],s=[],o=[],h=await sma(a,r),u=0;u<a.length;u++)if(l.push(a[u]),l.length>=r){var i=await std(l,r);s.push(i),l.splice(0,1)}for(u=0;u<h.length;u++)o.push([h[u]+s[u]*e,h[u],h[u]-s[u]*e]);return o}async function bandwidth(a,n,t){for(var r=n||14,e=t||1,l=[],s=await bands(a,r,e),o=0;o<s.length;o++)l.push((s[o][0]-s[o][2])/s[o][1]);return l}async function keltner(a,n,t){var r,e=n||14,l=t||1,s=[],o=await atr(a,e),h=[];for(var u in a)s.push((a[u][0]+a[u][1]+a[u][2])/3);r=await sma(s,e),o.splice(0,e-1);for(u=0;u<r.length;u++)h.push([r[u]+o[u]*l,r[u],r[u]-o[u]*l]);return h}async function variance(a,n){for(var t=n||a.length,r=[],e=t;e<=a.length;e++){var l=a.slice(e-t,e),s=await sma(l,t),o=0;for(x in l)o+=(l[x]-s[s.length-1])**2;r.push(o/t)}return r}async function std(a,n){var t=n||a.length,r=a.reduce((a,n)=>Number(a)+Number(n))/t;return Math.sqrt(a.reduce((a,n)=>a+Math.pow(n-r,2),0)/t)}async function normsinv(a){var n=-.00778489400243029,t=-.322396458041136,r=-2.40075827716184,e=-2.54973253934373,l=4.37466414146497,s=2.93816398269878,o=.00778469570904146,h=.32246712907004,u=2.445134137143,i=3.75440866190742;if(a<0||a>1)return 0;if(a<.02425)return(((((n*(p=Math.sqrt(-2*Math.log(a)))+t)*p+r)*p+e)*p+l)*p+s)/((((o*p+h)*p+u)*p+i)*p+1);if(a<=.97575){var p,c=(p=a-.5)*p;return(((((-39.6968302866538*c+220.946098424521)*c-275.928510446969)*c+138.357751867269)*c-30.6647980661472)*c+2.50662827745924)*p/(((((-54.4760987982241*c+161.585836858041)*c-155.698979859887)*c+66.8013118877197)*c-13.2806815528857)*c+1)}return-(((((n*(p=Math.sqrt(-2*Math.log(1-a)))+t)*p+r)*p+e)*p+l)*p+s)/((((o*p+h)*p+u)*p+i)*p+1)}async function sim(a,n,t,r){for(var e=[],l=(n=n||50,t=t||1e3,0);l<t;l++){for(var s=a.slice(),o=0;o<n;o++){for(var h=[],u=1;u<s.length;u++){var i=await dif(s[u],s[u-1]);h.push(i)}var p=await sma(h,h.length),c=await std(h),f=await normsinv(Math.random());s.push(s[s.length-1]*Math.exp(p[0]-c*c/2+c*f))}e.push(s)}if(!r)return e;var m=a.slice();for(l=a.length;l<e[0].length;l++)e.sort((a,n)=>a[l]>n[l]?1:a[l]<n[l]?-1:0),m.push(e[Math.round(e.length*r)][l]);return m}async function cor(a,n){for(var t=await sma(a,a.length),r=await sma(n,n.length),e=0,l=0,s=0,o=0;o<a.length;o++){var h=a[o]-t,u=n[o]-r;e+=h*u,l+=Math.pow(h,2),s+=Math.pow(u,2)}var i=a.length-1;return l/=i,s/=i,e/(i*(l=Math.sqrt(l))*(s=Math.sqrt(s)))}async function dif(a,n){return(a-n)/n}async function aroon_up(a,n){for(var t=n||10,r=[],e=t;e<=a.length;e++){var l=a.slice(e-t,e),s=l.slice();s.sort((a,n)=>a-n),r.push(100*(t-(l.findIndex(a=>a===s[t-1])+1))/t)}return r}async function aroon_down(a,n){for(var t=n||10,r=[],e=t;e<=a.length;e++){var l=a.slice(e-t,e),s=l.slice(0);s.sort((a,n)=>a-n),r.push(100*(t-(l.findIndex(a=>a===s[0])+1))/t)}return r}async function aroon_osc(a,n){for(var t=n||25,r=[],e=await aroon.up(a,t),l=await aroon.down(a,t),s=0;s<e.length;s++)r.push(e[s]-l[s]);return r}async function mfi(a,n){for(var t=n||14,r=[],e=a.map(a=>a[1]),l=a.map(a=>a[0]),s=t;s<=a.length;s++){var o=0,h=0;for(q=s-t;q<s;q++)o+=l[q],h+=e[q];r.push(100-100/(1+o/h))}return r}async function roc(a,n){for(var t=n||14,r=[],e=t;e<=a.length;e++)r.push((a[e-1]-a[e-t])/a[e-t]);return r}async function cop(a,n,t,r){n=n||11,t=t||14,r=r||10,max=Math.max(n,t),co=[];for(var e=max+r;e<a.length;e++){var l=a.slice(e-(max+r),e),s=l.slice(),o=[];l=await roc(l,n),s=await roc(s,t),l.splice(0,l.length-s.length),s.splice(0,s.length-l.length);for(var h=0;h<l.length;h++)o.push(l[h]+s[h]);o=await wma(o,r),co.push(o[o.length-1])}return co}async function kst(a,n,t,r,e,l,s,o,h,u){n=n||10,t=t||15,r=r||20,e=e||30,l=l||10,s=s||10,o=o||10,h=h||15,u=u||9;for(var i=[],p=[],c=Math.max(n,t,r,e)+Math.max(l,s,o,h),f=c;f<a.length;f++){var m=a.slice(f-c,f),g=await roc(m,n),v=await roc(m,t),d=await roc(m,r),w=await roc(m,e);g=await sma(g,l),v=await sma(v,s),d=await sma(d,o),w=await sma(w,h),i.push(g[g.length-1]+v[v.length-1]+d[d.length-1]+w[w.length-1])}var x=await sma(i,u);for(var f in i.splice(0,i.length-x.length),x)p.push([i[f],x[f]]);return p}async function obv(a){for(var n=[0],t=1;t<a.length;t++)a[t][1]>a[t-1][1]&&n.push(n[n.length-1]+a[t][0]),a[t][1]<a[t-1][1]&&n.push(n[n.length-1]-a[t][0]),a[t][1]===a[t-1][1]&&n.push(n[n.length-1]);return n}async function vwap(a,n){for(var t=!n||n>a.length?a.length:n,r=(a=a.map(a=>[a[0]*a[1],a[1]]),[]),e=t;e<=a.length;e++){for(var l=a.slice(e-t,e),s=0,o=0,h=0;h<l.length;h++)s+=l[h][1],o+=l[h][0];r.push(o/s)}return r}async function mom(a,n,t){for(var r=n||10,e=[],l=r-1;l<a.length;l++)t?e.push(a[l]/a[l-(r-1)]*100):e.push(a[l]-a[l-(r-1)]);return e}async function mom_osc(a,n){for(var t=n||9,r=[],e=t;e<a.length;e++){for(var l=0,s=0,o=1;o<t;o++)a[e-t+(o-1)]<a[e-t+o]?l+=a[e-t+o]:s+=a[e-t+o];r.push((l-s)/(l+s)*100)}return r}async function ha(a){for(var n=[[(Number(a[0][0])+Number(a[0][3]))/2,Number(a[0][1]),Number(a[0][2]),(Number(a[0][0])+Number(a[0][1])+Number(a[0][2])+Number(a[0][3]))/4]],t=1;t<a.length;t++)n.push([(n[n.length-1][0]+n[n.length-1][3])/2,Math.max(n[n.length-1][0],n[n.length-1][3],a[t][1]),Math.min(n[n.length-1][0],n[n.length-1][3],a[t][2]),(a[t][0]+a[t][1]+a[t][2]+a[t][3])/4]);return n}async function ren(a,n){for(var t=[],r=(n=n||1,Math.floor(n)===n?0:n.toString().split(".")[1].length||0),e=Math.ceil(a[0][0]/n*10**r)/10**r*n,l=e-n,s=1;s<a.length;s++){if(a[s][0]>e+n)do{t.push([e,e+n,e,e+n]),e+=n,l+=n}while(a[s][0]>e+n);if(a[s][1]<l-n)do{t.push([l,l,l-n,l-n]),e-=n,l-=n}while(a[s][1]<l-n)}return t}const aroon={up:aroon_up,down:aroon_down,osc:aroon_osc};
